<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<title>ÙƒØ´Ù ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ù¡Ù¤Ù¤Ù§Ù‡Ù€</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--moe:#1e8a79;--moe-d:#0c594e;--ink:#0b2f2b;--line:#e6f1ee}
*{box-sizing:border-box} html,body{margin:0;background:#fff;color:var(--ink);font-family:"Tajawal";font-size:15px;line-height:1.8}
#page{width:min(1120px,100%);margin:0 auto;padding:12px 14px 50px}
.head{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;text-align:center;margin-bottom:8px}
.hcol{display:flex;flex-direction:column;gap:2px;align-items:center}.hcol .line{font-weight:700;color:var(--moe-d)}
img{width:min(220px,40vw)}
.actions{display:flex;gap:8px;justify-content:flex-end;margin:6px 0}
.btn{border:1px solid var(--line);border-radius:10px;padding:6px 10px;font-weight:800;background:#fff;color:#0c594e;cursor:pointer}
.btn.primary{background:linear-gradient(180deg,var(--moe),var(--moe-d));color:#fff}
.btn.warn{background:linear-gradient(180deg,#fff6f6,#ffecec);color:#9b0000}

.summary{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;border:1px solid var(--line);border-radius:12px;padding:8px;background:#fff;margin:8px 0}
.tag{border:1px solid var(--line);border-radius:10px;padding:6px 8px;text-align:center}
.tag .t{font-size:12px;color:#557}.tag .v{font-weight:900;color:#0c594e}

.table{width:100%;border-collapse:collapse;border:1px solid var(--line);border-radius:12px;overflow:hidden}
.table th,.table td{border:1px solid var(--line);padding:8px;vertical-align:middle;white-space:nowrap}
.table th{background:var(--moe);color:#fff}
.w-id{width:130px;max-width:130px}
.sign{height:26px;border-bottom:1px dashed #a9c5bf}

/* Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø£Ø³ÙÙ„ Ø§Ù„ÙƒØ´Ù */
.approval{margin-top:12px;display:flex;justify-content:flex-end}
.approval .stamp{border:1px solid var(--line);border-radius:10px;padding:8px 12px;background:#fff;color:#0c594e;font-weight:800}
.approval .sub{font-size:12px;color:#6a7f7b;margin-top:4px;text-align:center}

@media (max-width:920px){.summary{grid-template-columns:repeat(3,1fr)}}
@media print{
  .actions{display:none!important}
  @page{size:A4;margin:12mm}
  html,body{font-size:13px;line-height:1.6}
}
</style>
</head>
<body>
<div id="page">
  <div class="head" data-hide-on-print>
    <div class="hcol"><div class="line">Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</div><div class="line">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</div><div class="line" id="dir">â€”</div><div class="line" id="sch">â€”</div></div>
    <img src="ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ….png" alt="">
    <div class="hcol"><div class="line" id="day"></div><div class="line" id="date"></div><div class="line">ÙƒØ´Ù ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ù¡Ù¤Ù¤Ù§Ù‡Ù€</div></div>
  </div>

  <div class="actions">
    <button class="btn primary" id="add">Ø¥Ø¶Ø§ÙØ© Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
    <button class="btn" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
    <button class="btn" id="delOne">Ø­Ø°Ù Ø§Ø³Ù… ÙˆØ§Ø­Ø¯</button>
    <button class="btn warn" id="wipe">Ù…Ø³Ø­ Ø§Ù„ÙƒØ´Ù</button>
    <button class="btn" onclick="window.close()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>

  <!-- Ù…Ù„Ø®Øµ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ´Ù -->
  <section class="summary">
    <div class="tag"><div class="t">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…ÙŠÙ†</div><div class="v" id="c_all">0</div></div>
    <div class="tag"><div class="t">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ù‘ÙÙ„Ù‘Ù…</div><div class="v" id="avg">0.00 / 5</div></div>
    <div class="tag"><div class="t">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¤Ø´Ø±</div><div class="v" id="avgPct">0%</div></div>
    <div class="tag"><div class="t">Ø¯Ø±Ø¬Ø© 5</div><div class="v" id="c5">0</div></div>
    <div class="tag"><div class="t">Ø¯Ø±Ø¬Ø© 4</div><div class="v" id="c4">0</div></div>
    <div class="tag"><div class="t">Ø¯Ø±Ø¬Ø© 3/2/1</div><div class="v" id="c321">0/0/0</div></div>
  </section>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒØ´Ù: Ø§Ù„Ø§Ø³Ù…/Ø§Ù„Ù‡ÙˆÙŠØ©/Ø§Ù„ØªØ®ØµØµ/Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¯Ø§Ø¡/Ø§Ù„Ù…Ø¤Ø´Ø±/Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ -->
  <table class="table" id="tbl">
    <thead>
      <tr>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th class="w-id">Ø§Ù„Ù‡ÙˆÙŠØ©</th>
        <th>Ø§Ù„ØªØ®ØµØµ</th>
        <th>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¯Ø§Ø¡ (Ù…Ù† 5)</th>
        <th>Ù…Ø¤Ø´Ø± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² %</th>
        <th>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù…</th>
      </tr>
    </thead>
    <tbody id="body"></tbody>
  </table>

  <!-- Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ (Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠØ³Ø­Ø¨ Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©) -->
  <div class="approval">
    <div>
      <div class="stamp" id="approveTxt">ÙŠØ¹ØªÙ…Ø¯ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: â€”</div>
      <div class="sub">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆØ§Ù„Ø®ØªÙ…</div>
    </div>
  </div>
</div>

<script>
const $=s=>document.querySelector(s);
const now=new Date(),days=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
$('#day').textContent=days[now.getDay()]; $('#date').textContent=now.toLocaleDateString('ar-SA');

/* Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
const sess=JSON.parse(localStorage.getItem('PF_session')||'{}');
$('#dir').textContent=sess.dir||'â€”'; 
$('#sch').textContent=sess.school||'â€”';

/* Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙØ³Ø­Ø¨ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠÙ‹Ø§ Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:
   - Ø£ÙˆÙ„Ù‹Ø§ Ù…Ù† PF_session.principal (Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸/Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
   - Ø§Ø­ØªÙŠØ§Ø·Ù‹Ø§ Ù…Ù† PF_principal (Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø®Ø²Ù‘Ù† Ù…Ø³Ø¨Ù‚Ù‹Ø§)ØŒ
   - ÙˆØ¥Ù„Ø§ ÙŠÙØ¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ. */
(function setPrincipalApproval(){
  const fromSession=(sess && sess.principal)||'';
  const fallbackLocal=localStorage.getItem('PF_principal')||'';
  const name=(fromSession || fallbackLocal || 'ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ').trim();
  $('#approveTxt').textContent='ÙŠØ¹ØªÙ…Ø¯ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: ' + name;
})();

/* Ø£Ø±Ø´ÙŠÙ Ø§Ù„ÙƒØ´Ù */
function box(){return JSON.parse(localStorage.getItem('PF_archive')||'[]');}
function save(a){localStorage.setItem('PF_archive',JSON.stringify(a));}

/* Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©) */
function addFromSession(){
  const s=JSON.parse(localStorage.getItem('PF_session')||'{}');
  if(!s.name||!s.model){alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© ØµØ§Ù„Ø­Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');return;}
  const rec={name:s.name||'â€”',id:s.id||'',spec:s.spec||'',avg:+(s.avg||0),total:+(s.total||0)};
  const a=box(); a.push(rec); save(a); render();
}

/* Ø­Ø°Ù Ø§Ø³Ù… ÙˆØ§Ø­Ø¯ â€” Ø¨Ø§Ù„Ù‡ÙˆÙŠØ© Ø£Ùˆ Ø§Ù„Ø§Ø³Ù… */
function deleteOne(){
  const key=prompt('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ø£Ùˆ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡ Ù…Ù† Ø§Ù„ÙƒØ´Ù:');
  if(!key) return;
  const a=box();
  const k=key.trim();
  const idx=a.findIndex(r=> String(r.id||'')===k || String(r.name||'').trim()===k);
  if(idx===-1){ alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ù…Ø·Ø§Ø¨Ù‚'); return; }
  a.splice(idx,1); save(a); render();
}

/* Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ´Ù ÙˆØ§Ù„Ù…Ù„Ø®Øµ */
function render(){
  const a=box(), tb=$('#body'); tb.innerHTML='';
  a.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.name}</td><td class="w-id">${r.id||''}</td><td>${r.spec||''}</td><td style="text-align:center">${(+r.avg).toFixed(2)}</td><td style="text-align:center">${(+r.total).toFixed(0)}%</td><td><div class="sign"></div></td>`;
    tb.appendChild(tr);
  });
  // Ù…Ù„Ø®Øµ Ø¹Ù„ÙˆÙŠ
  $('#c_all').textContent=a.length;
  const cnt={1:0,2:0,3:0,4:0,5:0}; let sA=0,sP=0;
  a.forEach(r=>{const g=Math.max(1,Math.min(5,Math.round(+r.avg)));cnt[g]++; sA+=+r.avg; sP+=+r.total;});
  const avg=a.length? sA/a.length : 0, pct=a.length? Math.round(sP/a.length) : 0;
  $('#avg').textContent=avg.toFixed(2)+' / 5'; $('#avgPct').textContent=pct+'%';
  $('#c5').textContent=cnt[5]; $('#c4').textContent=cnt[4];
  $('#c321').textContent=`${cnt[3]}/${cnt[2]}/${cnt[1]}`;
}

/* Ø£Ø­Ø¯Ø§Ø« */
document.getElementById('add').onclick=addFromSession;
document.getElementById('delOne').onclick=deleteOne;
document.getElementById('wipe').onclick=()=>{if(confirm('Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙƒØ´ÙØŸ')){save([]);render();}};

/* Ø¨Ø¯Ø¡ */
render();
</script>
</body>
</html>
