<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<title>Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
:root{--moe:#1e8a79;--moe-d:#0c594e;--ink:#0b2f2b;--line:#e6f1ee;--paper:#fff}
*{box-sizing:border-box}
html,body{margin:0;background:#fff;color:var(--ink);font-family:"Tajawal";font-size:15px;line-height:1.8}
#page{width:min(1120px,100%);margin:0 auto;padding:12px 14px 48px}

/* Ù‡ÙŠØ¯Ø± */
.header{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;text-align:center;margin-bottom:8px}
.hcol{display:flex;flex-direction:column;gap:2px;align-items:center}
.hcol .line{display:inline-flex;align-items:center;gap:6px;font-weight:700;color:var(--moe-d)}
.pen{border:none;background:transparent;color:var(--moe-d);cursor:pointer;font-size:14px;line-height:1}
.pen:hover{opacity:.8}
.noprint{display:inline-flex}
#moe{width:min(220px,40vw);object-fit:contain}

/* Ø§Ù„Ø£Ø¯ÙˆØ§Øª */
.toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;white-space:nowrap;margin:6px 0}
.select{appearance:none;height:32px;padding:0 26px 0 10px;border:1px solid var(--line);border-radius:999px;background:#fff;font-weight:800;color:#0b3a34;cursor:pointer;font-size:13px}
.sel{position:relative;display:inline-block}
.sel>span{position:absolute;right:10px;top:6px;pointer-events:none}
.btn{border:1px solid var(--line);border-radius:10px;padding:6px 10px;font-weight:800;background:#fff;color:#0c594e;cursor:pointer}
.btn.primary{background:linear-gradient(180deg,var(--moe),var(--moe-d));color:#fff}
.btn.warn{background:linear-gradient(180deg,#fff6f6,#ffe5e5);color:#990000}
.btn[disabled]{opacity:.6;cursor:not-allowed}

/* ØµÙ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù + Ø¹Ø¯Ø³Ø© Ø£Ø³Ù…Ø§Ø¡ Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
.grid4{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:8px}
.lined{height:40px;border:1px solid var(--line);border-radius:12px;padding:0 12px;background:#fff}
.namewrap{position:relative}
#lensBtn{position:absolute;left:8px;top:6px;height:28px;padding:0 8px;border:1px solid var(--line);border-radius:8px;background:#f2fbf8;color:#0b534b;font-weight:900;cursor:pointer}
.lens{position:absolute;z-index:50;right:0;top:44px;width:min(760px,95vw);background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:0 12px 28px rgba(0,0,0,.08);padding:10px;display:none}
.lens .bar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.lens .lined{height:34px}
.lens .pill{border:1px dashed var(--line);border-radius:999px;padding:4px 10px;cursor:pointer;background:#fff}
.lens .tbl{width:100%;border-collapse:collapse;margin-top:8px}
.lens .tbl th,.lens .tbl td{border:1px solid var(--line);padding:6px 8px;white-space:nowrap}
.lens .tbl th{background:#f6fbf9;color:#0c594e}
.lens .tbl tbody tr{cursor:pointer}
.lens .tbl tbody tr:hover{background:#f2fbf8}

/* Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„Ù„Ø£Ø¯Ø§Ø¡ */
#goals{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fcfffe;margin:8px 0}
#goals h3{margin:0 0 6px;color:#0c594e;display:flex;align-items:center;gap:10px}
#goals .hint{font-size:12px;color:#557;white-space:nowrap}
.goalrow{display:grid;grid-template-columns:2fr 1fr 1fr;gap:8px;margin-top:6px}
.goalrow input{height:36px;border:1px solid var(--line);border-radius:10px;padding:0 10px}
#goalChips{display:flex;gap:6px;flex-wrap:wrap}
#goalChips button{border:1px dashed var(--line);background:#fff;border-radius:999px;padding:4px 8px;font-size:12px;cursor:pointer;color:#0c594e}

/* Ø§Ù„Ù…Ø¤Ø´Ø± */
.kpi{margin:8px 0}
.kbar{height:16px;border-radius:999px;border:1px solid #d6ece8;overflow:hidden;position:relative}
.kfill{position:absolute;inset:0;width:0%;background:linear-gradient(90deg,#ef4444,#f59e0b,#22c55e,#10b981);opacity:.95;transition:width .4s}
.kline{display:flex;gap:8px;justify-content:space-between;font-size:12px;color:#415b56}

/* Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… */
.table{width:100%;border-collapse:collapse;border:1px solid var(--line);border-radius:12px;overflow:hidden}
.table th,.table td{border:1px solid var(--line);padding:8px;vertical-align:middle}
.table th{background:var(--moe);color:#fff}
.table tfoot th{background:#0f4e47;color:#fff}
.select-mini{appearance:none;background:#fff;border:none;border-radius:10px;padding:4px 8px;font-weight:900;color:#0b3430;text-align:center;text-align-last:center}
tr.r1{background:linear-gradient(90deg,#fee2e2 0,#fff 60%)} tr.r2{background:linear-gradient(90deg,#fde68a 0,#fff 60%)} tr.r3{background:linear-gradient(90deg,#ecfeff 0,#fff 60%)} tr.r4{background:linear-gradient(90deg,#dcfce7 0,#fff 60%)} tr.r5{background:linear-gradient(90deg,#bbf7d0 0,#fff 60%)}

/* Ø§Ù„Ù‚ÙˆØ©/Ø§Ù„ØªØ­Ø³ÙŠÙ† */
.duo{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:10px 0}
.box{border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px}
.box h3{margin:0 0 6px;color:#0c594e;font-size:15px}
.box p{white-space:pre-wrap;margin:0}

/* ØªÙˆÙ‚ÙŠØ¹Ø§Øª + ØªØ°ÙŠÙŠÙ„ */
.signs{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
.sig{text-align:center}.sig-name{font-weight:800;color:#0c594e;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sig-line{border-top:1px dashed #bcd3cd;margin-top:6px;width:80%;margin-inline:auto}
.footer{color:#6a7f7b;font-size:12px;text-align:center;margin-top:10px}

/* ØªÙ„Ù…ÙŠØ­ */
.tip{position:relative}
.tip:hover::after{content:attr(data-tip);position:absolute;bottom:calc(100% + 6px);right:0;background:#0c594e;color:#fff;padding:6px 8px;border-radius:8px;font-size:12px;white-space:nowrap}

/* ØªØ¬Ø§ÙˆØ¨ÙŠØ© Ù‚ÙˆÙŠØ© */
@media (max-width:920px){
  .grid4{grid-template-columns:1fr 1fr;gap:6px}
  .goalrow{grid-template-columns:1fr}
  .toolbar{gap:6px}
}
@media (max-width:600px){
  html,body{font-size:14px}
  .select{height:34px}
  .lined{height:38px}
}

/* Ø·Ø¨Ø§Ø¹Ø© */
@media print{
  .toolbar,.lens,.noprint,.tip::after,[data-hide-on-print]{display:none!important}
  #page{padding:0}
  @page{size:A4;margin:12mm}
  html,body{font-size:13px;line-height:1.6}
  .goalrow input{height:30px}
}
</style>
</head>
<body>
<div id="page">

  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø±: Ø£Ù‚Ù„Ø§Ù… ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ù…Ø¯Ø±Ø³Ø© (ØªÙØ®ÙÙ‰ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©) -->
  <div class="header">
    <div class="hcol">
      <div class="line">Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</div>
      <div class="line">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</div>
      <div class="line">
        <span id="dirTxt">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</span>
        <button class="pen noprint" id="editDir" title="ØªØ¹Ø¯ÙŠÙ„">âœ</button>
      </div>
      <div class="line">
        <span id="schTxt">Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ÙŠØ¹Ù‚ÙˆØ¨ÙŠ</span>
        <button class="pen noprint" id="editSch" title="ØªØ¹Ø¯ÙŠÙ„">âœ</button>
      </div>
    </div>
    <img id="moe" alt="ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…" src="ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ….png">
    <div class="hcol">
      <div class="line" id="dayTxt"></div>
      <div class="line" id="dateTxt"></div>
      <div class="line" id="mdlTxt">Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: â€”</div>
    </div>
  </div>

  <!-- Ø§Ù„Ø£Ø¯ÙˆØ§Øª ÙÙŠ ØµÙ ÙˆØ§Ø­Ø¯ -->
  <div class="toolbar">
    <div class="sel">
      <select id="model" class="select">
        <option value="principal">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</option>
        <option value="vp">ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</option>
        <option value="teacher" selected>Ø§Ù„Ù…Ø¹Ù„Ù‘Ù…</option>
        <option value="activity">Ù…Ø¹Ù„Ù… Ù…Ø³Ù†Ø¯ Ù„Ù‡ Ù†Ø´Ø§Ø· Ø·Ù„Ø§Ø¨ÙŠ</option>
        <option value="health">Ù…Ø¹Ù„Ù… Ù…Ø³Ù†Ø¯ Ù„Ù‡ ØªÙˆØ¬ÙŠÙ‡ ØµØ­ÙŠ</option>
        <option value="counselor">Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</option>
        <option value="lab">Ù…Ø­Ø¶Ø± Ø§Ù„Ù…Ø®ØªØ¨Ø±</option>
        <option value="kg">Ù…Ø¹Ù„Ù…Ø© Ø±ÙŠØ§Ø¶ Ø§Ù„Ø£Ø·ÙØ§Ù„</option>
      </select><span>â–¾</span>
    </div>
    <div class="sel">
      <select id="stage" class="select">
        <option value="first" selected>Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø§Ù„ØªØ®Ø·ÙŠØ·)</option>
        <option value="second">Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†ØµÙ Ø³Ù†ÙˆÙŠØ©)</option>
        <option value="final">Ø§Ù„Ø«Ø§Ù„Ø«Ø© (Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ)</option>
      </select><span>â–¾</span>
    </div>

    <button class="btn primary" id="saveBtn">ğŸ’¾ Ø­ÙØ¸</button>
    <button class="btn primary tip" id="gapBtn" data-tip="">Ø®Ø·Ø© ØªØ­Ø³ÙŠÙ† ÙØ¬ÙˆØ© Ø§Ù„Ø£Ø¯Ø§Ø¡ â–¾</button>
    <button class="btn primary tip" id="archBtn" data-tip="">ÙƒØ´Ù ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ â–¾</button>
    <button class="btn" id="printBtn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
    <button class="btn warn" id="clearBtn">ğŸ§¹ Ù…Ø³Ø­</button>
  </div>

  <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù (Ø§Ù„Ø¹Ø¯Ø³Ø© Ø¯Ø§Ø®Ù„ Ø£ÙˆÙ„ Ø®Ø§Ù†Ø©) -->
  <div class="grid4">
    <div class="namewrap">
      <input id="tName" class="lined" placeholder="Ø§Ø³Ù… Ø´Ø§ØºÙ„ Ø§Ù„ÙˆØ¸ÙŠÙØ©" autocomplete="off">
      <button id="lensBtn" title="Ø¹Ø¯Ø³Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡">ğŸ”</button>
      <div id="lens" class="lens">
        <div class="bar">
          <strong style="color:#0c594e">Ø¹Ø¯Ø³Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</strong>
          <input id="q" class="lined" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ Ø¨Ø§Ù„Ø§Ø³Ù…/Ø§Ù„Ù‡ÙˆÙŠØ©/Ø§Ù„ØªØ®ØµØµ" style="flex:1;min-width:160px">
          <input type="file" id="xls" accept=".xlsx,.xls,.csv" hidden>
          <button class="pill" id="pick">â¬†ï¸ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
          <button class="pill" id="sample">â†» Ø¹ÙŠÙ‘Ù†Ø© Ù„Ù„ØªØ¬Ø±Ø¨Ø©</button>
          <button class="pill" id="purge">Ù…Ø³Ø­</button>
          <span id="stats" style="margin-right:auto;color:#647a74"></span>
        </div>
        <table class="tbl">
          <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡ÙˆÙŠØ©</th><th>Ø§Ù„ØªØ®ØµØµ</th><th>Ø§Ù„Ù…Ø³Ù…Ù‰</th></tr></thead>
          <tbody id="namesBody"></tbody>
        </table>
      </div>
    </div>
    <input id="tId" class="lined" inputmode="numeric" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©" autocomplete="off">
    <input id="tSpec" class="lined" placeholder="Ø§Ù„ØªØ®ØµØµ" autocomplete="off">
    <input id="tTitle" class="lined" placeholder="Ø§Ù„Ù…Ø³Ù…Ù‰" autocomplete="off">
  </div>

  <!-- Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„Ù„Ø£Ø¯Ø§Ø¡ (ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙ‚Ø·) -->
  <section id="goals">
    <h3>
      Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„Ù„Ø£Ø¯Ø§Ø¡
      <span class="hint">ğŸ”¹ ÙŠÙ‡Ø¯Ù Ø¥Ù„Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù‚ÙŠØ§Ø³ ÙˆØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø¬Ù‡ÙˆØ¯ Ù†Ø­Ùˆ Ø£ÙˆÙ„ÙˆÙŠØ§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡</span>
    </h3>
    <div id="goalChips" data-hide-on-print></div>
    <div class="goalrow"><input id="g1" placeholder="Ø§Ù„Ù‡Ø¯Ù"><input id="g1i" placeholder="Ø§Ù„Ù…Ø¤Ø´Ø±"><input id="g1t" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©"></div>
    <div class="goalrow"><input id="g2" placeholder="Ø§Ù„Ù‡Ø¯Ù"><input id="g2i" placeholder="Ø§Ù„Ù…Ø¤Ø´Ø±"><input id="g2t" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©"></div>
    <div class="goalrow"><input id="g3" placeholder="Ø§Ù„Ù‡Ø¯Ù"><input id="g3i" placeholder="Ø§Ù„Ù…Ø¤Ø´Ø±"><input id="g3t" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©"></div>
  </section>

  <!-- Ø§Ù„Ù…Ø¤Ø´Ø± -->
  <div class="kpi">
    <div class="kbar"><div id="fill" class="kfill"></div></div>
    <div class="kline">
      <span id="kL">Ù…Ø¤Ø´Ø± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²: 0%</span>
      <span id="kM">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ù‘ÙÙ„Ù‘Ù…: 0.00 / 5</span>
      <span id="kR">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£ÙˆØ²Ø§Ù†: 0%</span>
    </div>
  </div>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… -->
  <table class="table" id="tbl">
    <thead><tr><th style="text-align:right">Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th><th>Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù†Ø³Ø¨ÙŠ</th><th>Ø³ÙÙ„Ù‘Ù… (1â€“5)</th><th>Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ù…ÙˆØ²ÙˆÙ†</th></tr></thead>
    <tbody id="rows"></tbody>
    <tfoot><tr><th style="text-align:right">Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ø£Ø¯Ø§Ø¡ (Ù…Ù† 5)</th><th id="sumW">0%</th><th id="avg">0.00</th><th id="sum">0.00</th></tr></tfoot>
  </table>

  <!-- Ø§Ù„Ù‚ÙˆØ© / Ø§Ù„ØªØ­Ø³ÙŠÙ† -->
  <div class="duo">
    <div class="box"><h3>Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</h3><p id="strengths">â€”</p></div>
    <div class="box"><h3>Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ† ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±</h3><p id="improves">â€”</p></div>
  </div>

  <!-- ØªÙˆÙ‚ÙŠØ¹Ø§Øª -->
  <section class="signs">
    <div class="sig"><div id="sigT" class="sig-name">â€”</div><div class="sig-line"></div><div style="font-size:12px;color:#667">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸Ù</div></div>
    <div class="sig"><div class="sig-name" id="sigP">ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</div><div class="sig-line"></div><div style="font-size:12px;color:#667">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</div></div>
  </section>

  <div class="footer" data-hide-on-print>ØªÙ†ÙÙŠØ° ÙˆØªØµÙ…ÙŠÙ…: ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</div>
</div>

<script>
const $=s=>document.querySelector(s), $$=s=>[...document.querySelectorAll(s)];

/* ØªØ§Ø±ÙŠØ® */
(function(){const d=new Date(),days=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];$('#dayTxt').textContent=days[d.getDay()];$('#dateTxt').textContent=d.toLocaleDateString('ar-SA');})();

/* Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ®Ø²ÙŠÙ† */
const K_P='PF_principal', K_DIR='PF_dir', K_SCH='PF_school';

/* ØªØ­Ù…ÙŠÙ„/ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ù…Ø¯Ø±Ø³Ø© Ø¨Ù‚Ù„Ù… ØµØºÙŠØ± (ÙŠØ±ØªØ¨Ø· Ø®ÙˆØ§Ø±Ø²Ù…ÙŠÙ‹Ø§ Ø¨ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª) */
(function initOrg(){
  const dirSaved=localStorage.getItem(K_DIR); const schSaved=localStorage.getItem(K_SCH);
  if(dirSaved) $('#dirTxt').textContent=dirSaved;
  if(schSaved) $('#schTxt').textContent=schSaved;

  $('#editDir').onclick=()=>{const v=prompt('Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©', $('#dirTxt').textContent.trim()); if(v!==null){$('#dirTxt').textContent=(v.trim()||'â€”'); localStorage.setItem(K_DIR,$('#dirTxt').textContent); snap();}};
  $('#editSch').onclick=()=>{const v=prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©', $('#schTxt').textContent.trim()); if(v!==null){$('#schTxt').textContent=(v.trim()||'â€”'); localStorage.setItem(K_SCH,$('#schTxt').textContent); snap();}};
})();

/* ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø­ÙØ¸ */
$('#sigP').textContent=localStorage.getItem(K_P)||$('#sigP').textContent;
$('#sigP').onclick=()=>{const v=prompt('Ø§Ø³Ù… Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©', $('#sigP').textContent.trim()); if(v!==null){$('#sigP').textContent=(v.trim()||'â€”'); localStorage.setItem(K_P,$('#sigP').textContent); snap();}};

/* Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ù„ÙƒÙ„ Ù†Ù…ÙˆØ°Ø¬ */
const GOALS_BANK={
  principal:[
    ['Ø±ÙØ¹ ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ ÙˆØ§Ù„ØªØ±Ø¨ÙˆÙŠ','ØªÙ†ÙÙŠØ° Ø§Ù„Ø®Ø·Ø· Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© ÙˆÙÙ‚ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠØ©','100Ùª'],
    ['ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ','Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„ØºÙŠØ§Ø¨ ÙˆØ§Ù„ØªØ£Ø®Ø±','â‰¤ 5 Ø­Ø§Ù„Ø§Øª'],
    ['ØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ','Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ© Ø§Ù„Ù…ÙˆØ«Ù‘Ù‚Ø©','2 Ø§Ø¬ØªÙ…Ø§Ø¹ Ø´Ù‡Ø±ÙŠÙ‹Ø§']
  ],
  vp:[
    ['Ø±ÙØ¹ ÙØ§Ø¹Ù„ÙŠØ© Ø§Ù„Ø¥Ø´Ø±Ø§Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ','Ø§Ù†ØªØ¸Ø§Ù… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¬Ø¯ÙˆÙ„','100Ùª'],
    ['Ø¯Ø¹Ù… Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ','Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ©','-15Ùª'],
    ['ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±','Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ«Ù‘Ù‚Ø©','4 ØªÙ‚Ø§Ø±ÙŠØ± ÙØµÙ„ÙŠØ©']
  ],
  teacher:[
    ['ØªØ­Ø³ÙŠÙ† Ù†ÙˆØ§ØªØ¬ Ø§Ù„ØªØ¹Ù„Ù…','Ø§Ø±ØªÙØ§Ø¹ Ù…ØªÙˆØ³Ø· Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù…Ø§Ø¯Ø©','+10Ùª'],
    ['ØªÙØ¹ÙŠÙ„ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³ Ø§Ù„Ø­Ø¯ÙŠØ«Ø©','Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ«Ù‘Ù‚Ø©','3 Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª'],
    ['ØªÙˆØ¸ÙŠÙ Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…','Ø­ØµØµ ØªÙˆØ¸Ù Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§','4 Ø­ØµØµ']
  ],
  activity:[
    ['ØªØ¹Ø²ÙŠØ² Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø©','Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙØ¹Ù„ÙŠØ©','â‰¥ 60Ùª'],
    ['ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…Ù†ÙØ°Ø©','Ø±Ø¶Ø§ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆÙÙ‚ Ø§Ø³ØªØ¨Ø§Ù†Ø©','â‰¥ 90Ùª'],
    ['ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø£Ù†Ø´Ø·Ø©','Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù„Ù„Ø¨Ø±Ø§Ù…Ø¬','100Ùª']
  ],
  health:[
    ['Ù†Ø´Ø± Ø§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„ØµØ­ÙŠØ©','Ø¨Ø±Ø§Ù…Ø¬ ØªÙˆØ¹ÙˆÙŠØ© ÙØµÙ„ÙŠØ©','4 Ø¨Ø±Ø§Ù…Ø¬'],
    ['ØªØ¹Ø²ÙŠØ² Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª Ø§Ù„ØµØ­ÙŠØ©','Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ©','-25Ùª'],
    ['Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØµØ­ÙŠØ©','Ø²ÙŠØ§Ø±Ø§Øª Ù…ÙŠØ¯Ø§Ù†ÙŠØ© Ø´Ù‡Ø±ÙŠÙ‹Ø§','2 Ø²ÙŠØ§Ø±Ø©']
  ],
  counselor:[
    ['ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ø³Ù„ÙˆÙƒÙŠ','Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ©','-30Ùª'],
    ['Ø¨Ø±Ø§Ù…Ø¬ ÙˆÙ‚Ø§Ø¦ÙŠØ© ÙˆØ¥Ø±Ø´Ø§Ø¯ÙŠØ©','Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…Ù†ÙØ°Ø©','5 Ø¨Ø±Ø§Ù…Ø¬'],
    ['ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø·Ø· Ø§Ù„Ø¹Ù„Ø§Ø¬ÙŠØ© Ø§Ù„ÙØ±Ø¯ÙŠØ©','Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø¨ØªØ­Ø³Ù† Ù…Ù„Ø­ÙˆØ¸','â‰¥ 80Ùª']
  ],
  lab:[
    ['Ø±ÙØ¹ Ø¬ÙˆØ¯Ø© Ø§Ù„ØªØ¬Ø§Ø±Ø¨','Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ù…Ù†ÙØ°Ø© ÙØ¹Ù„ÙŠÙ‹Ø§','90Ùª Ù…Ù† Ø§Ù„Ù…Ù‚Ø±Ø±Ø©'],
    ['Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ù…Ø®ØªØ¨Ø± ÙˆØ§Ù„Ù…ÙˆØ§Ø¯','Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¬Ø±Ø¯ ÙˆÙ†Ø¸Ø§ÙØ© Ø§Ù„Ø£Ø¯ÙˆØ§Øª','100Ùª'],
    ['ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©','Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©','0 Ù…Ø®Ø§Ù„ÙØ©']
  ],
  kg:[
    ['ØªÙ†Ù…ÙŠØ© Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©','Ø¥ØªÙ‚Ø§Ù† Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø®ØªØ§Ù…ÙŠ','â‰¥ 90Ùª'],
    ['ØªØ­Ø³ÙŠÙ† Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù†Ø´Ø·','Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©','5 Ø£Ù†Ø´Ø·Ø©'],
    ['Ø¥Ø´Ø±Ø§Ùƒ Ø§Ù„Ø£Ø³Ø±Ø©','Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø³Ø± Ø§Ù„Ù…ØªÙØ§Ø¹Ù„Ø©','â‰¥ 70Ùª']
  ]
};
function autoFillGoals(){
  const bank=GOALS_BANK[$('#model').value]||[];
  const slots=[[g1,g1i,g1t],[g2,g2i,g2t],[g3,g3i,g3t]];
  slots.forEach(([a,b,c],i)=>{a.value=bank[i]?.[0]||''; b.value=bank[i]?.[1]||''; c.value=bank[i]?.[2]||'';});
}
function renderGoalChips(){
  const bank=GOALS_BANK[$('#model').value]||[], box=$('#goalChips'); box.innerHTML='';
  bank.forEach(([t,i,v])=>{const b=document.createElement('button'); b.textContent=t; b.onclick=()=>{
    const slots=[[g1,g1i,g1t],[g2,g2i,g2t],[g3,g3i,g3t]];
    for(const [a,b1,c] of slots){ if(!a.value){a.value=t; b1.value=i; c.value=v; break;} }
    snap();
  }; box.appendChild(b);});
}

/* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ */
const RUBRICS={};
/* â€¦ (Ù†ÙØ³ ØªØ¹Ø±ÙŠÙØ§Øª RUBRICS Ù„Ø¯ÙŠÙƒØ› Ø£Ø¨Ù‚ÙŠØªÙ‡Ø§ ÙƒÙ…Ø§ Ù‡ÙŠ) */
RUBRICS.teacher=[{name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",w:10},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",w:10},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",w:10},{name:"Ø§Ù„ØªÙ†ÙˆØ¹ ÙÙŠ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³",w:10},{name:"ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†",w:10},{name:"Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ†ÙÙŠØ° Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù…",w:10},{name:"ØªÙˆØ¸ÙŠÙ ØªÙ‚Ù†ÙŠØ§Øª ÙˆÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©",w:10},{name:"ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ¦Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©",w:5},{name:"Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙŠØ©",w:5},{name:"ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ† ÙˆØªØ´Ø®ÙŠØµ Ù…Ø³ØªÙˆÙŠØ§ØªÙ‡Ù…",w:10},{name:"ØªÙ†ÙˆØ¹ Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…",w:10}];
/* (Ø¨Ù‚ÙŠØ© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙƒÙ…Ø§ ÙÙŠ Ù†Ø³Ø®ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©) */
RUBRICS.activity=[{name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",w:10},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",w:10},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",w:10},{name:"Ø§Ù„ØªÙ†ÙˆØ¹ ÙÙŠ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³",w:5},{name:"ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†",w:5},{name:"Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ†ÙÙŠØ° Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù…",w:5},{name:"ØªÙˆØ¸ÙŠÙ ØªÙ‚Ù†ÙŠØ§Øª ÙˆÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©",w:5},{name:"ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ¦Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©",w:5},{name:"Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙŠØ©",w:5},{name:"ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ† ÙˆØªØ´Ø®ÙŠØµ Ù…Ø³ØªÙˆÙŠØ§ØªÙ‡Ù…",w:5},{name:"ØªÙ†ÙˆØ¹ Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…",w:5},{name:"Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø© Ø²Ù…Ù†ÙŠØ© Ù…Ø¹ØªÙ…Ø¯Ø© Ù„Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª",w:10},{name:"ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© Ù„Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ø£Ù†Ø´Ø·Ø©",w:5},{name:"Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙˆÙÙ‚ Ù…ÙŠÙˆÙ„Ù‡Ù… Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø§Ù„Ø£Ù†Ø´Ø·Ø©",w:5},{name:"ØªØ­ÙÙŠØ² Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø©",w:10}];
RUBRICS.health=[{name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",w:10},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",w:10},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",w:10},{name:"Ø§Ù„ØªÙ†ÙˆØ¹ ÙÙŠ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³",w:5},{name:"ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†",w:5},{name:"Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ†ÙÙŠØ° Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù…",w:5},{name:"ØªÙˆØ¸ÙŠÙ ØªÙ‚Ù†ÙŠØ§Øª ÙˆÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©",w:5},{name:"ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ¦Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©",w:5},{name:"Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙŠØ©",w:5},{name:"ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ† ÙˆØªØ´Ø®ÙŠØµ Ù…Ø³ØªÙˆÙŠØ§ØªÙ‡Ù…",w:5},{name:"ØªÙ†ÙˆØ¹ Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…",w:5},{name:"ØªÙ†ÙÙŠØ° Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ù„Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØµØ­ÙŠØ©",w:15},{name:"Ø­ØµØ± Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØµØ­ÙŠØ© Ù„Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†",w:5},{name:"ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©",w:10}];
RUBRICS.kg=[{name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",w:10},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",w:5},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",w:5},{name:"Ø§Ù„ØªÙ†ÙˆØ¹ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª",w:5},{name:"ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¹Ù„Ù…",w:5},{name:"Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø© Ø´Ø§Ù…Ù„Ø© ÙˆØªÙØµÙŠÙ„ÙŠØ© Ù„Ù„Ø£Ù†Ø´Ø·Ø©",w:5},{name:"ØªØµÙ…ÙŠÙ… Ø®Ø¨Ø±Ø§Øª ØªØ¹Ù„Ù… Ù…Ø±Ù†Ø© ÙˆÙ…Ø¨ØªÙƒØ±Ø©",w:5},{name:"ØªÙˆØ¸ÙŠÙ ØªÙ‚Ù†ÙŠØ§Øª ÙˆÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©",w:5},{name:"Ø§Ù„ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©",w:5},{name:"Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª ØªØ¯Ø±ÙŠØ³ ÙØ§Ø¹Ù„Ø©",w:5},{name:"Ø¥Ø´Ø±Ø§Ùƒ Ø§Ù„Ø£Ø³Ø±Ø©",w:5},{name:"ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ¦Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø¢Ù…Ù†Ø©",w:15},{name:"ØªØ¹Ø²ÙŠØ² Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ",w:5},{name:"ØªÙ‚ÙŠÙŠÙ… ØªÙ‚Ø¯Ù… Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†",w:5},{name:"ØªÙ†ÙˆØ¹ Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…",w:5},{name:"Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø©",w:5},{name:"Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ø§Ù„Ù…Ù‡Ù†ÙŠ",w:5},{name:"Ø¯Ø¹Ù… Ø§Ù„Ù‚ÙŠÙ… ÙˆØ§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª",w:5},{name:"ØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù„ØºÙˆÙŠØ© ÙˆØ§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©",w:5}];
RUBRICS.lab=[{name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",w:10},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",w:10},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",w:10},{name:"Ø§Ù„ØªÙ†ÙˆØ¹ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª",w:10},{name:"ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†",w:10},{name:"Ø®Ø·Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©",w:5},{name:"Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„ÙÙ†ÙŠØ©",w:5},{name:"ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª",w:5},{name:"Ø§Ù„Ø³Ù„Ø§Ù…Ø©",w:5},{name:"ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…Ø®ØªØ¨Ø±",w:5},{name:"ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ÙˆØªØ®Ø²ÙŠÙ†Ù‡Ø§",w:5},{name:"ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ù„Ù„Ø£Ù†Ø´Ø·Ø©",w:10},{name:"ØªÙ‚Ø§Ø±ÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©",w:10}];
RUBRICS.counselor=[{name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",w:20},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",w:5},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",w:5},{name:"ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·",w:5},{name:"Ø±ÙØ¹ Ø§Ù„Ø¯Ø§ÙØ¹ÙŠØ©",w:5},{name:"Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø© Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡",w:10},{name:"Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª ÙˆØ¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø¯Ø¹Ù…",w:10},{name:"ØªØ¹Ø²ÙŠØ² Ø§Ù„Ù‚ÙŠÙ… ÙˆØ§Ù„Ø³Ù„ÙˆÙƒÙŠØ§Øª",w:10},{name:"Ø£Ù†Ø´Ø·Ø© Ø¥Ø±Ø´Ø§Ø¯ÙŠØ©",w:10},{name:"Ù…Ø³Ø§Ù†Ø¯Ø© Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…Ù‡Ù†ÙŠ",w:5},{name:"ØªØ¹Ø²ÙŠØ² Ø§Ù„ØªÙÙˆÙ‚ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ",w:5},{name:"ØªØ¯Ø®Ù„Ø§Øª Ù„Ù„Ù…ØªØ¹Ø«Ø±ÙŠÙ†",w:5},{name:"ØªÙˆØ¹ÙŠØ© Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ± Ø¨Ø§Ù„Ø³Ù„ÙˆÙƒ ÙˆØ§Ù„Ù…ÙˆØ§Ø¸Ø¨Ø©",w:5}];
RUBRICS.principal=[{name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",w:5},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",w:5},{name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",w:5},{name:"Ø§Ù„Ù…Ø±ÙˆÙ†Ø© ÙÙŠ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„",w:5},{name:"Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ù†ÙˆØ¹ÙŠØ©",w:5},{name:"ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ",w:5},{name:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø¨ÙƒÙØ§Ø¡Ø©",w:5},{name:"Ø®Ø·Ø© Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ù†ÙŠ",w:5},{name:"Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡",w:5},{name:"ØªÙ†ÙÙŠØ° Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ·ÙˆÙŠØ±",w:5},{name:"ØªÙ‚ÙŠÙŠÙ… Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø³ÙˆØ¨ÙŠÙ†",w:5},{name:"ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¹Ù„Ù… Ø¹Ù„Ù…ÙŠÙ‹Ø§",w:15},{name:"Ø±ÙØ¹ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©",w:10},{name:"Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø·Ø· Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©",w:5},{name:"Ù…ØªØ§Ø¨Ø¹Ø© ØªÙ†ÙÙŠØ° Ø§Ù„Ø®Ø·Ø·",w:5},{name:"Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø©",w:5},{name:"ØªÙˆØ¸ÙŠÙ Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©",w:5},{name:"ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ",w:5},{name:"ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ¦Ø© Ù…Ø¯Ø±Ø³ÙŠØ© Ø¢Ù…Ù†Ø©",w:5}];

/* Ø¨Ù†Ùƒ Ø§Ù„Ù‚ÙˆØ©/Ø§Ù„ØªØ­Ø³ÙŠÙ† (Ù…Ø®ØªØµØ±) */
const BANK_IMPROVE={
  "Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©":{imp:"Ø¶Ø¨Ø· Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„Ø²Ù…Ù†ÙŠ ÙˆØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§.",str:"Ø§Ù†Ø¶Ø¨Ø§Ø· Ù…Ù‡Ù†ÙŠ ÙˆØ§ØªØ³Ø§Ù‚ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ø§Ù…."},
  "Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ":{imp:"ØªÙØ¹ÙŠÙ„ Ù…Ø´Ø§Ø±ÙƒØ© Ù…ÙˆØ«Ù‚Ø© ÙÙŠ PLC/ÙˆØ±Ø´.",str:"Ù…Ø´Ø§Ø±ÙƒØ© ÙØ§Ø¹Ù„Ø© ÙÙŠ ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø®Ø¨Ø±Ø§Øª."},
  "Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±":{imp:"Ø®Ø·Ø© ØªÙˆØ§ØµÙ„ Ø¯ÙˆØ±ÙŠØ© Ù…ÙˆØ«Ù‚Ø©.",str:"Ù‚Ù†ÙˆØ§Øª ØªÙˆØ§ØµÙ„ Ù…Ù†ØªØ¸Ù…Ø© Ø¯Ø§Ø¹Ù…Ø©."},
  "Ø§Ù„ØªÙ†ÙˆØ¹ ÙÙŠ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³":{imp:"ØªØ·Ø¨ÙŠÙ‚ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ù†Ø´Ø·Ø© ÙˆÙ…Ù„Ø§Ø­Ø¸Ø© Ù„Ø§Ø­Ù‚Ø©.",str:"ØªÙ†ÙˆÙŠØ¹ Ù…Ù„Ø­ÙˆØ¸ ÙÙŠ Ø§Ù„Ø£Ø³Ø§Ù„ÙŠØ¨."},
  "ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†":{imp:"Ø®Ø·Ø© Ø¹Ù„Ø§Ø¬ÙŠØ© Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬.",str:"ØªØ­Ø³Ù† Ù…Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù†ÙˆØ§ØªØ¬."},
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙŠØ©":{imp:"ØªØ¹Ø²ÙŠØ² Ø§Ù„ØªÙ†Ø¸ÙŠÙ… ÙˆØ§Ù„ØªØ­ÙÙŠØ² ÙˆØ§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„ØµÙÙŠØ©.",str:"Ø¥Ø¯Ø§Ø±Ø© ÙØ§Ø¹Ù„Ø© Ù„Ù„Ø³Ù„ÙˆÙƒ."},
  "ØªÙ†ÙˆØ¹ Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…":{imp:"Ø¥Ø¯Ø±Ø§Ø¬ ØªÙ‚ÙˆÙŠÙ…Ø§Øª Ø£Ø¯Ø§Ø¦ÙŠØ© ÙˆØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬.",str:"ØªÙ‚ÙˆÙŠÙ…Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø£Ù‡Ø¯Ø§Ù."},
  "ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ¦Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©":{imp:"ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙ†Ø¸ÙŠÙ… ÙˆØ§Ù„ÙˆØ³Ø§Ø¦Ù„ ÙˆØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©.",str:"Ø¨ÙŠØ¦Ø© ØµÙÙŠØ© Ù…Ù†Ø¸Ù…Ø© ÙˆØ¬Ø§Ø°Ø¨Ø©."},
  "Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ†ÙÙŠØ° Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù…":{imp:"ØªØ­ÙŠÙŠÙ† Ø§Ù„Ø®Ø·Ø© ÙˆÙÙ‚ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.",str:"Ø®Ø·Ø© ØªØ¹Ù„Ù… Ù…Ø­ÙƒÙ…Ø© Ø§Ù„ØªÙ†ÙÙŠØ°."},
  "ØªÙˆØ¸ÙŠÙ ØªÙ‚Ù†ÙŠØ§Øª ÙˆÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©":{imp:"Ø¯Ù…Ø¬ Ø£Ø¯ÙˆØ§Øª Ø±Ù‚Ù…ÙŠØ© ÙˆØªÙˆØ«ÙŠÙ‚ Ø¯Ø±ÙˆØ³.",str:"ØªÙˆØ¸ÙŠÙ ÙØ§Ø¹Ù„ Ù„Ù„ØªÙ‚Ù†ÙŠØ©."},
  "ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ† ÙˆØªØ´Ø®ÙŠØµ Ù…Ø³ØªÙˆÙŠØ§ØªÙ‡Ù…":{imp:"Ø¬Ù„Ø³Ø© ØªØ­Ù„ÙŠÙ„ ÙØ¬ÙˆØ§Øª Ù…Ø¹ Ø®Ø·Ø© Ø¹Ù„Ø§Ø¬.",str:"ØªØ­Ù„ÙŠÙ„ Ù…Ù†Ù‡Ø¬ÙŠ ÙˆØ§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø±Ø§Øª."}
};

/* Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
function build(){
  const key=$('#model').value, arr=RUBRICS[key]||[]; const tb=$('#rows'); tb.innerHTML=''; let ws=0;
  arr.forEach((it,i)=>{ws+=it.w;const tr=document.createElement('tr');tr.dataset.w=it.w;
    tr.innerHTML=`<td style="text-align:right"><b style="color:#0c594e">${i+1}</b> â€” <span class="item">${it.name}</span></td>
      <td>${it.w}%</td>
      <td style="text-align:center"><select class="select-mini g"><option>1</option><option>2</option><option selected>3</option><option>4</option><option>5</option></select></td>
      <td style="text-align:center"><span class="s">0.00</span></td>`;
    tb.appendChild(tr);
  });
  $('#sumW').textContent=ws+'%';
  $('#mdlTxt').textContent='Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: '+$('#model').selectedOptions[0].textContent;

  if($('#stage').value==='first'){ autoFillGoals(); }
  renderGoalChips();
  toggleStageLock();
  recalc(); snap();
}

/* Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ®Ø·ÙŠØ· ÙÙ‚Ø· */
function toggleStageLock(){
  const isFirst=$('#stage').value==='first';
  $('#goals').style.display=isFirst?'block':'none';
  const msg='Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ù„Ù„ØªØ®Ø·ÙŠØ· â€” Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©';
  $$('.g').forEach(s=>{ s.disabled=isFirst; s.parentElement.parentElement.classList.toggle('tip',isFirst); s.parentElement.parentElement.setAttribute('data-tip', isFirst?msg:'');});
  $('#gapBtn').disabled=isFirst; $('#archBtn').disabled=isFirst;
  $('#gapBtn').setAttribute('data-tip', isFirst?msg:''); $('#archBtn').setAttribute('data-tip', isFirst?msg:'');
}

/* Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª + Ø¨Ù†Ùƒ Ø§Ù„Ù‚ÙˆØ©/Ø§Ù„ØªØ­Ø³ÙŠÙ† */
function recalc(){
  let total=0, ws=0, n=0,d=0;
  const strengths=[], improves=[];
  $$('#rows tr').forEach(tr=>{
    const w=+tr.dataset.w; ws+=w; const v=+tr.querySelector('.g').value; const item=tr.querySelector('.item').textContent.trim();
    tr.querySelector('.s').textContent=((v/5)*w).toFixed(2); total+=(v/5)*w; n+=v*w; d+=w;
    for(let k=1;k<=5;k++) tr.classList.remove('r'+k); tr.classList.add('r'+v);
    const bank=BANK_IMPROVE[item]||{};
    if(v>=4){ strengths.push(`â€¢ ${bank.str||`ØªÙ…ÙŠÙ‘Ø² ÙÙŠ Â«${item}Â».`}`); }
    if(v<=2){ improves.push(`â€¢ ${bank.imp||`ØªØ·ÙˆÙŠØ± Â«${item}Â» Ø¨Ø®Ø·Ø© Ù‚ØµÙŠØ±Ø© ÙˆØ´ÙˆØ§Ù‡Ø¯ Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©.`}`); }
  });
  const avg=d? n/d : 0;
  $('#sum').textContent=total.toFixed(2); $('#avg').textContent=avg.toFixed(2);
  $('#fill').style.width=Math.min(100,total)+'%';
  $('#kL').textContent=`Ù…Ø¤Ø´Ø± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²: ${total.toFixed(0)}%`;
  $('#kM').textContent=`Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ù‘ÙÙ„Ù‘Ù…: ${avg.toFixed(2)} / 5`;
  $('#kR').textContent=`Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£ÙˆØ²Ø§Ù†: ${ws}%`;
  $('#sigT').textContent=$('#tName').value||'â€”';
  $('#strengths').textContent=strengths.join('\n')||'â€”';
  $('#improves').textContent=improves.join('\n')||'â€”';
}

/* Ø­ÙØ¸ Ù„Ù‚Ø·Ø© Ù„Ù„Ø¬Ù„Ø³Ø© + Ø±Ø¨Ø· Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ */
function snap(){
  const rows=$$('#rows tr').map(tr=>({name:tr.querySelector('.item').textContent,w:+tr.dataset.w,v:+tr.querySelector('.g').value}));
  const data={
    dir:$('#dirTxt').textContent.trim(), school:$('#schTxt').textContent.trim(),
    model:$('#model').selectedOptions[0].textContent, modelKey:$('#model').value,
    stage:$('#stage').selectedOptions[0].textContent, stageKey:$('#stage').value,
    name:$('#tName').value||'â€”', id:$('#tId').value||'', spec:$('#tSpec').value||'', title:$('#tTitle').value||'',
    principal:$('#sigP').textContent.trim(), rows, avg:+$('#avg').textContent, total:+$('#sum').textContent,
    strengths:$('#strengths').textContent, improves:$('#improves').textContent,
    goals:[{t:$('#g1').value||'',i:$('#g1i').value||'',v:$('#g1t').value||''},
           {t:$('#g2').value||'',i:$('#g2i').value||'',v:$('#g2t').value||''},
           {t:$('#g3').value||'',i:$('#g3i').value||'',v:$('#g3t').value||''}]
  };
  localStorage.setItem('PF_session',JSON.stringify(data));
  return data;
}

/* ÙØªØ­ Ø§Ù„ØµÙØ­Ø§Øª */
function openGap(){snap(); if($('#stage').value==='first'){return} window.open('gap.html','_blank');}
function openArch(){snap(); if($('#stage').value==='first'){return} window.open('kashf.html','_blank');}

/* Ø£Ø­Ø¯Ø§Ø« */
document.addEventListener('change',e=>{
  if(e.target.classList.contains('g')){recalc();snap();}
  if(e.target.id==='model'){build();}
  if(e.target.id==='stage'){toggleStageLock(); if(e.target.value==='first'){autoFillGoals();} snap();}
});
$('#saveBtn').onclick=()=>{snap(); alert('ØªÙ… Ø§Ù„Ø­ÙØ¸');};
$('#gapBtn').onclick=openGap; $('#archBtn').onclick=openArch;
$('#printBtn').onclick=()=>window.print();
$('#clearBtn').onclick=()=>{ $$('.g').forEach(s=>s.value='3'); ['tName','tId','tSpec','tTitle','g1','g1i','g1t','g2','g2i','g2t','g3','g3i','g3t'].forEach(id=>document.getElementById(id).value=''); recalc(); snap(); };

/* Ø¹Ø¯Ø³Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡: Ø§Ø³ØªÙŠØ±Ø§Ø¯ + Ø¨Ø­Ø« */
const K_NAMES='PF_names';
const getN=()=>JSON.parse(localStorage.getItem(K_NAMES)||'[]');
const setN=a=>localStorage.setItem(K_NAMES,JSON.stringify(a));
function norm(s){return String(s||'').toLowerCase().replace(/[ \u200f\u200e._\-:ØŒ,]/g,'');}
function headerMap(head){
  const map={}, H=head.map(h=>String(h||'').trim());
  const prefer=(p, i)=>{ if(map[p]==null) map[p]=i; };
  H.forEach((h,i)=>{const n=norm(h);
    if(/(name|fullname|Ø§Ù„Ø§Ø³Ù…)/.test(n)) prefer('name',i);
    if(/(id|nid|Ø§Ù„Ù‡ÙˆÙŠØ©|Ø±Ù‚Ù…|Ø³Ø¬Ù„)/.test(n)) prefer('id',i);
    if(/(spec|major|Ø§Ù„ØªØ®ØµØµ)/.test(n)) prefer('spec',i);
    if(/(title|role|position|Ø§Ù„Ù…Ø³Ù…Ù‰)/.test(n)) prefer('title',i);
  }); return map;
}
function guessRow(row){
  const flat=row.map(x=>String(x||'').trim());
  let id=flat.find(v=>/^\d{9,12}$/.test(v))||''; let name=flat.find(v=>v && !/^\d/.test(v))||'';
  const rest=flat.filter(v=>v!==id && v!==name); let spec=rest[0]||'', title=rest[1]||'';
  return {name,id,spec,title};
}
function renderNames(){
  const a=getN().slice().sort((x,y)=>String(x.name||'').localeCompare(String(y.name||''),'ar'));
  $('#stats').textContent=a.length?`Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡: ${a.length}`:'';
  const q=$('#q').value?.trim().toLowerCase(); const body=$('#namesBody'); body.innerHTML='';
  a.filter(o=>!q || [o.name,o.id,o.spec,o.title].some(v=>String(v||'').toLowerCase().includes(q)))
   .forEach(o=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${o.name||'â€”'}</td><td>${o.id||'â€”'}</td><td>${o.spec||'â€”'}</td><td>${o.title||'â€”'}</td>`;
      tr.onclick=()=>{ tName.value=o.name||''; tId.value=o.id||''; tSpec.value=o.spec||''; tTitle.value=o.title||''; $('#lens').style.display='none'; recalc(); snap(); };
      body.appendChild(tr);
   });
}
$('#lensBtn').onclick=()=>{const p=$('#lens'); p.style.display=(p.style.display==='block')?'none':'block'; renderNames();};
document.addEventListener('click',e=>{ if(!e.target.closest('.namewrap')) $('#lens').style.display='none'; });
let qTimer=null; $('#q').addEventListener('input',()=>{clearTimeout(qTimer); qTimer=setTimeout(renderNames,120);});
$('#purge').onclick=()=>{setN([]); renderNames();};
$('#sample').onclick=()=>{ setN([{name:'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',id:'1012345678',spec:'Ø±ÙŠØ§Ø¶ÙŠØ§Øª',title:'Ù…Ø¹Ù„Ù…'},{name:'Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ',id:'1023456789',spec:'ÙÙŠØ²ÙŠØ§Ø¡',title:'Ù…Ø¹Ù„Ù…'},{name:'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø§Ù„Ù…',id:'1034567891',spec:'Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©',title:'Ù…Ø¹Ù„Ù…'}]); renderNames(); };
$('#pick').onclick=()=>$('#xls').click();
$('#xls').addEventListener('change',async e=>{
  const f=e.target.files[0]; if(!f) return;
  try{
    const ab=await f.arrayBuffer(); const wb=XLSX.read(ab,{type:'array'}); const merged=getN();
    wb.SheetNames.forEach(sn=>{
      const ws=wb.Sheets[sn]; const rows=XLSX.utils.sheet_to_json(ws,{header:1,defval:''}); if(!rows.length) return;
      const head=rows[0], map=headerMap(head);
      for(let r=1;r<rows.length;r++){
        const row=rows[r]; let o={};
        if(Object.keys(map).length){
          o.name=String(row[map.name]??'').trim();
          o.id=String(row[map.id]??'').trim();
          o.spec=String(row[map.spec]??'').trim();
          o.title=String(row[map.title]??'').trim();
          if(!o.name){ o=guessRow(row); }
        }else{ o=guessRow(row); }
        if(o.name){ if(!merged.some(x=>x.name===o.name && x.id===o.id)) merged.push(o); }
      }
    });
    setN(merged); renderNames();
  }catch(err){ console.error(err); alert('ØªØ¹Ø°Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'); }
  e.target.value='';
});

/* Ø¨Ø¯Ø¡: Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ + Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ + ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ */
(function init(){
  $('#stage').value='first';
  build(); recalc(); snap();
})();
</script>
</body>
</html>
