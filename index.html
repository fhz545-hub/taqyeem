<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<title>ูููุฐุฌ ุชูููู ุงูุฃุฏุงุก ุงููุธููู โ ุซุงูููุฉ ุงููุนููุจู</title>

<!-- ุฎุทูุท ุงููููุฉ -->
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&family=Cairo:wght@600;700&display=swap" rel="stylesheet">

<!-- ููุชุจุงุช ุฎุงุฑุฌูุฉ -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
:root{
  --moe-dark:#0c594e;          /* ุงูููู ุงูุฑุณูู */
  --moe-light:#1e8a79;
  --ink:#0b2f2b;
  --bg:#ffffff;
  --border:#e0ece8;
  --muted:#667c76;
  --chip:#f4fbf9;
  --shadow:0 4px 16px rgba(0,0,0,.10);
}
*{box-sizing:border-box;scroll-behavior:smooth}
html,body{
  margin:0; padding:0; background:var(--bg);
  font-family:"Tajawal","Cairo",system-ui; color:var(--ink); line-height:1.6; font-size:15px;
}
#page{
  width:min(1120px,100%); margin:0 auto; padding:10px 12px 60px; background:#fff;
}

/* ุงูุฑุฃุณ */
.header-grid{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;text-align:center;margin-bottom:8px}
.h-left,.h-right{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:2px}
.h-left .line,.h-right .line{font-weight:700;color:var(--moe-dark)}
/* ุฅุฒุงุญุฉ ุงูููู/ุงูุชุงุฑูุฎ ูููููุง ุจุนูุฏูุง ุนู ุงูุดุนุงุฑ */
.h-right{align-items:flex-start;padding-inline-start:52px;transform:translateX(10px)}
#moeLogo{width:min(220px,40vw);height:auto;object-fit:contain;filter:drop-shadow(0 2px 6px rgba(0,0,0,.15))}

/* ุฃุฒุฑุงุฑ ุตุบูุฑุฉ ููุชุนุฏูู */
.edit-icon{font-size:12px;border:1px solid var(--border);background:#fff;padding:1px 6px;border-radius:8px;cursor:pointer;margin-inline-start:4px}

/* ุตู ุงูุชุญูู ุงูุนููู */
.toolbar{
  display:grid; grid-template-columns:1fr 1fr repeat(8,auto);
  gap:8px; align-items:center; margin:10px 0;
}
.select-compact{
  appearance:none;width:100%;height:34px; padding:0 30px 0 10px;
  border:1px solid var(--border);border-radius:999px;background:#fff;
  font-weight:800;color:#0c3f39;cursor:pointer;font-size:13px
}
.toolbar .ico{position:absolute;inset-inline-end:10px;top:50%;transform:translateY(-50%);pointer-events:none}

/* ุงูุฃุฒุฑุงุฑ */
.pill{
  border:1px solid var(--border);border-radius:12px;padding:8px 12px;
  font-weight:800;background:linear-gradient(180deg,#ffffff,#f7fffd);
  cursor:pointer;color:var(--moe-dark);transition:all .2s;font-size:13px;white-space:nowrap
}
.pill:hover{background:linear-gradient(180deg,#f9fefc,#e8f7f3)}
.pill.primary{background:linear-gradient(180deg,var(--moe-light),var(--moe-dark));color:#fff;border-color:var(--moe-dark)}
.pill.primary:hover{opacity:.92}

/* ุงูุฌุฏูู */
.table{width:100%;border-collapse:collapse;border:1px solid var(--border);border-radius:12px;overflow:hidden}
.table th,.table td{border:1px solid var(--border);padding:8px}
.table th{background:var(--moe-light);color:#fff}
.table td{text-align:center}

/* ุนููุฏ ุณูู ุงูุชูุฏูุฑ โ ุจุฏูู ุญุฏูุฏ ูุนูุตุฑ ุงูุงุฎุชูุงุฑ ููุท */
.select-mini{
  appearance:none;background:#fff;border:none; /* ุฅุฒุงูุฉ ุงูุญุฏูุฏ ุงููุทููุจุฉ */
  border-radius:10px;padding:4px 8px;font-weight:900;color:#0b3430;outline:none
}
.select-mini:focus{outline:2px solid #bfe8df;}

/* ุฃููุงู ุงูุตู ุญุณุจ ุงูุณูู */
tr.rate-1{background:linear-gradient(90deg,#fee2e2 0,#fff 60%)}
tr.rate-2{background:linear-gradient(90deg,#fde68a 0,#fff 60%)}
tr.rate-3{background:linear-gradient(90deg,#f0fdf4 0,#fff 60%)}
tr.rate-4{background:linear-gradient(90deg,#dcfce7 0,#fff 60%)}
tr.rate-5{background:linear-gradient(90deg,#bbf7d0 0,#fff 60%)}

/* ูุคุดุฑ ุงูุฅูุฌุงุฒ */
.kpi-wrap{position:relative;margin:12px 0}
.kpi-bar{position:relative;height:16px;border-radius:999px;overflow:hidden;border:1px solid #e9f4f1}
.kpi-fill{position:absolute;inset:0;width:0%;background:linear-gradient(90deg,#f87171,#fbbf24,#34d399,#10b981);opacity:.95;transition:width .5s}
.kpi-waves{position:absolute;left:0;bottom:0;height:42px;width:200%;background:radial-gradient(circle at 25% 120%, rgba(255,255,255,.6) 24%, transparent 26%) repeat-x;background-size:40px 40px;animation:waves 3s linear infinite;opacity:.45}
.kpi-label{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);padding:2px 4px}
@keyframes waves{from{transform:translateX(0)}to{transform:translateX(-50%)}}

/* ุงูููุงูุฐ ุงูููุจุซูุฉ */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;z-index:100}
.panel{width:min(900px,95%);max-height:95vh;background:#fff;border-radius:16px;box-shadow:var(--shadow);display:flex;flex-direction:column}
.panel .head{background:var(--moe-dark);color:#fff;font-weight:800;padding:10px 14px;border-top-left-radius:16px;border-top-right-radius:16px;display:flex;justify-content:space-between;align-items:center}
.panel .body{overflow-y:auto;padding:16px;color:var(--ink)}

/* ูุฏุฎูุงุช ุฃุนูู ุงูุจูุงูุงุช */
.data-row{display:grid;grid-template-columns:2fr repeat(3,1fr);gap:8px;margin:10px 0}

/* ุงูุทุจุงุนุฉ */
@media print{
  .no-print,.modal,.toolbar{display:none!important}
  body{background:#fff}
  #page{margin:0 auto;padding:0}
  @page{size:A4;margin:12mm}
}

/* ุนุจุงุฑุฉ ุงูุชุฐููู */
.footer-note{color:#6a7f7b;font-size:12px;text-align:center;margin-top:10px}
@media print{.footer-note{display:none}}
</style>
</head>
<body>
<div id="page">

  <!-- ุฑุฃุณ ุงูุตูุญุฉ -->
  <header class="header-grid">
    <div class="h-left">
      <div class="line">ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ</div>
      <div class="line">ูุฒุงุฑุฉ ุงูุชุนููู</div>
      <div class="line">
        <span id="dirText">ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ ููุชุนููู ุจุงูููุทูุฉ ุงูุดุฑููุฉ</span>
        <button id="editDir" class="edit-icon no-print" title="ุชุนุฏูู">โ</button>
      </div>
      <div class="line">
        <span id="schoolText">ุซุงูููุฉ ุงููุนููุจู</span>
        <button id="editSchool" class="edit-icon no-print" title="ุชุนุฏูู">โ</button>
      </div>
    </div>

    <div class="h-center">
      <img id="moeLogo" alt="ุดุนุงุฑ ูุฒุงุฑุฉ ุงูุชุนููู" src="ูุฒุงุฑุฉ ุงูุชุนููู.png"
        onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,'+encodeURIComponent(`<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'220\' height=\'90\'><rect fill=\'white\' width=\'100%\' height=\'100%\'/><text x=\'50%\' y=\'55%\' dominant-baseline=\'middle\' text-anchor=\'middle\' font-family=\'Tajawal\' font-weight=\'800\' font-size=\'20\' fill=\'#1e8a79\'>ูุฒุงุฑุฉ ุงูุชุนููู</text></svg>`)"/>
    </div>

    <!-- ุงูููู/ุงูุชุงุฑูุฎ/ุงููููุฐุฌ โ ุฃูุฒูุญุช ูููููุง -->
    <div class="h-right">
      <div id="todayTxt" class="line" style="font-weight:800;color:#16544c"></div>
      <div id="dateTxt"  class="line" style="font-weight:700;color:#466e69"></div>
      <div id="modelTxt" class="line" style="font-weight:800;color:#16544c"></div>
    </div>
  </header>

  <!-- ุดุฑูุท ุฃุฏูุงุช ุนููู (ุตู ูุงุญุฏ) -->
  <section class="toolbar no-print">
    <div style="position:relative">
      <select id="modelSelect" class="select-compact">
        <option value="teacher">ูุนูู</option>
        <option value="vp">ูููู</option>
        <option value="principal">ูุฏูุฑ</option>
        <option value="activity">ุฑุงุฆุฏ ูุดุงุท</option>
        <option value="health">ููุฌู ุตุญู</option>
        <option value="counselor">ููุฌู ุทูุงุจู</option>
        <option value="lab">ูุญุถุฑ ูุฎุชุจุฑ</option>
        <option value="kg">ูุนููุฉ ุฑูุงุถ ุฃุทูุงู</option>
      </select>
      <span class="ico">โพ</span>
    </div>
    <div style="position:relative">
      <select id="stageSelect" class="select-compact">
        <option value="planning">ุงูุชุฎุทูุท</option>
        <option value="mid">ุงููุฑุงุฌุนุฉ ุงููุตู ุณูููุฉ</option>
        <option value="final">ุงูุชูููู ุงูููุงุฆู</option>
      </select>
      <span class="ico">โพ</span>
    </div>

    <button id="btnGapPlan" class="pill primary">ุฎุทุฉ ุชุญุณูู ูุฌูุฉ ุงูุฃุฏุงุก</button>
    <button id="openHelp" class="pill">โน๏ธ ุงูุดุฑุญ</button>
    <button id="openRubrics" class="pill">๐ ุงูุฃุฏููุฉ</button>
    <button id="btnPrint" class="pill">๐จ๏ธ ุทุจุงุนุฉ</button>
    <button id="btnPdf" class="pill">๐งพ PDF</button>
    <button id="btnSave" class="pill">๐พ ุญูุธ</button>
    <button id="btnClear" class="pill">๐งน ูุณุญ</button>
    <button id="btnWhatsApp" class="pill">๐ฌ ูุงุชุณุงุจ</button>
  </section>

  <!-- ุจูุงูุงุช ุงูููุธู -->
  <section class="data-row no-print">
    <div style="position:relative">
      <input id="tName" class="lined" placeholder="ุงุณู ุงููุนูู" style="height:42px;border:1px solid var(--border);border-radius:12px;padding:0 42px 0 10px;width:100%">
      <span class="in-icon" id="openMini" style="position:absolute;inset-inline-start:10px;top:50%;transform:translateY(-50%);font-weight:900;color:#0b534b;cursor:pointer">๐</span>
    </div>
    <input id="tId"   class="lined" inputmode="numeric" placeholder="ุฑูู ุงููููุฉ" style="height:42px;border:1px solid var(--border);border-radius:12px;padding:0 10px">
    <input id="tSpec" class="lined" placeholder="ุงูุชุฎุตุต"    style="height:42px;border:1px solid var(--border);border-radius:12px;padding:0 10px">
    <input id="tRank" class="lined" placeholder="ุงููุฑุชุจุฉ/ุงูุฑุชุจุฉ" style="height:42px;border:1px solid var(--border);border-radius:12px;padding:0 10px">
  </section>

  <!-- ูุคุดุฑ ุงูุฅูุฌุงุฒ + ูุชูุณุท ุงูุณูู -->
  <div class="kpi-wrap">
    <div class="kpi-bar">
      <div class="kpi-fill" id="kpiFill"></div>
      <div class="kpi-waves" id="kpiWaves"></div>
    </div>
    <div class="kpi-label">
      <div id="kpiLabelL">ูุคุดุฑ ุงูุฅูุฌุงุฒ: 0%</div>
      <div id="kpiLabelM">ุณูููู ุงูุชูุฏูุฑ (ูุชูุณุท): 0.00 / 5</div>
      <div id="kpiLabelR">ูุฌููุน ุงูุฃูุฒุงู: 0%</div>
    </div>
  </div>

  <!-- ุฌุฏูู ุงูุชูููู -->
  <section id="rubric">
    <table class="table">
      <thead>
        <tr>
          <th class="items" style="text-align:right">ุนูุงุตุฑ ุงูุชูููู</th>
          <th class="weight">ุงููุฒู ุงููุณุจู</th>
          <th class="scale">ุณูููู ุงูุชูุฏูุฑ (1โ5)</th>
          <th class="result">ุงููุงุชุฌ ุงูููุฒูู</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
      <tfoot>
        <tr>
          <th style="text-align:right">ุงูุชูุฏูุฑ ุงูุนุงู ููุฃุฏุงุก (ูู 5)</th>
          <th id="sumWeight">0%</th>
          <th id="avgOutOf5" style="font-weight:900;color:#ffffff">0.00</th>
          <th id="sumScore">0.00</th>
        </tr>
      </tfoot>
    </table>
  </section>

  <!-- ุงูููุฉ / ุงูุชุญุณูู -->
  <section style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:12px 0">
    <div style="border:1px solid var(--border);background:#fff;border-radius:12px;padding:10px">
      <h3 style="margin:0 0 6px;color:#0c594e">ููุงุท ุงูููุฉ</h3>
      <p id="strengthsBox" style="white-space:pre-line;margin:0">โ</p>
    </div>
    <div style="border:1px solid var(--border);background:#fff;border-radius:12px;padding:10px">
      <h3 style="margin:0 0 6px;color:#0c594e">ูุฌุงูุงุช ุงูุชุญุณูู ูุงูุชุทููุฑ</h3>
      <p id="improveBox" style="white-space:pre-line;margin:0">โ</p>
    </div>
  </section>

  <!-- ุงูุชูููุน -->
  <section class="sign-section" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:14px 0">
    <div style="text-align:center">
      <div id="signTeacherName" style="font-weight:800;color:#0c594e;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">โ</div>
      <div style="border-top:1px dashed #bcd3cd;margin-top:6px;width:80%;margin-inline:auto"></div>
      <div style="font-size:12px;color:#667">ุชูููุน ุงููุนูู</div>
    </div>
    <div style="text-align:center">
      <div id="signPrincipalName" style="font-weight:800;color:#0c594e;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">ููุฏ ุญุงูุฏ ุนูู ุงูุฒูุฑุงูู</div>
      <div style="border-top:1px dashed #bcd3cd;margin-top:6px;width:80%;margin-inline:auto"></div>
      <div style="font-size:12px;color:#667">ุชูููุน ูุฏูุฑ ุงููุฏุฑุณุฉ</div>
    </div>
  </section>

  <!-- ุนุฏุณุฉ ุงูุฃุณูุงุก -->
  <div class="mini modal" id="mini" style="display:none">
    <div class="panel" style="width:min(900px,96%)">
      <div class="head">
        <div>ุนุฏุณุฉ ุงูุฃุณูุงุก ุงูุฐููุฉ</div>
        <button id="miniClose" class="pill" style="background:#fff;color:#0c594e;border-color:#fff">โ ุฅุบูุงู</button>
      </div>
      <div class="body">
        <div class="row" style="display:grid;grid-template-columns:1fr auto;gap:8px">
          <input id="qName" class="lined" placeholder="ุงุจุญุซ ุนู ุงุณู" style="height:40px;border:1px solid var(--border);border-radius:12px;padding:0 10px">
          <div style="display:flex;gap:8px;align-items:center">
            <input type="file" id="xlsInput" accept=".xlsx,.xls,.csv" style="display:none"/>
            <button id="btnPickFile" class="pill">โฌ๏ธ ุงุณุชูุฑุงุฏ ููู</button>
            <button id="btnTpl" class="pill">โฌ๏ธ ูุงูุจ Excel</button>
          </div>
        </div>
        <div id="nameStats" style="margin-top:6px;color:#667"></div>
        <div id="nameList" style="max-height:320px;overflow:auto;border:1px solid var(--border);border-radius:12px;padding:8px;margin-top:8px"></div>
      </div>
    </div>
  </div>

  <!-- ูุงูุฐุฉ ุงูุดุฑุญ (ุงููุญุชูู ุงููุทููุจ ูุงูููุง) -->
  <div class="modal" id="helpModal">
    <div class="panel" id="helpPanel" style="width:min(900px,96%)">
      <div class="head">
        <div>๐น ุงูุดุฑุญ</div>
        <button data-close="#helpModal" class="pill" style="background:#fff;color:#0c594e;border-color:#fff">โ ุฅุบูุงู</button>
      </div>
      <div class="body" style="font-size:14px">
        <p><strong>ุฃุฏุงุฉ ุฅููุชุฑูููุฉ ูุณุงููุฏุฉ ูุชุนุจุฆุฉ ูุชูุซูู ุชูููู ุงูุฃุฏุงุก ุงููุธููู ูกูคูคูงูู ูููุนูููู ูุงูููุฆุฉ ุงูุชุนููููุฉ ููู ุฏููู ูุฒุงุฑุฉ ุงูุชุนููู.</strong></p>
        <p>ูุชูุญ ุงููููุน:</p>
        <ul>
          <li>ุงุฎุชูุงุฑ ูุฑุญูุฉ ุงูุชูููู (ุงูุฃูููุ ุงูุซุงููุฉุ ุงูููุงุฆูุฉ).</li>
          <li>ุชุนุจุฆุฉ ุงูุจููุฏ ูุชูุฏูุฑูุง ุขูููุง ุจุฏุฑุฌุงุช ูู 1 ุฅูู 5.</li>
          <li>ุงุณุชุฎุฑุงุฌ ููุงุท ุงูููุฉ ููุฌุงูุงุช ุงูุชุทููุฑ ุชููุงุฆููุง.</li>
          <li>ุฅุนุฏุงุฏ ุฎุทุฉ ุชุญุณูู ูุฌูุฉ ุงูุฃุฏุงุก ูุทุจุงุนุชูุง ุฃู ุญูุธูุง PDF.</li>
          <li>ุงุณุชูุฑุงุฏ ุฃุณูุงุก ุงููุนูููู ูู ููู Excel ูุชุณููู ุงููุชุงุจุนุฉ.</li>
        </ul>
        <p><strong>โ๏ธ ุฅุฎูุงุก ุงููุณุคูููุฉ</strong></p>
        <p>ูุฐุง ุงููููุน ุฃุฏุงุฉ ูุณุงูุฏุฉ ุบูุฑ ุฑุณููุฉ ูุชูุณูุฑ ุงูุนูู ุฏุงุฎู ุงููุฏุฑุณุฉุ ููุง ููุนุชูุฏ ุจุฏููุงู ุนู ุงูููุงุฐุฌ ุงูุฑุณููุฉ ูู ูุธุงู ูุงุฑุณ ุฃู ููุฑ.<br>
        ุฌููุน ุงูุจูุงูุงุช ูุงููุฎุฑุฌุงุช ูุณุคูููุฉ ุงููุณุชุฎุฏูุ ููููุตุญ ุจุงูุชุญูู ูููุง ูุจู ุงูุงุนุชูุงุฏ ุฃู ูุดุงุฑูุชูุง ุฎุงุฑุฌ ูุทุงู ุงููุฏุฑุณุฉ.</p>
        <p><strong>๐ฉ ูุฃู ุงุณุชูุณุงุฑ ุฃู ููุงุญุธุฉ: </strong><a href="mailto:fhz545@gmail.com">fhz545@gmail.com</a></p>
      </div>
    </div>
  </div>

  <!-- ูุงูุฐุฉ ุงูุฃุฏูุฉ (ุงููุญุชูู ุงููุทููุจ ูุงูููุง) -->
  <div class="modal" id="reportsModal">
    <div class="panel" id="reportsPanel" style="width:min(900px,96%)">
      <div class="head">
        <div>๐ ุงูุฃุฏููุฉ โ ูุฎุชุตุฑ ูกูคูคูงูู</div>
        <button data-close="#reportsModal" class="pill" style="background:#fff;color:#0c594e;border-color:#fff">โ ุฅุบูุงู</button>
      </div>
      <div class="body" style="font-size:14px">
        <ol>
          <li><strong>ุงููุฏู ุงูุนุงู:</strong> ุฑูุน ููุงุกุฉ ุงููุนูููู ูุชุญููุฒ ุงูุชููุฒ ูุงูุฅูุชุงุฌูุฉ ุนุจุฑ ุฅุฏุงุฑุฉ ุฃุฏุงุก ููููุฉ ูุณุชูุฑุฉ.</li>
          <li><strong>ูุฑุงุญู ุงูุชูููู:</strong>
            <ul>
              <li>๐ฉ ุงูุชุฎุทูุท: ุชุญุฏูุฏ ุงูุฃูุฏุงู ูููุซุงู ุงูุฃุฏุงุก.</li>
              <li>๐จ ุงููุฑุงุฌุนุฉ ุงููุตู ุณูููุฉ: ูุชุงุจุนุฉ ุงูุฅูุฌุงุฒ ูุชูุฏูู ุงูุชุบุฐูุฉ ุงูุฑุงุฌุนุฉ.</li>
              <li>๐ฅ ุงูุชูููู ุงูููุงุฆู: ููุงุณ ุงูุฃุฏุงุก ูุฅุนุฏุงุฏ ุฎุทุฉ ุชุญุณูู ูุฌูุฉ ุงูุฃุฏุงุก.</li>
            </ul>
          </li>
          <li><strong>ุนูุงุตุฑ ุงูุชูููู ุงูุฃุณุงุณูุฉ:</strong> ุงููุงุฌุจุงุช ุงููุธูููุฉ โ ุงูุชูุงุนู ุงููููู โ ุฃูููุงุก ุงูุฃููุฑ โ ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฏุฑูุณ โ ุงูุชูููู โ ุจูุฆุฉ ุงูุชุนูู โ ุงูุชุญุตูู ุงูุฏุฑุงุณู.</li>
          <li><strong>ุณูููู ุงูุชูุฏูุฑ:</strong> 5 ูุชุฌุงูุฒ ุงูุชููุนุงุช โ 4 ูุชููุฒ โ 3 ููุงูู โ 2 ุจุญุงุฌุฉ ูุชุทููุฑ โ 1 ุบูุฑ ูุฑุถู</li>
          <li><strong>ุงููุฑุฌุน ุงููุธุงูู:</strong> ูุงุฆุญุฉ ุงููุธุงุฆู ุงูุชุนููููุฉ โ ุฅุทุงุฑ ุงูุนูู ุงูุชูุธููู โ ุงูุฏููู ุงูุฅุฑุดุงุฏู ููุฃุฏุงุก ุงููุธููู (ุงูุฅุตุฏุงุฑ ุงูุซุงูู 1447ูู).</li>
          <li><strong>ุฎุทุฉ ุงูุชุญุณูู (IDP):</strong> ุชูุจูู ุนูู ุชุญุฏูุฏ ุงููุฌูุงุชุ ููุถุน ุฃูุฏุงู ูุฅุฌุฑุงุกุงุช ูุงุจูุฉ ููููุงุณ ูุงููุชุงุจุนุฉ.</li>
          <li><strong>ุงููุณุคูููุงุช:</strong> ุงููุฒุงุฑุฉ: ุงูุณูุงุณุงุช ูุงููุชุงุจุนุฉ โ ุงูุฅุฏุงุฑุฉ: ุงูุฅุดุฑุงู โ ุงููุฏูุฑ: ุงูุชูููู โ ุงููุนูู: ุงูุงูุชุฒุงู ูุงูุชุทููุฑ ุงูุฐุงุชู.</li>
        </ol>
        <p style="color:#a33"><strong>โ๏ธ ุชูุจูู:</strong> ูุฐุง ุงูููุฎูุต ููุงุณุชุฎุฏุงู ุงูุชุฑุจูู ุงูุฏุงุฎููุ ููุง ููุบูู ุนู ุงูุฃุฏูุฉ ุงูุฑุณููุฉ ุงูุตุงุฏุฑุฉ ูู ูุฒุงุฑุฉ ุงูุชุนููู.</p>
      </div>
    </div>
  </div>

  <!-- ุฎุทุฉ ูุฌูุฉ ุงูุฃุฏุงุก (ูุชุนุฏุฏุฉ ุงููุฌูุงุช) -->
  <div class="modal" id="gapModal">
    <div class="panel" id="gapPanel" style="width:min(900px,96%);background:#fff">
      <div class="head">
        <div>ุฎุทุฉ ุชุญุณูู ูุฌูุฉ ุงูุฃุฏุงุก</div>
        <div style="display:flex;gap:8px">
          <button id="gapPdf" class="pill" style="background:#fff;color:#0c594e;border-color:#fff">๐งพ ุญูุธ PDF</button>
          <button id="gapClose" class="pill" style="background:#fff;color:#0c594e;border-color:#fff">โ ุฅุบูุงู</button>
        </div>
      </div>
      <div class="body" id="gapBody">
        <!-- ุฑุฃุณ ูุทุงุจู -->
        <div class="header-grid" style="margin-bottom:8px">
          <div class="h-left">
            <div class="line">ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ</div>
            <div class="line">ูุฒุงุฑุฉ ุงูุชุนููู</div>
            <div class="line"><span id="g_dirHeader">ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ ููุชุนููู ุจุงูููุทูุฉ ุงูุดุฑููุฉ</span></div>
            <div class="line"><span id="g_schoolHeader">ุซุงูููุฉ ุงููุนููุจู</span></div>
          </div>
          <div class="h-center">
            <img id="g_moeLogo" alt="ุดุนุงุฑ ูุฒุงุฑุฉ ุงูุชุนููู" src="ูุฒุงุฑุฉ ุงูุชุนููู.png"
              onerror="this.onerror=null;this.src=document.getElementById('moeLogo').src" style="width:min(220px,40vw);height:auto;object-fit:contain"/>
          </div>
          <div class="h-right" style="align-items:flex-start;padding-inline-start:52px;transform:translateX(10px)">
            <div id="g_today" style="font-weight:800;color:#16544c"></div>
            <div id="g_date"  style="font-weight:700;color:#466e69"></div>
            <div id="g_model" style="font-weight:800;color:#16544c"></div>
          </div>
        </div>

        <!-- ุจูุงูุงุช ุฃุณุงุณูุฉ -->
        <section style="border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-bottom:10px">
          <table class="table" style="border-radius:0;margin:0;text-align:center">
            <thead><tr><th colspan="4">ุฃููุงู: ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ูุดุงุบู ุงููุธููุฉ ุงูุชุนููููุฉ</th></tr></thead>
            <tbody>
              <tr><td>ุงูุงุณู</td><td id="g_name">โ</td><td>ุงูุฅุฏุงุฑุฉ</td><td id="g_dir">โ</td></tr>
              <tr><td>ุงููุณูู ุงููุธููู</td><td id="g_title">โ</td><td>ุงูุชุฎุตุต</td><td id="g_spec">โ</td></tr>
              <tr><td>ุงููุฏูุฑ ุงููุจุงุดุฑ</td><td id="g_mgr">ููุฏ ุญุงูุฏ ุนูู ุงูุฒูุฑุงูู</td><td>ุงููุฑุญูุฉ</td><td id="g_stage">โ</td></tr>
              <tr><td>ุฌูุฉ ุงูุนูู</td><td id="g_school">โ</td><td>ุงูุนุงู ุงูุฏุฑุงุณู</td><td id="g_year">โ</td></tr>
            </tbody>
          </table>
        </section>

        <!-- ุฃ- ุชุญุฏูุฏ ุงููุฌูุฉ (ุนุฏูุฉ ูุฌูุงุช) -->
        <section style="border:1px solid var(--border);border-radius:12px;padding:10px;margin-top:6px">
          <h3 style="margin:0 0 8px">ุฃ- ุชุญุฏูุฏ ุงููุฌูุฉ</h3>
          <table class="table" style="border-radius:10px;margin:0">
            <thead>
              <tr><th style="width:50%">ุงููุนูุงุฑ ุงููุณุชูุฏู ุชุทููุฑู</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>
            </thead>
            <tbody id="g_targets"></tbody>
          </table>
        </section>

        <!-- ุจ- ุชุญููู ุงูุฃุฏุงุก -->
        <section style="border:1px solid var(--border);border-radius:12px;padding:10px;margin-top:8px">
          <h3 style="margin:0 0 8px">ุจ- ุชุญููู ูุณุชูู ุงูุฃุฏุงุก ุงูุญุงูู</h3>
          <table class="table" style="border-radius:10px;margin:0">
            <thead><tr><th>ุฏุฑุฌุฉ ุงูุชููู</th><th>ุงูุฃุณุจุงุจ</th><th>ููุงุท ุงูููุฉ</th><th>ุงูุฌูุงูุจ ุงูุชู ุจุญุงุฌุฉ ููุชุญุณูู</th></tr></thead>
            <tbody><tr><td id="g_grade" style="font-weight:900"></td><td contenteditable="true" id="g_reasons"></td><td id="g_strengths"></td><td id="g_gaps"></td></tr></tbody>
          </table>
        </section>

        <!-- ุฌ- ุฎุทุฉ ุงูุนูู -->
        <section style="border:1px solid var(--border);border-radius:12px;padding:10px;margin-top:8px">
          <h3 style="margin:0 0 8px">ุฌ- ุฎุทุฉ ุงูุนูู ูุฅูุฌุงุฒ ุงูุชุญุณูู</h3>
          <table class="table" style="border-radius:10px;margin:0">
            <thead><tr><th>ู</th><th>ุงูุฎุทุฉ ุงูุฅุฌุฑุงุฆูุฉ</th><th>ูุชุทูุจุงุช ุงูุชูููุฐ</th><th>ุฒูู ุงูุชูููุฐ</th><th>ุงูุงุญุชูุงุฌุงุช</th><th>ุงููููู</th><th>ุงููุณุงูุฏ</th><th>ูุคุดุฑ ุงูุฃุฏุงุก</th></tr></thead>
            <tbody id="g_actions"></tbody>
          </table>
          <div style="margin-top:6px;font-size:12px;color:#5a7a74">ุงูุฎูุงูุง ูุงุจูุฉ ููุชุญุฑูุฑ ูุจู ุงูุญูุธ.</div>
        </section>

        <!-- ุชุฐููู -->
        <section style="margin-top:10px">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:center">
            <div style="text-align:center;white-space:nowrap"><span id="g_signTeacher">โ</span><div style="border-top:1px dashed #bcd3cd;margin-top:6px;width:80%;margin-inline:auto"></div></div>
            <div style="text-align:center;white-space:nowrap"><span id="g_signPrincipal">ููุฏ ุญุงูุฏ ุนูู ุงูุฒูุฑุงูู</span><div style="border-top:1px dashed #bcd3cd;margin-top:6px;width:80%;margin-inline:auto"></div></div>
          </div>
          <div style="text-align:center;margin-top:6px;font-size:12px;color:#667" id="g_footerDate">โ</div>
        </section>
      </div>
    </div>
  </div>

  <!-- ุนุจุงุฑุฉ ุงูุชุฐููู (ูุฎููุฉ ูู ุงูุทุจุงุนุฉ) -->
  <div class="footer-note no-print">ุชูููุฐ ูุชุตููู: ููุฏ ุญุงูุฏ ุงูุฒูุฑุงูู</div>

</div><!-- /page -->

<script>
/* ุฃุฏูุงุช ูุฎุชุตุฑุฉ */
const $=s=>document.querySelector(s), $$=s=>[...document.querySelectorAll(s)];

/* ุนูุงููู ุงูููุงุฐุฌ */
const TITLE_BY_MODEL={ teacher:'ูุนูู', activity:'ุฑุงุฆุฏ ูุดุงุท', health:'ููุฌู ุตุญู', kg:'ูุนููุฉ ุฑูุงุถ ุฃุทูุงู', lab:'ูุญุถุฑ ูุฎุชุจุฑ', counselor:'ููุฌู ุทูุงุจู', vp:'ูููู', principal:'ูุฏูุฑ' };

/* ุงูููู/ุงูุชุงุฑูุฎ/ุงููููุฐุฌ */
(function(){
  const days=['ุงูุฃุญุฏ','ุงูุงุซููู','ุงูุซูุงุซุงุก','ุงูุฃุฑุจุนุงุก','ุงูุฎููุณ','ุงูุฌูุนุฉ','ุงูุณุจุช'];
  const d=new Date();
  $('#todayTxt').textContent=days[d.getDay()];
  $('#dateTxt').textContent=d.toLocaleDateString('ar-SA');
  $('#modelTxt').textContent='ูููุฐุฌ ุงูุชูููู: โ';
})();

/* ุชุนุฏูู ุงูุฅุฏุงุฑุฉ/ุงููุฏุฑุณุฉ (ุญูุธ ูุญูู) */
function promptEdit(id,key,def){
  const v=prompt("ุฃุฏุฎู ุงููุต:", localStorage.getItem(key)||def||"");
  if(v!==null){ $(id).textContent=v; localStorage.setItem(key,v); }
}
$('#editDir').addEventListener('click',()=> promptEdit('#dirText','dirText',$('#dirText').textContent));
$('#editSchool').addEventListener('click',()=> promptEdit('#schoolText','schoolText',$('#schoolText').textContent));
$('#dirText').textContent    = localStorage.getItem('dirText')    || $('#dirText').textContent;
$('#schoolText').textContent = localStorage.getItem('schoolText') || $('#schoolText').textContent;

/* ุชุญุฑูุฑ ุงุณู ุงููุฏูุฑ ุจุงูุฏุจู ููู */
$('#signPrincipalName').addEventListener('dblclick',()=>{
  const nv=prompt('ุงูุชุจ ุงุณู ูุฏูุฑ ุงููุฏุฑุณุฉ:', localStorage.getItem('principalName')||$('#signPrincipalName').textContent);
  if(nv && nv.trim().length>2){ $('#signPrincipalName').textContent=nv.trim(); localStorage.setItem('principalName',nv.trim()); }
});

/* ููุงุฐุฌ ุงูุจููุฏ ูุงูุฃูุฒุงู โ ูุฌููุน ูู ูููุฐุฌ = 100% (ุจุฏูู ุชุฃููู ุจููุฏ ุฌุฏูุฏุฉ) */
const RUBRICS={
  teacher:[
    {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",weight:10},
    {name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",weight:10},
    {name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",weight:10},
    {name:"ุงูุชููุน ูู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฏุฑูุณ",weight:10},
    {name:"ุชุญุณูู ูุชุงุฆุฌ ุงููุชุนูููู",weight:10},
    {name:"ุฅุนุฏุงุฏ ูุชูููุฐ ุฎุทุฉ ุงูุชุนูู",weight:10},
    {name:"ุชูุธูู ุชูููุงุช ููุณุงุฆู ุงูุชุนูู ุงูููุงุณุจุฉ",weight:10},
    {name:"ุชููุฆุฉ ุจูุฆุฉ ุชุนููููุฉ",weight:10},
    {name:"ุงูุฅุฏุงุฑุฉ ุงูุตููุฉ",weight:5},
    {name:"ุชุญููู ูุชุงุฆุฌ ุงููุชุนูููู ูุชุดุฎูุต ูุณุชููุงุชูู",weight:5},
    {name:"ุชููุน ุฃุณุงููุจ ุงูุชูููู",weight:10},
  ],
  vp:[
    {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",weight:5},
    {name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",weight:5},
    {name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",weight:5},
    {name:"ูุฑู ููุงุฏุฑ ุนูู ุชูููุฐ ุฃุนูุงูู",weight:5},
    {name:"ูุฏุนู ููุดุงุฑู ูู ุงููุจุงุฏุฑุงุช ุงูููุนูุฉ",weight:5},
    {name:"ูุชุฎุฐ ุฅุฌุฑุงุกุงุช ููุงุฆูุฉ ููุงูุถุจุงุท",weight:10},
    {name:"ุฅุฏุงุฑุฉ ุงูููุงุฑุฏ",weight:5},
    {name:"ุฅุนุฏุงุฏ ุฎุทุฉ ุงูุชุทููุฑ ุงููููู",weight:5},
    {name:"ูุชุงุจุนุฉ ุงูุชุบุฐูุฉ ุงูุฑุงุฌุนุฉ ูููุคุดุฑุงุช",weight:5},
    {name:"ุชูููู ุฃุฏุงุก ุงูููุณูุจูู",weight:5},
    {name:"ุฅุฌุฑุงุกุงุช ูุชุญุณูู ูุชุงุฆุฌ ุงูุชุนูู",weight:5},
    {name:"ุงูุฅุณูุงู ูู ุชุญุณูู ุฃุฏุงุก ุงููุฏุฑุณุฉ",weight:10}, /* ูุงู 15 โ 10 ูุถุจุท 100% */
    {name:"ุงููุดุงุฑูุฉ ูู ุฅุนุฏุงุฏ ุงูุฎุทุท",weight:5},
    {name:"ูุชุงุจุนุฉ ุชูููุฐ ุงูุฎุทุท",weight:5},
    {name:"ุชููุฆุฉ ูุฑุต ูุดุงุฑูุฉ ุงูุทูุงุจ ูู ุงูุฃูุดุทุฉ",weight:5},
    {name:"ุชูุธูู ุงูููุตุงุช ุงูุฑูููุฉ ุงููุนุชูุฏุฉ",weight:5},
    {name:"ูุชุงุจุนุฉ ุชุนุฒูุฒ ุงูุณููู ุงูุฅูุฌุงุจู",weight:5},
    {name:"ุชููุฆุฉ ุจูุฆุฉ ูุฏุฑุณูุฉ ุขููุฉ ููููููููุฉ",weight:5},
  ],
  principal:[
    {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",weight:5},
    {name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",weight:5},
    {name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",weight:5},
    {name:"ูุฑู ููุงุฏุฑ ุนูู ุชูููุฐ ุฃุนูุงูู",weight:5},
    {name:"ูุฏุนู ููุดุงุฑู ูู ุงููุจุงุฏุฑุงุช ุงูููุนูุฉ",weight:5},
    {name:"ูุชุฎุฐ ุฅุฌุฑุงุกุงุช ููุงุฆูุฉ ููุงูุถุจุงุท",weight:5},
    {name:"ุฅุฏุงุฑุฉ ุงูููุงุฑุฏ",weight:5},
    {name:"ุฅุนุฏุงุฏ ุฎุทุฉ ุงูุชุทููุฑ ุงููููู",weight:5},
    {name:"ูุชุงุจุนุฉ ุงูุชุบุฐูุฉ ุงูุฑุงุฌุนุฉ ูููุคุดุฑุงุช",weight:5},
    {name:"ุชูููู ุฃุฏุงุก ุงูููุณูุจูู",weight:5},
    {name:"ุฏุนู ุชูููุฐ ุจุฑุงูุฌ ุงูุชุทููุฑ ุงููููู",weight:5},
    {name:"ุงูุฅุณูุงู ูู ุชูููุฐ ุฎุทุฉ ุงูุชุทููุฑ ุงููููู",weight:10}, /* ูุงู 15 โ 10 */
    {name:"ุงูุฅุณูุงู ูู ุชุญุณูู ุฃุฏุงุก ุงููุฏุฑุณุฉ",weight:10},
    {name:"ุงููุดุงุฑูุฉ ูู ุฅุนุฏุงุฏ ุงูุฎุทุท",weight:5},
    {name:"ูุชุงุจุนุฉ ุชูููุฐ ุงูุฎุทุท",weight:5},
    {name:"ุชููุฆุฉ ูุดุงุฑูุฉ ุงูุทูุงุจ ูู ุงูุฃูุดุทุฉ",weight:5},
    {name:"ุชูุธูู ุงูููุตุงุช ุงูุฑูููุฉ ุงููุนุชูุฏุฉ",weight:5},
    {name:"ูุชุงุจุนุฉ ุชุนุฒูุฒ ุงูุณููู ุงูุฅูุฌุงุจู",weight:5},
    {name:"ุชููุฆุฉ ุจูุฆุฉ ูุฏุฑุณูุฉ ุขููุฉ ููููููููุฉ",weight:5},
  ],
  activity:[
    {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",weight:10},
    {name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",weight:10},
    {name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",weight:5},
    {name:"ุงูุชููุน ูู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฏุฑูุณ",weight:5},
    {name:"ุชุญุณูู ูุชุงุฆุฌ ุงููุชุนูููู",weight:5},
    {name:"ุฅุนุฏุงุฏ ูุชูููุฐ ุฎุทุฉ ุงูุชุนูู",weight:10},
    {name:"ุชูุธูู ุชูููุงุช ููุณุงุฆู ุงูุชุนูู",weight:5},
    {name:"ุชููุฆุฉ ุจูุฆุฉ ุชุนููููุฉ",weight:5},
    {name:"ุงูุฅุฏุงุฑุฉ ุงูุตููุฉ",weight:5},
    {name:"ุชุญููู ูุชุงุฆุฌ ุงููุชุนูููู",weight:5},
    {name:"ุชููุน ุฃุณุงููุจ ุงูุชูููู",weight:5},
    /* ุนูุงุตุฑ ุฅุถุงููุฉ ูููุฒุฉ ูููุดุงุท */
    {name:"ุฎุทุฉ ุจุฑุงูุฌ ุงููุดุงุท ุงูุทูุงุจู",weight:10},
    {name:"ุชููุฆุฉ ุงูุจูุฆุฉ ููุฃูุดุทุฉ",weight:5},
    {name:"ุฏุนู ุงููุชุนูููู ููู ุงููููู",weight:5},
    {name:"ุชุญููุฒ ุงููุดุงุฑูุฉ ูู ุงูุฃูุดุทุฉ",weight:10},
  ],
  health:[
    {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",weight:10},
    {name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",weight:10},
    {name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",weight:10},
    {name:"ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฏุฑูุณ",weight:5},
    {name:"ุชุญุณูู ุงููุชุงุฆุฌ",weight:5},
    {name:"ุฎุทุฉ ุงูุชุนูู",weight:5},
    {name:"ุงูุชูููุงุช ูุงููุณุงุฆู",weight:5},
    {name:"ุชููุฆุฉ ุงูุจูุฆุฉ ุชุนููููุฉ",weight:5},
    {name:"ุงูุฅุฏุงุฑุฉ ุงูุตููุฉ",weight:5},
    {name:"ุชุญููู ุงููุชุงุฆุฌ",weight:5},
    {name:"ุชููุน ุงูุชูููู",weight:5},
    /* ุนูุงุตุฑ ุฅุถุงููุฉ ููุตุญุฉ ุงููุฏุฑุณูุฉ */
    {name:"ุงูุฎุทุฉ ุงููุดุชุฑูุฉ ููุจุฑุงูุฌ ุงูุตุญูุฉ",weight:10}, /* ูุงู 15 โ 10 */
    {name:"ุญุตุฑ ุงูุญุงูุงุช ุงูุตุญูุฉ",weight:10},           /* ูุงู 5 โ 10 */
    {name:"ุชููุฆุฉ ุงูุจูุฆุฉ ุงูุตุญูุฉ ุงููุฏุฑุณูุฉ",weight:10},  /* ูุงู 10 โ 10 (ุซุงุจุช) */
  ],
  counselor:[
    {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",weight:20},
    {name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",weight:5},
    {name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",weight:5},
    {name:"ุชุนุฒูุฒ ุงูุงูุถุจุงุท",weight:5},
    {name:"ุจุฑุงูุฌ ุชุฑุจููุฉ ููุฏุงูุนูุฉ",weight:5},
    {name:"ุฎุทุฉ ุงูุชูุฌูู ุงูุทูุงุจู",weight:10},
    {name:"ุชุตููู ุงูุญุงูุงุช ูุจุฑุงูุฌ ุงูุฏุนู",weight:10},
    {name:"ุชุนุฒูุฒ ุงูููู ูุงูุณููููุงุช",weight:10},
    {name:"ุชุฏุฎูุงุช ููุณูุฉ ูุงุฌุชูุงุนูุฉ",weight:10},
    {name:"ุงูุชุฎุทูุท ุงููููู ูุงูุชุนูููู",weight:5},
    {name:"ุชุนุฒูุฒ ุงูุชููู ุงูุฏุฑุงุณู",weight:5},
    {name:"ุชุฏุฎูุงุช ูููุชุฃุฎุฑูู ูุงููุนูุฏูู",weight:5},
    {name:"ุชูุนูุฉ ุจููุงุนุฏ ุงูุณููู ูุงูููุงุธุจุฉ",weight:5},
  ],
  lab:[
    {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",weight:10},
    {name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",weight:10},
    {name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",weight:10},
    {name:"ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฏุฑูุณ",weight:10},
    {name:"ุชุญุณูู ุงููุชุงุฆุฌ",weight:10},
    {name:"ุฅุนุฏุงุฏ ุฎุทุฉ ุชุดุบูู ุงููุฎุชุจุฑ",weight:5},
    {name:"ููุงุฑุงุช ุงูุชุฌุงุฑุจ ุงูุนูููุฉ",weight:5},
    {name:"ุชูููุฑ ุงููุณุชูุฒูุงุช ูุงูุชุฌููุฒุงุช",weight:5},
    {name:"ุงูุณูุงูุฉ ุงูููููุฉ",weight:5},
    {name:"ุชููุฆุฉ ุงููุฎุชุจุฑ",weight:5},
    {name:"ุชุณููู/ุชุฎุฒูู ุงูุฃุฌูุฒุฉ ูููุนูููู",weight:5},
    /* ุชูููุฒ ูุฎุชุจุฑ */
    {name:"ุชูุฑูุฑ ููุงู ุงููุฎุชุจุฑ ุงูุฃุณุจูุนูุฉ",weight:5},  /* ูุงู 10 โ 5 */
    {name:"ุชูุงุฑูุฑ ุญุงูุฉ ุงูุฃุฌูุฒุฉ ูุงููุนุฏุงุช",weight:5},   /* ูุงู 10 โ 5 */
  ],
  kg:[
    {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",weight:10},
    {name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",weight:5},
    {name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",weight:5},
    {name:"ุงุณุชุฑุงุชูุฌูุงุช ุชุฏุฑูุณ ูุชููุนุฉ",weight:5},
    {name:"ุชุญุณูู ููุงุชุฌ ุงูุชุนูู",weight:5},
    {name:"ููุงุฑุณุงุช ูุณุคููุฉ ููุฃุทูุงู",weight:5},
    {name:"ุฅุนุฏุงุฏ ุฎุทุท ุงูุชุนูู",weight:5},
    {name:"ุงูุชูููุงุช ูุงููุณุงุฆู ุงูููุงุณุจุฉ",weight:5},
    {name:"ุงูุชููุฏ ุจุงููููุงุฌ",weight:5},
    {name:"ุฅุดุฑุงู ุงูุฃุณุฑุฉ ุจุงูููู",weight:5},
    {name:"ุชููุฆุฉ ุจูุฆุฉ ุขููุฉ ููููููุฉ",weight:10}, /* ูุงู 15 โ 10 */
    {name:"ุฑูู ููุถูุนู ููุงุฆู",weight:5},
    {name:"ุชุชุจุน ุชูุฏู ุงูุฃุทูุงู",weight:5},
    {name:"ุงูุชูููู ุงููุณุชูุฑ ูุงููุชููุน",weight:5},
    {name:"ุงููุดุงุฑูุฉ ูู ุงูุฃูุดุทุฉ ุงูุชุฑุจููุฉ",weight:5},
    {name:"ุชุจุงุฏู ุงูุฎุจุฑุงุช ุงูููููุฉ",weight:5},
    {name:"ุฏุนู ุงูุชุณุงุจ ุงูููู ูุงูุงุชุฌุงูุงุช",weight:5},
    {name:"ุชุนุฒูุฒ ุงูุณููููุงุช ุงูุฅูุฌุงุจูุฉ",weight:5},
    {name:"ุชูููุฉ ุงูููุงุฑุงุช ุงููุบููุฉ ูุงูุงุฌุชูุงุนูุฉ",weight:5},
  ],
};

/* ุจูุงุก ุงูุตููู */
function buildRows(items){
  const tb=$("#rows"); tb.innerHTML=""; let wsum=0;
  items.forEach((it,i)=>{
    wsum+=+it.weight;
    const tr=document.createElement('tr'); tr.dataset.w=it.weight;
    tr.innerHTML=`
      <td style="text-align:right"><span style="font-weight:800;color:#0c594e;margin-inline-end:6px">${i+1}</span><span class="item-text">${it.name}</span></td>
      <td>${it.weight}%</td>
      <td>
        <select class="select-mini grade">
          <option>1</option><option>2</option><option selected>3</option><option>4</option><option>5</option>
        </select>
      </td>
      <td class="result"><span class="score">0.00</span></td>`;
    tb.appendChild(tr);
  });
  $("#sumWeight").textContent=wsum+"%";
}

/* ุชุญุฏูุซ ุงูุญุณุงุจุงุช + ุชูููู ุงูุตููู + ุงูููุฌุฉ + ูุชูุณุท ุงูุณูู + ุงูููุฉ/ุงูุชุญุณูู */
function recalc(){
  let total=0, wsum=0, avgNum=0, avgDen=0;
  $$('#rows tr').forEach(tr=>{
    const w=+tr.dataset.w||0; wsum+=w;
    const v=+tr.querySelector('.grade').value||3;
    const s=(v/5)*w; total+=s;
    tr.querySelector('.score').textContent=s.toFixed(2);
    for(let k=1;k<=5;k++) tr.classList.remove('rate-'+k);
    tr.classList.add('rate-'+v);
    avgNum += v * w; avgDen += w;
  });
  $("#sumScore").textContent=total.toFixed(2);
  const pct=Math.max(0,Math.min(100,total));
  $("#kpiFill").style.width=pct+"%";
  $("#kpiLabelL").textContent=`ูุคุดุฑ ุงูุฅูุฌุงุฒ: ${pct.toFixed(0)}%`;
  $("#kpiLabelR").textContent=`ูุฌููุน ุงูุฃูุฒุงู: ${wsum}%`;
  const avg = avgDen? (avgNum/avgDen):0;
  $("#avgOutOf5").textContent = avg.toFixed(2);
  $("#kpiLabelM").textContent = `ุณูููู ุงูุชูุฏูุฑ (ูุชูุณุท): ${avg.toFixed(2)} / 5`;
  buildInsights();
}

/* ุจูู ุชูููุฏู ุนุงู ููููุฉ/ุงูุชุญุณูู (ุจุฏูู ุงุนุชูุงุฏ ุฃุณูุงุก ูุญุฏุฏุฉ) */
function buildInsights(){
  const items=$$('#rows tr'); if(!items.length){ $('#strengthsBox').textContent='โ'; $('#improveBox').textContent='โ'; return; }
  const strengths=[], improve=[];
  items.forEach(tr=>{
    const v=+tr.querySelector('.grade').value||3;
    const name=tr.querySelector('.item-text').textContent.trim();
    const w=+tr.dataset.w||0;
    if(v>=4) strengths.push(`โข ูุญูู ุชููุฒูุง ููุญูุธูุง ูู ยซ${name}ยป ูุน ุฃุซุฑ ูุงุจู ููููุงุณ (ูุฒู ${w}%).`);
    if(v<=2) improve.push(`โข ุชุนุฒูุฒ ยซ${name}ยป ุนุจุฑ ุฎุทุฉ ุฅุฌุฑุงุฆูุฉ ูุตูุฑุฉ ุงููุฏูุ ูุดูุงูุฏ ูุชุงุจุนุฉ ุฃุณุจูุนูุฉ (ูุฒู ${w}%).`);
  });
  $('#strengthsBox').textContent = strengths.length? [...new Set(strengths)].join('\n'):'โ';
  $('#improveBox').textContent   = improve.length?   [...new Set(improve)].join('\n')  :'โ';
  $('#signTeacherName').textContent = $('#tName').value || 'โ';
  $('#signPrincipalName').textContent = localStorage.getItem('principalName') || 'ููุฏ ุญุงูุฏ ุนูู ุงูุฒูุฑุงูู';
}

/* ุชุญููู ูููุฐุฌ ุจุญุณุจ ุงูุฏูุฑ + ุงููุฑุญูุฉ */
function applyModelStage(){
  const key=$('#modelSelect').value, arr=RUBRICS[key]||[];
  buildRows(arr);
  $$('.grade').forEach(s=> s.value='3'); /* ุงูุงูุชุฑุงุถ 3 */
  recalc();
  $('#modelTxt').textContent='ูููุฐุฌ ุงูุชูููู: '+(TITLE_BY_MODEL[key]||'โ');
  tryLoad();
}

/* ุญูุธ ุชููุงุฆู/ุชุญููู */
function keyFor(){ return `PF_${($('#tName').value||'').trim()}_${$('#modelSelect').value}_${$('#stageSelect').value}`; }
function autoSave(){
  const rows=$$('#rows tr').map(tr=>({n:tr.querySelector('.item-text').textContent,w:+tr.dataset.w,v:+tr.querySelector('.grade').value}));
  const data={
    dir:$('#dirText').textContent,school:$('#schoolText').textContent,
    model:$('#modelSelect').value,stage:$('#stageSelect').value,
    rows,meta:{name:$('#tName').value,id:$('#tId').value,spec:$('#tSpec').value,rank:$('#tRank').value,principal:$('#signPrincipalName').textContent},
    ins:{s:$('#strengthsBox').textContent,i:$('#improveBox').textContent},sum:$('#sumScore').textContent,avg:$('#avgOutOf5').textContent
  };
  localStorage.setItem(keyFor(),JSON.stringify(data));
}
function tryLoad(){
  const raw=localStorage.getItem(keyFor()); if(!raw) return;
  const d=JSON.parse(raw);
  $('#tId').value=d.meta.id||''; $('#tSpec').value=d.meta.spec||''; $('#tRank').value=d.meta.rank||'';
  $('#signPrincipalName').textContent=d.meta.principal|| (localStorage.getItem('principalName')||'ููุฏ ุญุงูุฏ ุนูู ุงูุฒูุฑุงูู');
  $$('#rows tr').forEach((tr,i)=>{ const r=d.rows[i]; if(r) tr.querySelector('.grade').value=r.v; });
  recalc();
}

/* ุฃุญุฏุงุซ */
document.addEventListener('change',e=>{
  if(e.target.classList.contains('grade')){ recalc(); autoSave(); }
});
$('#modelSelect').addEventListener('change',()=>{ applyModelStage(); autoSave(); });
$('#stageSelect').addEventListener('change',()=>{ recalc(); autoSave(); });

/* ุดุบู ุฃููู */
applyModelStage();

/* ุนุฏุณุฉ ุงูุฃุณูุงุก (ุงุณุชูุฑุงุฏ/ุญูุธ/ุงุฎุชูุงุฑ) */
const HEADER_MAP=[
  {keys:['ุงูุงุณู','Name','Full Name'], prop:'name'},
  {keys:['ุฑูู ุงููููุฉ','ูููุฉ','ID','National ID'], prop:'id'},
  {keys:['ุงูุชุฎุตุต','Specialty','Major'], prop:'spec'},
  {keys:['ุงููุฑุชุจุฉ','ุงูุฑุชุจุฉ','Rank','Grade'], prop:'rank'},
  {keys:['ุงููุณูู','ุงููุณูู ุงููุธููู','Title','Role'], prop:'title'},
];
function findProp(h){ h=(h||'').toString().trim(); for(const m of HEADER_MAP){ if(m.keys.some(k=>new RegExp(`^${k}$`,'i').test(h))) return m.prop; } return null; }
function getNames(){ return JSON.parse(localStorage.getItem('namesV2')||'[]'); }
function setNames(a){ localStorage.setItem('namesV2',JSON.stringify(a)); }
function refreshNameList(){
  const box=$("#nameList"); box.innerHTML="";
  const names=getNames();
  $("#nameStats").textContent = names.length? `ุนุฏุฏ ุงูุฃุณูุงุก ุงููุฎุฒูุฉ: ${names.length}` : "ูุง ุชูุฌุฏ ุฃุณูุงุก ุจุนุฏ.";
  if(!names.length){ return; }
  const grid=document.createElement('div'); grid.style.display='grid'; grid.style.gridTemplateColumns='repeat(auto-fill,minmax(240px,1fr))'; grid.style.gap='8px';
  names.forEach(o=>{
    const card=document.createElement('div'); card.style.border='1px solid var(--border)'; card.style.borderRadius='10px'; card.style.padding='8px'; card.style.cursor='pointer'; card.style.background='#fff';
    card.innerHTML=`<div style="font-weight:900;color:#0c594e">${o.name}</div><div style="font-size:12px;color:#667;display:flex;gap:6px;flex-wrap:wrap"><span>${o.id||'โ'}</span><span>${o.spec||'โ'}</span><span>${o.rank||'โ'}</span><span>${o.title||'โ'}</span></div>`;
    card.onclick=()=>{ $('#tName').value=o.name||''; $('#tId').value=o.id||''; $('#tSpec').value=o.spec||''; $('#tRank').value=o.rank||''; $('#mini').style.display='none'; recalc(); buildInsights(); autoSave(); };
    grid.appendChild(card);
  }); box.appendChild(grid);
}
$('#openMini').addEventListener('click',()=> { refreshNameList(); $('#mini').style.display='flex'; });
$('#miniClose').addEventListener('click',()=> $('#mini').style.display='none');
$('#btnPickFile').addEventListener('click',()=> $('#xlsInput').click());
$('#btnTpl').addEventListener('click',()=>{
  const rows=[["ุงูุงุณู","ุฑูู ุงููููุฉ","ุงูุชุฎุตุต","ุงููุฑุชุจุฉ","ุงููุณูู"],[""],];
  const ws=XLSX.utils.aoa_to_sheet(rows); const wb=XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,ws,"ุฃุณูุงุก");
  const wbout=XLSX.write(wb,{bookType:'xlsx',type:'array'}); saveAs(new Blob([wbout],{type:"application/octet-stream"}),"template_names.xlsx");
});
$('#xlsInput').addEventListener('change',async e=>{
  const f=e.target.files[0]; if(!f) return;
  try{
    const data=await f.arrayBuffer(); const wb=XLSX.read(data,{type:'array'});
    const all=[];
    wb.SheetNames.forEach(name=>{
      const ws=wb.Sheets[name]; const rows=XLSX.utils.sheet_to_json(ws,{header:1,defval:''}); if(!rows.length) return;
      const head=rows[0]; const idx={}; head.forEach((h,i)=>{ const p=findProp(h); if(p) idx[p]=i; });
      for(let r=1;r<rows.length;r++){
        const row=rows[r]; if(!row.length) continue;
        const o={}; Object.keys(idx).forEach(p=> o[p]=String(row[idx[p]]||'').trim());
        if(o.name){ all.push(o); }
      }
    });
    if(all.length){
      const prev=getNames(); const mix=[...prev];
      all.forEach(o=>{ if(!mix.some(x=>x.name===o.name && x.id===o.id)){ mix.push(o); }});
      setNames(mix); refreshNameList();
    } else alert('ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃุนูุฏุฉ ูุนุฑููุฉ ููุฃุณูุงุก.');
  }catch(err){ console.error(err); alert('ุชุนุฐูุฑ ูุฑุงุกุฉ ุงูููู.'); }
  e.target.value='';
});

/* ุทุจุงุนุฉ ู PDF (ุฅุตูุงุญ ุงูุงูุชูุงุท) */
const HIDE_SEL='.modal,.toolbar'; /* ูุฎูู ุดุฑูุท ุงูุฃุฏูุงุช ูุงูููุงูุฐ ููุท */
function hideUI(hide=true){
  $$(HIDE_SEL).forEach(el=>{ if(hide){el.dataset._np='1'; el.style.display='none';} else if(el.dataset._np==='1'){ el.style.display=''; delete el.dataset._np; }});
}
async function capturePDF(targetEl, filename){
  try{
    hideUI(true);
    const { jsPDF } = window.jspdf;
    const canvas = await html2canvas(targetEl,{scale:1.4,useCORS:true,windowWidth:document.documentElement.scrollWidth});
    const img = canvas.toDataURL('image/png');
    const pdf = new jsPDF({orientation:'p',unit:'mm',format:'a4'});
    const props=pdf.getImageProperties(img); const w=210, h=(props.height*w)/props.width;
    pdf.addImage(img,'PNG',0,0,w,h);
    pdf.save(filename);
  }catch(e){ alert('ุชุนุฐูุฑ ุญูุธ PDF'); console.error(e);}
  finally{ hideUI(false); }
}
$('#btnPrint').addEventListener('click',()=> window.print());
$('#btnPdf').addEventListener('click', async ()=>{
  const name=$('#tName').value||'ุจุฏูู ุงุณู';
  await capturePDF(document.getElementById('page'), `ุชูููู ุงูุฃุฏุงุก ุงููุธููู - ${name}.pdf`);
});
$('#btnSave').addEventListener('click',()=>{ autoSave(); alert('ุชู ุงูุญูุธ ูุญูููุง.'); });
$('#btnClear').addEventListener('click',()=>{ $$('.grade').forEach(s=> s.value='3'); recalc(); buildInsights(); autoSave(); });

/* ูุงุชุณุงุจ */
const DEFAULT_PHONE= localStorage.getItem('waPhone') || '966500000000';
function buildWhatsAppText(){
  const name=$('#tName').value||'โ', model=$('#modelSelect').selectedOptions[0].textContent, stage=$('#stageSelect').selectedOptions[0].textContent;
  const lines=[`ุชูููู ุงูุฃุฏุงุก ุงููุธููู โ ${name} โ ${model} โ ${stage}`, `ุงููุฌููุน: ${$('#sumScore').textContent}`, `ุงููุชูุณุท (ูู 5): ${$('#avgOutOf5').textContent}`, '', 'ููุฎุต ุงูุจููุฏ:'];
  $$('#rows tr').forEach(tr=>{
    const item=tr.querySelector('.item-text').textContent; const w=+tr.dataset.w; const v=+tr.querySelector('.grade').value; const s=(v/5)*w;
    lines.push(`- ${item}: ูุฒู ${w}%ุ ุฏุฑุฌุฉ ${v}/5ุ ูุงุชุฌ ${s.toFixed(2)}`);
  });
  lines.push('', 'ููุงุท ุงูููุฉ:', $('#strengthsBox').textContent||'โ', '', 'ูุฌุงูุงุช ุงูุชุญุณูู:', $('#improveBox').textContent||'โ');
  return encodeURIComponent(lines.join("\n"));
}
$('#btnWhatsApp').addEventListener('click',()=>{
  const phone = prompt('ุฃุฏุฎู ุฑูู ูุงุชุณุงุจ (ูุน ููุชุงุญ ุงูุฏููุฉ):', DEFAULT_PHONE) || DEFAULT_PHONE;
  localStorage.setItem('waPhone', phone);
  const text=buildWhatsAppText();
  window.open(`https://wa.me/${phone}?text=${text}`,'_blank');
});

/* ูุชุญ ุงูุดุฑุญ/ุงูุฃุฏูุฉ/ุฅุบูุงู */
$('#openHelp').addEventListener('click',()=> $('#helpModal').style.display='flex');
$('#openRubrics').addEventListener('click',()=> $('#reportsModal').style.display='flex');
document.addEventListener('click',e=>{ const sel=e.target.getAttribute('data-close'); if(sel){ $(sel).style.display='none'; }});

/* ุฎุทุฉ ุงููุฌูุฉ: ุจูุงุก ูุชุนุฏุฏ ุงููุฌูุงุช + PDF ูุนูู */
function buildGapPlan(){
  const name=$('#tName').value||'โ';
  const model=$('#modelSelect').selectedOptions[0].textContent;
  const stage=$('#stageSelect').selectedOptions[0].textContent;
  const d=new Date(); const year = d.getFullYear()+' / '+(d.getFullYear()+1);

  $('#g_dirHeader').textContent = $('#dirText').textContent;
  $('#g_schoolHeader').textContent = $('#schoolText').textContent;
  $('#g_today').textContent = ['ุงูุฃุญุฏ','ุงูุงุซููู','ุงูุซูุงุซุงุก','ุงูุฃุฑุจุนุงุก','ุงูุฎููุณ','ุงูุฌูุนุฉ','ุงูุณุจุช'][d.getDay()];
  $('#g_date').textContent = d.toLocaleDateString('ar-SA');
  $('#g_model').textContent = `ูููุฐุฌ: ${model}`;

  $('#gapModal').style.display='flex';
  $('#g_name').textContent=name; $('#g_dir').textContent=$('#dirText').textContent;
  $('#g_title').textContent=model; $('#g_spec').textContent=$('#tSpec').value||'โ';
  $('#g_stage').textContent=stage; $('#g_school').textContent=$('#schoolText').textContent;
  $('#g_year').textContent=year;

  // ุงุณุชุฎุฑุงุฌ ุฃุฏูู 3 ุจููุฏ ููุฌูุงุช
  const rows=$$('#rows tr').map(tr=>({name:tr.querySelector('.item-text').textContent,w:+tr.dataset.w,v:+tr.querySelector('.grade').value}));
  rows.sort((a,b)=> (a.v===b.v? a.w-b.w : a.v-b.v));
  const gaps=rows.slice(0,Math.min(3,rows.length));

  const body=$('#g_targets'); body.innerHTML='';
  gaps.forEach(g=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${g.name}</td>` + [1,2,3,4,5].map(k=> `<td style="font-weight:900">${k===g.v?'โ':''}</td>`).join('');
    body.appendChild(tr);
  });

  const avg = +($('#avgOutOf5').textContent||'0');
  $('#g_grade').textContent = `${avg.toFixed(2)} / 5`;

  $('#g_strengths').textContent = ($('#strengthsBox').textContent||'').trim() || 'โ';
  $('#g_gaps').textContent      = ($('#improveBox').textContent||'').trim()   || 'โ';

  const actions=$('#g_actions'); actions.innerHTML='';
  gaps.forEach((g,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td contenteditable="true">ุฅุฌุฑุงุก ุชุญุณูู ููุฌูู ูุชุนูู ุจู ยซ${g.name}ยป</td><td contenteditable="true">ููุงุฏ/ููุตุงุช/ุฏุนู</td><td contenteditable="true">3 ุฃุณุงุจูุน</td><td contenteditable="true">ุชุฏุฑูุจ/ุฒูุงุฑุฉ ุตููุฉ</td><td contenteditable="true">${name||'ุงููุนูู'}</td><td contenteditable="true">ุงููุฏูุฑ/ุงููุดุฑู</td><td contenteditable="true">ุชุญุณูู โฅ ุฏุฑุฌุฉ ูุงุญุฏุฉ</td>`;
    actions.appendChild(tr);
  });

  $('#g_signTeacher').textContent = name || 'โ';
  $('#g_signPrincipal').textContent = localStorage.getItem('principalName') || 'ููุฏ ุญุงูุฏ ุนูู ุงูุฒูุฑุงูู';
  $('#g_footerDate').textContent = `ุญูุฑูุฑ ูู ${d.toLocaleDateString('ar-SA')} โ ${['ุงูุฃุญุฏ','ุงูุงุซููู','ุงูุซูุงุซุงุก','ุงูุฃุฑุจุนุงุก','ุงูุฎููุณ','ุงูุฌูุนุฉ','ุงูุณุจุช'][d.getDay()]}`;
}
document.getElementById('btnGapPlan').addEventListener('click', buildGapPlan);

document.getElementById('gapClose').addEventListener('click',()=> $('#gapModal').style.display='none');
document.getElementById('gapPdf').addEventListener('click', async ()=>{
  const name=$('#tName').value||'ุจุฏูู ุงุณู';
  await capturePDF(document.getElementById('gapPanel'), `ุฎุทุฉ ุชุญุณูู ูุฌูุฉ ุงูุฃุฏุงุก - ${name}.pdf`);
});
</script>
</body>
</html>
