<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<title>ูููุฐุฌ ุชูููู ุงูุฃุฏุงุก ุงููุธููู</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
:root{--moe:#1e8a79;--moe-d:#0c594e;--ink:#0b2f2b;--line:#e6f1ee;--paper:#fff;--accent:#0fb3b0}
*{box-sizing:border-box}
html,body{margin:0;background:#fff;color:var(--ink);font-family:"Tajawal";font-size:15px;line-height:1.8}
#page{width:min(1120px,100%);margin:0 auto;padding:12px 14px 48px}

/* ููุฏุฑ */
.header{
  display:grid;
  grid-template-columns:1fr auto 1fr;
  align-items:center;
  text-align:center;
  margin-bottom:8px;
  position:relative
}
.hcol{display:flex;flex-direction:column;gap:2px;align-items:center}
.hcol .line{display:inline-flex;align-items:center;gap:6px;font-weight:700;color:var(--moe-d)}
.pen{border:none;background:transparent;color:var(--moe-d);cursor:pointer;font-size:13px;line-height:1}
.pen:hover{opacity:.8}
.noprint{display:inline-flex}
/* ุดุนุงุฑ */
#moe{width:min(180px,32vw);object-fit:contain}
@media print{ #moe{width:150px} }

/* ุฃููููุฉ ุงูุดุฑุญ */
@keyframes pulseHelp{
  0%{box-shadow:0 0 0 0 rgba(15,179,176,.45);}
  70%{box-shadow:0 0 0 14px rgba(15,179,176,0);}
  100%{box-shadow:0 0 0 0 rgba(15,179,176,0);}
}
.help-fab{
  position:absolute; left:8px; bottom:-6px;
  width:28px;height:28px;border-radius:999px;
  display:flex;align-items:center;justify-content:center;
  border:1px solid #bdebe5;background:linear-gradient(180deg,#eafffb,#ffffff);
  color:#0b6e68;font-weight:900;cursor:pointer;
  box-shadow:0 4px 14px rgba(15,179,176,.18);
  transition:transform .2s ease;
  animation:pulseHelp 1.8s infinite;
}
.help-fab:hover{transform:translateY(-1px)}

/* โ ุฒุฑ ุงูููู ุงูุฌุฏูุฏ ุจุฌูุงุฑ ุนูุงูุฉ ุงูุงุณุชููุงู (ุจุฏูู ุงูุชุฃุซูุฑ ุนูู ุฃู ุนูุตุฑ) */
@keyframes pulseHome{
  0%{box-shadow:0 0 0 0 rgba(30,138,121,.45);}
  70%{box-shadow:0 0 0 14px rgba(30,138,121,0);}
  100%{box-shadow:0 0 0 0 rgba(30,138,121,0);}
}
.home-fab{
  position:absolute; left:42px; bottom:-6px; /* ุจุฌูุงุฑ ? ูุจุงุดุฑุฉ */
  width:28px;height:28px;border-radius:999px;
  display:flex;align-items:center;justify-content:center;
  border:1px solid #bdebe5;
  background:linear-gradient(180deg,#eafffb,#ffffff);
  color:#0b6e68;
  font-weight:900;
  cursor:pointer;
  box-shadow:0 4px 14px rgba(30,138,121,.18);
  transition:transform .2s ease, filter .2s ease;
  animation:pulseHome 1.8s infinite;
  text-decoration:none;
}
.home-fab:hover{transform:translateY(-1px);filter:brightness(1.02)}
.home-fab svg{width:16px;height:16px;display:block;filter:drop-shadow(0 0 10px rgba(15,179,176,.35))}

/* ุงูุฃุฏูุงุช */
.toolbar{
  display:flex;gap:8px;align-items:center;flex-wrap:wrap;
  white-space:nowrap;margin:6px 0;
  overflow-x:auto;padding-bottom:4px
}
.toolbar::-webkit-scrollbar{height:4px}
.toolbar::-webkit-scrollbar-track{background:transparent}
.toolbar::-webkit-scrollbar-thumb{background:#cde6df;border-radius:999px}
.select{appearance:none;height:36px;padding:0 30px 0 12px;border:1px solid var(--line);border-radius:999px;background:#fff;font-weight:800;color:#0b3a34;cursor:pointer;font-size:13px}
.sel{position:relative;display:inline-block}
.sel>span{position:absolute;right:10px;top:8px;pointer-events:none}
.btn{
  --g1: var(--moe); --g2: var(--moe-d);
  border:1px solid #bfe7df;border-radius:999px;padding:8px 14px;font-weight:800;cursor:pointer;
  background:linear-gradient(180deg,var(--g1),var(--g2)); color:#fff;
  box-shadow:0 2px 0 rgba(0,0,0,.05), inset 0 -2px 0 rgba(255,255,255,.28);
  white-space:nowrap;
}
.btn.secondary{--g1:#eafffb;--g2:#ffffff;color:#0b6e68;border-color:#bdebe5}
.btn.warn{--g1:#ffe3e3;--g2:#ffd4d4;color:#8b0000;border-color:#f3caca}
.btn:disabled{opacity:.6;cursor:not-allowed}

/* ุตู ุจูุงูุงุช ุงูููุธู โ ุตู ูุงุญุฏ ุจูุง ุงูุชูุงู */
.grid4{
  display:grid;                 /* โ ุฃุถู ูุฐุง ุงูุณุทุฑ (ุณุจุจ ุงููุดููุฉ) */
  gap:8px;
  align-items:center;

  grid-template-columns:
    minmax(340px, 2fr)
    minmax(160px, 1fr)
    minmax(160px, 1fr)
    minmax(160px, 1fr);

  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
  white-space:nowrap;
}

/* โ ุถุฑูุฑู ุญุชู ูุนูู ุงููุต (...) ุฏุงุฎู ุงูุดุจูุฉ ุจุดูู ุตุญูุญ */
.grid4 > *{min-width:0;}
.grid4 .lined{width:100%;}

.field{position:relative}
.field .lined{padding-left:44px;}

.lens-mini{
  position:absolute; left:6px; top:50%; transform:translateY(-50%);
  border:1px solid #cde6df; background:#fff; color:#0c594e; border-radius:8px; padding:2px 6px; font-weight:800; cursor:pointer;
}
.lined{
  height:40px;border:none;border-radius:0;padding:0 8px;background:transparent;outline:none;
  font-weight:700;color:var(--ink);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;-webkit-appearance:none;
}
.lined::placeholder{color:#7b8d88;font-weight:400}


/* ุงูุชุฎุทูุท ููุฃุฏุงุก (ูุงุจู ููุทู) */
#goals{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fcfffe;margin:8px 0;break-inside:avoid}
#goals h3{margin:0 0 4px;color:#0c594e;display:flex;align-items:center;gap:10px}
#goals .hint{font-size:12px;color:#557;white-space:nowrap}
.goals-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  flex-wrap:wrap;
}
.goals-toggle{
  font-size:12px;
  padding:6px 12px;
}
#goalsBody{
  margin-top:4px;
  max-height:0;
  overflow:hidden;
  transition:max-height .3s ease;
}
#goalsBody.open{
  max-height:520px;
}
.goalrow{display:grid;grid-template-columns:2fr 1fr 1fr;gap:8px;margin-top:6px}
.goalrow input{height:36px;border:1px solid var(--line);border-radius:10px;padding:0 10px;background:#fff}
#goalChips{display:flex;gap:6px;flex-wrap:wrap}
#goalChips button{border:1px dashed var(--line);background:#fff;border-radius:999px;padding:4px 8px;font-size:12px;cursor:pointer;color:#0c594e}

/* ุดุฑูุท ุนุฑุถ ุงูุฃูุฏุงู ููุทุจุงุนุฉ */
.goals-print{display:none;margin:8px 0 6px;border:1px solid var(--line);border-radius:12px;padding:6px 8px;background:#fff}
.goals-print .row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;align-items:center}
.goals-print .cell{border:1px dashed var(--line);border-radius:10px;padding:4px 8px;min-height:24px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.goals-print .hdr{font-weight:800;color:#0c594e}

/* ุงููุคุดุฑ */
.kpi{margin:8px 0}
.kbar{height:16px;border-radius:999px;border:1px solid #d6ece8;overflow:hidden;position:relative}
.kfill{position:absolute;inset:0;width:0%;background:linear-gradient(90deg,#ef4444,#f59e0b,#22c55e,#10b981);opacity:.95;transition:width .4s}
.kline{display:flex;gap:8px;justify-content:space-between;font-size:12px;color:#415b56}

/* ุฌุฏูู ุงูุชูููู */
.table{width:100%;border-collapse:collapse;border:1px solid var(--line);border-radius:12px;overflow:hidden}
.table th,.table td{border:1px solid var(--line);padding:8px;vertical-align:middle}
.table th{background:var(--moe);color:#fff}
.table tfoot th{background:#0f4e47;color:#fff}
.table td:nth-child(2), .table th:nth-child(2){text-align:center}
.select-mini{appearance:none;background:#fff;border:none;border-radius:10px;padding:4px 8px;font-weight:900;color:#0b3430;text-align:center;text-align-last:center}
tr.r1{background:linear-gradient(90deg,#fee2e2 0,#fff 60%)} tr.r2{background:linear-gradient(90deg,#fde68a 0,#fff 60%)} tr.r3{background:linear-gradient(90deg,#ecfeff 0,#fff 60%)} tr.r4{background:linear-gradient(90deg,#dcfce7 0,#fff 60%)} tr.r5{background:linear-gradient(90deg,#bbf7d0 0,#fff 60%)}

/* ุตู ูุณุชูู ุงูุชูุฏูุฑ ุงูุนุงู ููุฃุฏุงุก โ ูุญูู ูููุฏูุฌ */
.overall{
  margin:6px 0 8px;
}
.overall-pill{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:6px 10px;
  border-radius:14px;
  border:1px solid var(--line);
  background:#f9fffd;
  position:relative;
  overflow:hidden;
}
.overall-main{
  display:flex;
  align-items:center;
  gap:8px;
  font-weight:800;
}
.overall-class{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width:32px;
  height:26px;
  border-radius:999px;
  background:#0c594e;
  color:#fff;
  font-weight:900;
  font-size:14px;
}
.overall-desc{
  font-weight:800;
  color:#0b3f43;
  white-space:nowrap;
}
.overall-stats{
  display:flex;
  align-items:center;
  gap:10px;
  font-size:12px;
  flex-wrap:wrap;
}
.overall-percent{
  font-weight:900;
  font-size:13px;
  color:#0b3f43;
}
.overall-avg{
  color:#546b66;
  font-size:12px;
}

/* ุชุฏุฑุฌ ูููู ุญุณุจ ุงููุณุชูู */
.overall-pill.lv1{background:linear-gradient(90deg,#fee2e2,#fff);border-color:#fecaca;}
.overall-pill.lv2{background:linear-gradient(90deg,#fef3c7,#fff);border-color:#fde68a;}
.overall-pill.lv3{background:linear-gradient(90deg,#e0f2fe,#fff);border-color:#bfdbfe;}
.overall-pill.lv4{background:linear-gradient(90deg,#dcfce7,#fff);border-color:#bbf7d0;}
.overall-pill.lv5{background:linear-gradient(90deg,#bbf7d0,#ecfdf5);border-color:#4ade80;}

/* ุงูููุฉ/ุงูุชุญุณูู */
.duo{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:10px 0}
.box{border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px}
.box h3{margin:0 0 6px;color:#0c594e;font-size:15px}
.box p{white-space:pre-wrap;margin:0}
#strengths[contenteditable], #improves[contenteditable]{outline:none;border:1px dashed transparent;border-radius:8px;padding:4px}
#strengths[contenteditable]:focus, #improves[contenteditable]:focus{border-color:#bdebe5;background:#f8fffd}

/* ุชุฐููู/ุชูุงููุน */
.signs{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
.sig{text-align:center}.sig-name{font-weight:800;color:#0c594e;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sig-line{border-top:1px dashed #bcd3cd;margin-top:6px;width:80%;margin-inline:auto}
.footer{color:#6a7f7b;font-size:12px;text-align:center;margin-top:10px}

/* ุชูููุญ */
.tip{position:relative}
.tip:hover::after{content:attr(data-tip);position:absolute;bottom:calc(100% + 6px);right:0;background:#0c594e;color:#fff;padding:6px 8px;border-radius:8px;font-size:12px;white-space:nowrap}

/* ูุงูุฐุฉ ุงูุดุฑุญ */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.28);z-index:1000;padding:12px}
.modal.show{display:flex}
.modal-card{
  width:min(86vw, 1100px);
  max-height:92vh; overflow:auto;
  background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 16px 40px rgba(0,0,0,.12)
}
.modal-head{position:sticky;top:0;display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,#e9f7f3,#fff);z-index:2}
.modal-title{font-weight:800;color:#0c594e}
.modal-body{padding:12px 16px}
.modal-body h4{margin:8px 0;color:#0c594e}
.badge{display:inline-block;padding:3px 8px;border-radius:999px;background:#f2fbf8;border:1px solid var(--line);font-weight:700;color:#0b534b}
.close{border:none;background:#fff;color:#0b534b;border:1px solid var(--line);border-radius:10px;padding:6px 10px;cursor:pointer}
.close:hover{background:#f6fbf9}

/* ูุงูุฐุฉ ุนุฏุณุฉ ุงูุฃุณูุงุก */
.lens-card{width:min(92vw,1100px);max-height:92vh;overflow:auto;background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 16px 40px rgba(0,0,0,.14)}
.lens-head{position:sticky;top:0;display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,#f0fffa,#fff);z-index:3}
.lens-title{font-weight:900;color:#0c594e;display:flex;gap:8px;align-items:center}
.lens-body{padding:12px 16px}
.lens-tools{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:10px}
.input{height:36px;border:1px solid var(--line);border-radius:10px;padding:0 10px;background:#fff;font-weight:700;outline:none}
.filebox{display:flex;align-items:center;gap:8px;border:1px dashed #cce7e2;background:#f8fffd;padding:8px 10px;border-radius:12px}
.drop{border:2px dashed #b6e9df;background:#f3fffb;border-radius:12px;padding:14px;text-align:center;color:#0b534b}
.drop.hover{border-color:var(--accent); background:#eafffb;}
.table-wrap{border:1px solid var(--line);border-radius:12px;overflow:auto}
.tbl{width:100%;border-collapse:collapse}
.tbl th,.tbl td{border-bottom:1px solid var(--line);padding:8px}
.tbl th{background:#ecfffa;color:#0b534b;text-align:right;position:sticky;top:0}
.row-btn{border:1px solid #cde6df;background:#fff;border-radius:8px;padding:4px 8px;cursor:pointer;font-weight:800;color:#0c594e}
.row-btn:hover{background:#f1fffb}
.tag{
  display:inline-block; font-size:11px; padding:2px 6px; border-radius:999px; margin-right:6px;
  background:#eafff7; border:1px solid #bdebe5; color:#0c6a62; font-weight:800;
}
/* โ ููุน ุงูุชูุงู ุฃุฏูุงุช ุงูุนุฏุณุฉ + ุณูุฑูู ุฃููู ูุทูู (ุจุฏูู ุชุฎุฑูุจ) */
.lens-tools{
  flex-wrap: nowrap;
  overflow-x: auto;
  padding-bottom: 6px;
  -webkit-overflow-scrolling: touch;
}
.lens-tools::-webkit-scrollbar{height:4px}
.lens-tools::-webkit-scrollbar-track{background:transparent}
.lens-tools::-webkit-scrollbar-thumb{background:#cde6df;border-radius:999px}

/* โ ุชุฌููุน ุฒุฑูู ุงูุงุณุชูุฑุงุฏ/ุงูุชุตุฏูุฑ ูู ุตู ูุงุญุฏ ุฏุงุฆููุง */
.io-pack{
  display:inline-flex;
  gap:8px;
  align-items:center;
  flex-wrap:nowrap;
  white-space:nowrap;
}

/* โ ุชูุณูู ุฌุฐุงุจ ูุฒุฑูู ุงูุชุตุฏูุฑ/ุงูุงุณุชูุฑุงุฏ (ุจููุณ ูููุฉ ุงูุชุตููู) */
.row-btn.export-all{
  border-color:#bdebe5;
  background:linear-gradient(180deg,#eafffb,#ffffff);
  color:#0b534b;
  font-weight:900;
}
.row-btn.import-all{
  border-color:#c7d2fe;
  background:linear-gradient(180deg,#eef2ff,#ffffff);
  color:#1e3a8a;
  font-weight:900;
}
.row-btn.export-all:hover{background:#f1fffb}
.row-btn.import-all:hover{background:#f3f5ff}
/* Toast */
.toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#0c594e;color:#fff;padding:10px 14px;border-radius:999px;font-weight:800;box-shadow:0 8px 24px rgba(0,0,0,.18);opacity:0;pointer-events:none;transition:opacity .2s, transform .2s}
.toast.show{opacity:1;transform:translateX(-50%) translateY(-4px)}
/* ===== ุดุฑุญ ุนูุงุตุฑ ุชูููู ุงููุนูู (Modal Guide) ===== */

/* ุชูุนูู โูุคุดุฑ ุงูุถุบุทโ ุนูู ุนูุงููู ุงูุนูุงุตุฑ (ูููุนูู ููุท) */
/* ุชูุนูู โูุคุดุฑ ุงูุถุบุทโ ุนูู ุนูุงููู ุงูุนูุงุตุฑ (ูููุนูู ููุท) */
body.isTeacher #tbl .item{
  cursor:pointer;
  text-decoration: underline dotted;
  text-underline-offset: 3px;
}
body.isTeacher #tbl .item:hover{ color:#0c594e; }



/* ุฑุฃุณ ุงููุญุชูู ุฏุงุฎู ูุงูุฐุฉ ุงูุดุฑุญ */
.guide-top{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:2px 0 8px}
.guide-brief{margin:0;color:#415b56;font-weight:700}

.guideTbl td{line-height:1.75}
.guideRowHi{
  outline:2px solid rgba(15,179,176,.35);
  outline-offset:-2px;
  background:#f0fffa;
}

/* ูุณุงุญุฉ ููุงุญุธุงุช ุณุฑูุนุฉ */
.guide-note{
  margin-top:10px;
  border:1px dashed var(--line);
  border-radius:12px;
  padding:10px;
  background:#fbfffe;
}
.guide-note h4{margin:0 0 6px;color:#0c594e}
.guide-note ul{margin:0;padding:0 18px;color:#415b56;font-weight:700}

/* (ุงุฎุชูุงุฑู ูุงุญููุง) ุนุฑุถ ุตูุฑุฉ ุฏููู ุฏุงุฎู ุงููุงูุฐุฉ */
.guide-img{
  width:100%;
  border:1px solid var(--line);
  border-radius:12px;
  margin-top:10px;
}
/* ===== ูุงูุฐุฉ ุงูููุฏูู ุงูุนุงุฆูุฉ (CSS) ===== */
.float-video{
  position:fixed;
  right:14px;
  bottom:14px;

  /* โ ุญุฌู ุฃูุถุญ ุงูุชุฑุงุถููุง */
  width:min(92vw, 560px);
  height:320px;

  /* โ ุญุฏูุฏ ุฏููุง/ุนููุง ููุชูุจูุฑ/ุงูุชุตุบูุฑ */
  min-width:280px;
  min-height:180px;
  max-width:96vw;
  max-height:90vh;

  background:#fff;
  border:1px solid var(--line);
  border-radius:16px;
  box-shadow:0 16px 40px rgba(0,0,0,.16);
  z-index:1400;

  overflow:hidden;
  display:none;

  /* โ ุชูุจูุฑ/ุชุตุบูุฑ ุจุงูุณุญุจ (ุณุทุญ ููุชุจ) */
  resize: both;
}
.float-video.show{display:block}

/* โ ุนูุฏ ุงูุชุตุบูุฑ ูุฎูู ุงูุฅุทุงุฑ ููููู ุชุบููุฑ ุงูุญุฌู */
.float-video.min{
  height:44px;
  resize:none;
}

/* โ ูุถุน โููุนููู/ูุซุจูุชโ: ูุจูู ูู ุงูุฑูู ููุง ูุชุญุฑู */
.float-video.pinned{
  right:14px;
  bottom:14px;
  left:auto !important;
  top:auto !important;
}

/* ุงูุฑุฃุณ ูุงุจู ููุณุญุจ ููุชุญุฑูู */
.fv-head{
  height:44px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:0 10px;
  border-bottom:1px solid var(--line);
  background:linear-gradient(180deg,#e9f7f3,#fff);
  color:#0c594e;
  font-weight:900;

  cursor:move;
  user-select:none;
  -webkit-user-select:none;
  touch-action:none;
}
.float-video.pinned .fv-head{cursor:default}

.fv-actions{display:flex;gap:6px;align-items:center}
.fv-btn{
  border:1px solid var(--line);
  background:#fff;
  color:#0b534b;
  border-radius:10px;
  padding:4px 8px;
  font-weight:900;
  cursor:pointer;
}
.fv-btn:hover{background:#f6fbf9}

#fvFrame{
  width:100%;
  height:calc(100% - 44px); /* โ ูุชูููู ูุน ุฃู ุชุบููุฑ ุญุฌู */
  border:0;
  display:block;
  background:#000;          /* โ ููุถุญ ุงูููุฏูู */
}
.float-video.min #fvFrame{display:none}

@media print{
  .float-video{display:none!important}
}

/* ุชุฌุงูุฏูุฉ */
@media (max-width:920px){
  .grid4{grid-template-columns:1fr 1fr;gap:6px}
  .toolbar{gap:6px}
}
@media (max-width:720px){

  /* โ ุงูููุฏุฑ ูุจูู 3 ุฃุนูุฏุฉ ูุซู ุณุทุญ ุงูููุชุจ (ูููู ูุตูุต + ูุณุท ุดุนุงุฑ + ูุณุงุฑ ุชุงุฑูุฎ/ูููุฐุฌ) */
  .header{
    grid-template-columns: minmax(0,1fr) auto minmax(0,1fr);
    row-gap:0;
    column-gap:12px;
  }

  /* โ ุชุตุบูุฑ ุงูุดุนุงุฑ ููุฌูุงู ุจุฏูู ุชุบููุฑ ุชุฑุชูุจ ุงูููุฏุฑ */
  #moe{
    width:min(140px,26vw);
    margin:0 auto;
  }

  /* โ ููุน ุงูุชูุงู ุงููุตูุต ุฏุงุฎู ุงูููุฏุฑ (ูุน ูุต ูุทูู ุนูุฏ ุงูุถูู ุจุฏู ุงููู) */
  .hcol .line{
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    font-size:clamp(12px,2.8vw,15px);
    line-height:1.25;
    max-width:100%;
  }

  /* ูุจูู ููุง ูู */
  .kline{flex-direction:column;align-items:flex-start}
}

@media (max-width:600px){
  html,body{font-size:14px}
  #page{padding:10px 10px 36px}
  .select{height:34px;font-size:12px;padding:0 26px 0 10px}
  .lined{height:38px}
  .modal-card{width:94vw}
  .duo{grid-template-columns:1fr}
.signs{grid-template-columns:1fr 1fr; gap:10px;}
.toolbar{justify-content:flex-start; flex-wrap:nowrap;}
.toolbar > *{flex:0 0 auto;}
  .overall-pill{flex-direction:column;align-items:flex-start}
  .overall-stats{align-items:flex-start}
}
@media (max-width:480px){
  #page{padding:10px 8px 30px}
  .grid4{grid-template-columns:1fr;white-space:normal}
  .lined{white-space:normal}
  .btn{padding:7px 10px;font-size:12px}
  .goals-toggle{font-size:11px;padding:5px 10px}
}

/* ุทุจุงุนุฉ โ ุดุฏ/ุถุบุท A4 ูุตู ุจูุงูุงุช ุจูุง ุงูุชูุงู */
@media print{
  .toolbar,.tip::after,[data-hide-on-print],.modal,.help-fab,.home-fab,.lens-mini,.pen,#goalsToggle{display:none!important}
  #page{padding:0}
  @page{size:A4;margin:10mm}
  html,body{font-size:12.6px;line-height:1.55}
  .grid4{gap:6px; grid-template-columns:2fr 1fr 1fr 1fr !important; white-space:nowrap}
  .lined{height:28px;padding:0 2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  #goals .goalrow, #goalChips, #goals .hint{display:none!important}
  .goals-print{display:block}
  .goals-print .cell{border:1px solid #dbe9e5;padding:2px 6px}
  .table th,.table td{padding:6px}
  .duo .box{padding:8px}
  #goalsBody{max-height:none!important;overflow:visible!important}
}
</style>
</head>
<body>
<div id="page">

  <!-- ุงูููุฏุฑ -->
  <div class="header">
    <div class="hcol">
      <div class="line">ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ</div>
      <div class="line">ูุฒุงุฑุฉ ุงูุชุนููู</div>
      <div class="line">
        <span id="dirTxt">ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ ููุชุนููู ุจุงูููุทูุฉ ุงูุดุฑููุฉ</span>
        <button class="pen noprint" id="editDir" title="ุชุนุฏูู">โ</button>
      </div>
      <div class="line">
        <span id="schTxt"> ุงุณู ุงููุฏุฑุณุฉ ููุง</span>
        <button class="pen noprint" id="editSch" title="ุชุนุฏูู">โ</button>
      </div>
    </div>
    <img id="moe" alt="ูุฒุงุฑุฉ ุงูุชุนููู" src="ูุฒุงุฑุฉ ุงูุชุนููู.png">
    <div class="hcol" style="position:relative">
      <div class="line" id="dayTxt"></div>
      <div class="line" id="dateTxt"></div>
      <div class="line" id="mdlTxt">ูููุฐุฌ ุงูุชูููู: โ</div>
      <div class="line" id="stageTxt">ูุฑุญูุฉ ุงูุชุฎุทูุท ููุฃุฏุงุก</div>

      <!-- โ ุฒุฑ ุงูููู ุงูุฌุฏูุฏ (ุจุฌูุงุฑ ?) -->
      <a id="homeFab" class="home-fab noprint" href="https://fhz545-hub.github.io/Teachers/" target="_self" title="ุงูุนูุฏุฉ ููููุตุฉ" aria-label="ุงูุนูุฏุฉ ููููุตุฉ">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor" d="M12 3.2l9 7.4a1 1 0 0 1-1.26 1.56L19 11.6V20a1.8 1.8 0 0 1-1.8 1.8H6.8A1.8 1.8 0 0 1 5 20v-8.4l-.74.56A1 1 0 0 1 3 10.6l9-7.4Zm5 10.1-5-4.1-5 4.1V19.8h3.4v-4.2a1 1 0 0 1 1-1h1.2a1 1 0 0 1 1 1v4.2H17v-6.5Z"/>
        </svg>
      </a>

      <button id="helpFab" class="help-fab noprint" title="ุงูุดุฑุญ">?</button>
    </div>
  </div>

  <!-- ุงูุฃุฏูุงุช -->
  <div class="toolbar">
    <div class="sel">
      <select id="model" class="select">
        <option value="principal">ูุฏูุฑ ุงููุฏุฑุณุฉ</option>
        <option value="vp">ูููู ุงููุฏุฑุณุฉ</option>
        <option value="teacher" selected>ุงููุนููู</option>
        <option value="activity">ูุนูู ูุณูุฏ ูู ูุดุงุท ุทูุงุจู</option>
        <option value="health">ูุนูู ูุณูุฏ ูู ุชูุฌูู ุตุญู</option>
        <option value="counselor">ุงูููุฌู ุงูุทูุงุจู</option>
        <option value="lab">ูุญุถุฑ ุงููุฎุชุจุฑ</option>
        <option value="kg">ูุนููุฉ ุฑูุงุถ ุงูุฃุทูุงู</option>
      </select><span>โพ</span>
    </div>
    <div class="sel">
      <select id="stage" class="select">
        <option value="first" selected>ุงูุฃููู (ุงูุชุฎุทูุท)</option>
        <option value="second">ุงูุซุงููุฉ (ุงููุฑุงุฌุนุฉ ุงููุตู ุณูููุฉ)</option>
        <option value="final">ุงูุซุงูุซุฉ (ุงูุชูููู ุงูููุงุฆู)</option>
      </select><span>โพ</span>
    </div>

    <button class="btn" id="saveBtn">๐พ ุญูุธ</button>
    <button class="btn" id="gapBtn">ุฎุทุฉ ุชุญุณูู ูุฌูุฉ ุงูุฃุฏุงุก โพ</button>
    <button class="btn" id="archBtn">ูุดู ุชูููู ุงูุฃุฏุงุก โพ</button>
    <button class="btn secondary" id="dlelBtn">๐ ุฏููู ุงููุนุงููุฑ ูุงูุดูุงูุฏ</button>
    <button class="btn" id="printBtn">๐จ๏ธ ุทุจุงุนุฉ</button>
    <button class="btn warn" id="clearBtn">๐งน ูุณุญ</button>
  </div>

  <!-- ุจูุงูุงุช ุงูููุธู -->
  <div class="grid4">
    <div class="field">
      <input id="tName" class="lined" placeholder="ุงุณู ุดุงุบู ุงููุธููุฉ" autocomplete="off">
      <button id="lensMini" class="lens-mini noprint" type="button" title="ุนุฏุณุฉ ุงูุฃุณูุงุก">๐</button>
    </div>
    <input id="tId" class="lined" inputmode="numeric" placeholder="ุฑูู ุงููููุฉ" autocomplete="off">
    <input id="tSpec" class="lined" placeholder="ุงูุชุฎุตุต" autocomplete="off">
    <input id="tTitle" class="lined" placeholder="ุงููุณูู" autocomplete="off" value="ูุนูู ููุงุฑุณ">
  </div>

  <!-- ุงูุชุฎุทูุท ููุฃุฏุงุก (ูุงุจู ููุทู) -->
  <section id="goals">
    <div class="goals-head">
      <h3>ุงูุชุฎุทูุท ููุฃุฏุงุก <span class="hint">๐น ุฃูุฏุงู ูุงุจูุฉ ููููุงุณ ููุคุดุฑุงุช ูุงุถุญุฉ</span></h3>
      <button id="goalsToggle" type="button" class="btn secondary goals-toggle noprint" data-hide-on-print>ุฅุธูุงุฑ ุงูุฃูุฏุงู โผ</button>
    </div>
    <div id="goalsBody">
      <div id="goalChips" data-hide-on-print></div>
      <div class="goalrow"><input id="g1" placeholder="ุงููุฏู"><input id="g1i" placeholder="ุงููุคุดุฑ"><input id="g1t" placeholder="ุงููููุฉ ุงููุณุชูุฏูุฉ"></div>
      <div class="goalrow"><input id="g2" placeholder="ุงููุฏู"><input id="g2i" placeholder="ุงููุคุดุฑ"><input id="g2t" placeholder="ุงููููุฉ ุงููุณุชูุฏูุฉ"></div>
      <div class="goalrow"><input id="g3" placeholder="ุงููุฏู"><input id="g3i" placeholder="ุงููุคุดุฑ"><input id="g3t" placeholder="ุงููููุฉ ุงููุณุชูุฏูุฉ"></div>
      <div id="goalsPrint" class="goals-print" aria-hidden="true"></div>
    </div>
  </section>

  <!-- ุงููุคุดุฑ -->
  <div class="kpi">
    <div class="kbar"><div id="fill" class="kfill"></div></div>
    <div class="kline">
      <span id="kL">ูุคุดุฑ ุงูุฅูุฌุงุฒ: 0%</span>
      <span id="kM">ูุชูุณุท ุงูุณููููู: 0.00 / 5</span>
      <span id="kR">ูุฌููุน ุงูุฃูุฒุงู: 0%</span>
    </div>
  </div>

  <!-- ุฌุฏูู ุงูุชูููู -->
  <table class="table" id="tbl">
    <thead><tr><th style="text-align:right">ุนูุงุตุฑ ุงูุชูููู</th><th>ุงููุฒู ุงููุณุจู</th><th>ุณูููู (1โ5)</th><th>ุงููุงุชุฌ ุงูููุฒูู</th></tr></thead>
    <tbody id="rows"></tbody>
    <tfoot><tr><th style="text-align:right">ุงูุชูุฏูุฑ ุงูุนุงู ููุฃุฏุงุก (ูู 5)</th><th id="sumW">0%</th><th id="avg">0.00</th><th id="sum">0.00</th></tr></tfoot>
  </table>

  <!-- ุตู ูุณุชูู ุงูุชูุฏูุฑ ุงูุนุงู ููุฃุฏุงุก ุงูุฌุฏูุฏ -->
  <div id="overallWrap" class="overall">
    <div id="overallPill" class="overall-pill">
      <div class="overall-main">
        <span id="overallClass" class="overall-class">โ</span>
        <span id="overallDesc" class="overall-desc">ูุณุชูู ุงูุชูุฏูุฑ ุงูุนุงู ููุฃุฏุงุก</span>
      </div>
      <div class="overall-stats">
        <span id="overallPercent" class="overall-percent">ุงูุฏุฑุฌุฉ ุงููุณุจูุฉ: 0%</span>
        <span id="overallAvg" class="overall-avg">ูุชูุณุท 0.00 / 5</span>
      </div>
    </div>
  </div>

  <!-- ุงูููุฉ / ุงูุชุญุณูู โ ูุงุจูุฉ ููุชุนุฏูู -->
  <div class="duo">
    <div class="box"><h3>ููุงุท ุงูููุฉ</h3><p id="strengths" contenteditable="true">โ</p></div>
    <div class="box"><h3>ูุฌุงูุงุช ุงูุชุญุณูู ูุงูุชุทููุฑ</h3><p id="improves" contenteditable="true">โ</p></div>
  </div>

  <!-- ุชูููุนุงุช -->
  <section class="signs">
    <div class="sig"><div id="sigT" class="sig-name">โ</div><div class="sig-line"></div><div style="font-size:12px;color:#667">ุชูููุน ุงูููุธู</div></div>
    <div class="sig"><div class="sig-name" id="sigP">ุงุณู ูุฏูุฑ ุงููุฏุฑุณุฉ ููุง</div><div class="sig-line"></div><div style="font-size:12px;color:#667">ุชูููุน ุงููุฏูุฑ ุงููุจุงุดุฑ</div></div>
  </section>

  <div class="footer" data-hide-on-print>ุชูููุฐ ูุชุตููู: ููุฏ ุญุงูุฏ ุงูุฒูุฑุงูู</div>
</div>

<!-- Toast -->
<div id="toast" class="toast" role="status" aria-live="polite">ุชู ุงูุญูุธ ูุฅุจุฑุงุฒ ุงูุงุณู ูู ุงูุนุฏุณุฉ โ</div>

<!-- ูุงูุฐุฉ ุงูุดุฑุญ -->
<div id="help" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
    <div class="modal-head">
      <div class="modal-title" id="helpTitle">ุงูุดุฑุญ <span class="badge">ุฅุตุฏุงุฑ ุชุฌุฑูุจู ุบูุฑ ุฑุณูู</span></div>
      <button class="close" id="closeHelp" aria-label="ุฅุบูุงู">ุฅุบูุงู โ</button>
    </div>
    <div class="modal-body" id="helpContent"></div>
  </div>
</div>

<!-- ูุงูุฐุฉ ุนุฏุณุฉ ุงูุฃุณูุงุก -->
<div id="lens" class="modal" aria-hidden="true">
  <div class="lens-card" role="dialog" aria-modal="true" aria-labelledby="lensTitle">
    <div class="lens-head">
      <div class="lens-title" id="lensTitle">๐ ุนุฏุณุฉ ุงูุฃุณูุงุก โ ุงุณุชูุฑุงุฏ ูู Excel/CSV</div>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="searchBox" class="input" placeholder="ุงุจุญุซ ุจุงูุงุณู / ุงููููุฉ / ุงูุชุฎุตุต"/>
        <button class="close" id="closeLens" aria-label="ุฅุบูุงู">ุฅุบูุงู โ</button>
      </div>
    </div>
    <div class="lens-body">
      <div class="lens-tools">
        <label class="filebox">
<input id="fileInput" type="file" accept=".xlsx,.xls,.xlsm,.xlsb,.xltx,.xltm,.ods,.csv,.tsv,.txt,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel.sheet.macroEnabled.12,application/vnd.ms-excel.sheet.binary.macroEnabled.12,application/vnd.oasis.opendocument.spreadsheet,text/csv,text/plain" style="display:none"/>

          <span>๐ค ุงุฎุชุฑ ููู Excel/CSV</span>
          <button class="row-btn" id="pickFileBtn" type="button">ุงุณุชุนุฑุงุถ</button>
        </label>
        <span id="lensInfo" class="badge">ูุง ุชูุฌุฏ ุจูุงูุงุช ูุณุชูุฑุฏุฉ ุจุนุฏ</span>
        <button class="row-btn" id="clearPeople" type="button">ูุณุญ ุงูุฃุณูุงุก ุงููุญููุธุฉ</button>
        <!-- ุฒุฑ ุชุญููู ูุงูุจ ุนุฏุณุฉ ุงูุฃุณูุงุก -->
<button class="row-btn" id="downloadTemplate" type="button">โฌ๏ธ ุชุญููู ูุงูุจ ุงูุฃุณูุงุก (Excel)</button>
<!-- โ ุชุตุฏูุฑ/ุงุณุชูุฑุงุฏ ุฌููุน ุจูุงูุงุช ุงูุฃุฏุงุฉ -->
<span class="io-pack">
  <button class="row-btn export-all" id="exportAllData" type="button">โฌ๏ธ ุชุตุฏูุฑ ุจูุงูุงุช ุงูุฃุฏุงุฉ</button>
  <button class="row-btn import-all" id="importAllDataBtn" type="button">โฌ๏ธ ุงุณุชูุฑุงุฏ ุจูุงูุงุช ุงูุฃุฏุงุฉ</button>
  <input id="importAllInput" type="file" accept=".json,application/json" style="display:none"/>
</span>
      </div>

      <div id="dropZone" class="drop">ุงุณุญุจ ุงูููู ููุง ุฃู ุงุณุชุฎุฏู ุฒุฑ ุงูุงุณุชุนุฑุงุถ</div>

      <div class="table-wrap" style="margin-top:10px">
        <table class="tbl" id="peopleTbl" aria-label="ูุงุฆูุฉ ุงูุฃุณูุงุก">
          <thead>
            <tr><th>ุงูุงุณู</th><th>ุงููููุฉ</th><th>ุงูุชุฎุตุต</th><th>ุงููุณูู</th><th>ุงูุญุงูุฉ</th><th>ุงุฎุชูุงุฑ</th></tr>
          </thead>
          <tbody id="peopleBody"><tr><td colspan="6" style="text-align:center;color:#678">โ ูุง ุชูุฌุฏ ุจูุงูุงุช โ</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<!-- ูุงูุฐุฉ ุดุฑุญ ุนูุงุตุฑ ุชูููู ุงููุนูู (11 ุนูุตุฑ) -->
<div id="guide" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="guideTitle">
    <div class="modal-head">
      <div class="modal-title" id="guideTitle">ุดุฑุญ ุงูุนูุตุฑ</div>
      <button class="close" id="closeGuide" aria-label="ุฅุบูุงู">ุฅุบูุงู โ</button>
    </div>
    <div class="modal-body">
      <div id="guideContent"></div>
    </div>
  </div>
</div>
<!-- ูุงูุฐุฉ ุงูููุฏูู ุงูุนุงุฆูุฉ (ูุง ุชููุน ุงุณุชุฎุฏุงู ุงูุตูุญุฉ) -->
<div id="videoFloat" class="float-video" aria-hidden="true">
  <div class="fv-head">
    <span>๐ฌ ุดุฑุญ ุจุงูููุฏูู</span>

    <div class="fv-actions">
      <button id="fvPop" class="fv-btn" type="button" title="ูุชุญ ูู ุชุจููุจ ุฌุฏูุฏ">ูุชุญ โ</button>

      <button id="fvSm"  class="fv-btn" type="button" title="ุชุตุบูุฑ ุงููุงูุฐุฉ">โ</button>
      <button id="fvLg"  class="fv-btn" type="button" title="ุชูุจูุฑ ุงููุงูุฐุฉ">๏ผ</button>

      <button id="fvPin" class="fv-btn" type="button" title="ุชุนููู/ุชุญุฑูู">๐</button>

      <button id="fvReset" class="fv-btn" type="button" title="ุฅุนุงุฏุฉ ุถุจุท">โบ</button>

      <button id="fvMin" class="fv-btn" type="button" title="ุชุตุบูุฑ/ุฅุธูุงุฑ">โ</button>
      <button id="fvClose" class="fv-btn" type="button" title="ุฅุบูุงู">ุฅุบูุงู โ</button>
    </div>
  </div>

  <iframe id="fvFrame"
          src=""
          allow="autoplay; fullscreen; picture-in-picture"
          allowfullscreen></iframe>
</div>


<script>
const $=s=>document.querySelector(s), $$=s=>[...document.querySelectorAll(s)];

/* ุชุงุฑูุฎ */
(function(){
  const d=new Date(),days=['ุงูุฃุญุฏ','ุงูุงุซููู','ุงูุซูุงุซุงุก','ุงูุฃุฑุจุนุงุก','ุงูุฎููุณ','ุงูุฌูุนุฉ','ุงูุณุจุช'];
  $('#dayTxt').textContent=days[d.getDay()];
$('#dateTxt').textContent = new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura',{year:'numeric',month:'2-digit',day:'2-digit'}).format(d);
})();

/* ููุงุชูุญ ุงูุชุฎุฒูู */
const K_P='PF_principal', K_DIR='PF_dir', K_SCH='PF_school';
const K_SESSION='PF_session';
const K_DB='PF_db';
const K_PEOPLE='PF_people'; // ุนุฏุณุฉ ุงูุฃุณูุงุก

/* ุชุญููู/ุชุนุฏูู ุงูุฅุฏุงุฑุฉ ูุงููุฏุฑุณุฉ */
(function initOrg(){
  const dirSaved=localStorage.getItem(K_DIR); const schSaved=localStorage.getItem(K_SCH);
  if(dirSaved) $('#dirTxt').textContent=dirSaved;
  if(schSaved) $('#schTxt').textContent=schSaved;

  $('#editDir').onclick=()=>{const v=prompt('ุงูุฅุฏุงุฑุฉ ุงูุชุนููููุฉ', $('#dirTxt').textContent.trim()); if(v!==null){$('#dirTxt').textContent=(v.trim()||'โ'); localStorage.setItem(K_DIR,$('#dirTxt').textContent); snap();}};
  $('#editSch').onclick=()=>{const v=prompt('ุงุณู ุงููุฏุฑุณุฉ', $('#schTxt').textContent.trim()); if(v!==null){$('#schTxt').textContent=(v.trim()||'โ'); localStorage.setItem(K_SCH,$('#schTxt').textContent); snap();}};
})();

/* ุชูููุน ุงููุฏูุฑ */
$('#sigP').textContent=localStorage.getItem(K_P)||$('#sigP').textContent;
$('#sigP').onclick=()=>{const v=prompt('ุงุณู ูุฏูุฑ ุงููุฏุฑุณุฉ', $('#sigP').textContent.trim()); if(v!==null){$('#sigP').textContent=(v.trim()||'โ'); localStorage.setItem(K_P,$('#sigP').textContent); snap();}};

/* ูุญุชูู ุงูุดุฑุญ โ ููุง ูู */
const HELP_TEXT = `
<p><b>๐น ูููุฐุฌ ุชูููู ุงูุฃุฏุงุก ุงููุธููู</b> <span class="badge">ุฅุตุฏุงุฑ ุชุฌุฑูุจู ูุณุงูุฏ</span></p>

<p>
ุฃุฏุงุฉ ุฅููุชุฑูููุฉ ุชุฑุจููุฉ ููุณูุฑุฉ ูุฏุนู ุงููุงุฆุฏ ูุงููุนูู ูู
<mark>ุชุฎุทูุท ุงูุฃูุฏุงูุ ูููุงุณ ุงูุฃุฏุงุกุ ูุชุญููู ุงููุชุงุฆุฌ</mark> ุจุฃุณููุจ ูุงุถุญ ูุนูููุ
ุจูุง ูุฎุฏู ุงูุชุญุณูู ุงููุณุชูุฑ ูุฌูุฏุฉ ุงูููุงุฑุณุงุช ุฏุงุฎู ุงููุฏุฑุณุฉ.
</p>

<h4>โณ๏ธ ุฃุจุฑุฒ ุงููุฒุงูุง:</h4>
<ul>
  <li><b>ุชุฎุทูุท ุฐูู ููุฃุฏุงุก:</b> ุฃูุฏุงู ูุงุจูุฉ ููููุงุณ ุจูุคุดุฑุงุช ูููู ูุณุชูุฏูุฉ ูู ุจูู ุฃูุฏุงู ููุงุณุจ ููู ูููุฐุฌ.</li>
  <li><b>ุชุญููู ููุฑู ูุฏููู:</b> ุงุญุชุณุงุจ ุชููุงุฆู ููุฃูุฒุงูุ ููุชูุณุท ุงูุณูููููุ ููุคุดุฑ ุงูุฅูุฌุงุฒ ูุน ุชูููู ูุงุถุญ ููุฑุงุกุฉ ุงููุชุงุฆุฌ ุจุณุฑุนุฉ.</li>
  <li><b>ุนุฏุณุฉ ุจูุงูุงุช:</b> ุงุณุชูุฑุงุฏ ุฃุณูุงุก ุงููุนูููู ูู Excel/CSV ูุน ุจุญุซ ุณุฑูุน ูุงุฎุชูุงุฑ ููุฑู.</li>
  <li><b>ุฎุทุฉ ุชุญุณูู ูุฌูุงุช ุงูุฃุฏุงุก:</b> ุชูููุฏ ุตูุญุฉ ูุณุชููุฉ ูุนูุงุตุฑ ุงูุชุญุณูู ุงูููุชุฑุญุฉ ุจูุงุกู ุนูู ุงููุชุงุฆุฌ ูุดูุงูุฏ ุงููุชุงุจุนุฉ.</li>
  <li><b>ูุดู ุชูููู ุงูุฃุฏุงุก:</b> ุญูุธ ูุงุณุชุฑุฌุงุน ุณุฌูุงุช ุงูุชูููู ูุน ุฅุจุฑุงุฒ ุญุงูุฉ โูุญููุธโ ุฏุงุฎู ุงูุนุฏุณุฉ.</li>
  <li><b>ูุณุฎ ุงุญุชูุงุทูุฉ ูุงุณุชุฑุฌุงุน:</b> <span class="badge">ุชุตุฏูุฑ/ุงุณุชูุฑุงุฏ ุจูุงูุงุช ุงูุฃุฏุงุฉ</span> ุจููู ูุคุฑูุฎ ูุณูููุฉ ุงูุฑุฌูุน ูุฃู ูุณุฎุฉ ุนูุฏ ุงูุญุงุฌุฉ.</li>
  <li><b>ุฅุฎุฑุงุฌ ุฌุงูุฒ ููุทุจุงุนุฉ (A4):</b> ุชุตููู ููุณู ุจูููุฉ ุชุฑุจููุฉ ูุชูุงูู ูุน ุงูุทุจุงุนุฉ ูููุงุณุจ ููุฌูุงู.</li>
</ul>

<h4>๐ง ููู ุชุณุชููุฏ ุจุดูู ุนูููุ</h4>
<ul>
  <li>ุงุจุฏุฃ ุจูุฑุญูุฉ <b>ุงูุชุฎุทูุท</b> ุซู ุงูุชูู ูููุฑุงุฌุนุฉ ุงููุตู ุณูููุฉ ุซู ุงูุชูููู ุงูููุงุฆู.</li>
  <li>ุฏุน ุงููุชุงุฆุฌ ุชููุฏ ุงููุฑุงุฑ: ุฑููุฒ ุนูู ุงูุจููุฏ ุฐุงุช ุงูุฏุฑุฌุงุช ุงูููุฎูุถุฉ ูุฎุทุท ููุง <b>ุฅุฌุฑุงุกุงุช ูุตูุฑุฉ + ุดูุงูุฏ ูุชุงุจุนุฉ</b>.</li>
  <li>ุงุญูุธ ุจุนุฏ ูู ุชุญุฏูุซ ูุชุซุจูุช ุงูุณุฌู ูุฅุธูุงุฑ โูุญููุธโ ูู ุงูุนุฏุณุฉ.</li>
  <li>ูุจู ุฃู ุตูุงูุฉ ููุฌูุงุฒ ุฃู ุชุบููุฑ ุงููุชุตูุญ ุงุณุชุฎุฏู <b>ุชุตุฏูุฑ ุจูุงูุงุช ุงูุฃุฏุงุฉ</b> ููุณุฎุฉ ุงุญุชูุงุทูุฉ.</li>
</ul>

<p class="badge">๐ ุงูุฎุตูุตูุฉ ูุญูุงูุฉ ุงูุจูุงูุงุช</p>
<ul>
  <li>ุชุฎุฒูู ุงูุจูุงูุงุช ูุชู <b>ูุญูููุง ุฏุงุฎู ุงููุชุตูุญ</b> ุนูู ุฌูุงุฒู (LocalStorage) ููุง ูุชู ุฑูุนูุง ุชููุงุฆููุง ูุฃู ุฌูุฉ.</li>
  <li>ุฃู ูุดุงุฑูุฉ/ุทุจุงุนุฉ/ุชุตุฏูุฑ ุชุชู <b>ุจูุฑุงุฑ ุงููุณุชุฎุฏู</b> ููุท.</li>
  <li>ูููุตู ุจุนุฏู ุฅุฏุฎุงู ุจูุงูุงุช ุบูุฑ ูุงุฒูุฉุ ูุงูุงูุชุฒุงู ุจุณูุงุณุงุช ุงููุฏุฑุณุฉ ูุญูููุฉ ุงูุจูุงูุงุช ุงููุนุชูุฏุฉ.</li>
</ul>

<p class="badge">โ๏ธ ุชูููู ููู ูุฅุฎูุงุก ูุณุคูููุฉ</p>
<ul>
  <li>ูุฐู ุงูุฃุฏุงุฉ <b>ููุณุช ูููุฐุฌูุง ุฑุณูููุง</b> ููุง ุชูุซู ุฃู ุฌูุฉุ ููู ูุณููุฉ ูุณุงูุฏุฉ ุฏุงุฎููุฉ ูุชุณููู ุงูุชูุซูู ูุงูุชุญููู.</li>
  <li>ุงููุฎุฑุฌุงุช <b>ุชูุฏูุฑูุฉ/ูุณุงูุฏุฉ</b> ูุชุจูู ุตุญุฉ ุงูุจูุงูุงุช ูุฏูุชูุง ูุงุนุชูุงุฏูุง ุถูู ุงูุตูุงุญูุงุช ุงูุฑุณููุฉ ูุณุคูููุฉ ูุณุชุฎุฏู ุงูุฃุฏุงุฉ ูุงูุฌูุฉ ุงูุฅุฏุงุฑูุฉ.</li>
  <li>ูุง ุชูุฌุฏ ุฃู ุนูุงูุฉ ุงุนุชูุงุฏ/ุฑุนุงูุฉ/ุชุจููู ูู ุฃู ุฌูุฉุ ููุง ูุญู ุนุฑุถ ุงูุฃุฏุงุฉ ุฃู ูุชุงุฆุฌูุง ุนูู ุฃููุง <b>ูุซููุฉ ุฑุณููุฉ</b>.</li>
  <li>ุงุณุชุฎุฏุงู ุงูุฃุฏุงุฉ ูุนูู ุงูููุงููุฉ ุนูู ุงุณุชุฎุฏุงููุง <b>ูุฃุบุฑุงุถ ูุฏุฑุณูุฉ ุฏุงุฎููุฉ</b> ูุจูุง ูุง ูุฎุงูู ุงูุฃูุธูุฉ ูุงูููุงุฆุญ ูุงูุชุนูููุงุช ุงูุชูุธูููุฉ.</li>
  <li>ุงููุตูู ูุง ูุชุญูู ุฃู ุชุจุนุงุช ูุงุดุฆุฉ ุนู ุฅุณุงุกุฉ ุงูุงุณุชุฎุฏุงู ุฃู ูุดุงุฑูุฉ ุงูุจูุงูุงุช ุฎุงุฑุฌ ุงููููุงุช ุงููุธุงููุฉ.</li>
</ul>

<p>
ุชู ุงูุนูู ุนูู ุฅุนุฏุงุฏูุง ููุฌู ุงููู ุชุนุงููุ ุฑุงุฌููุง ุงูุฃุฌุฑ ูุงูุซูุงุจุ ูุตุฏูุฉู ุฌุงุฑูุฉู ูููุงูุฏูู ููู ููุฃุณุฑุชูุ
ุฌุนููุง ุงููู ุฎุงูุตุฉู ููุฌูู ุงููุฑูู ููุงูุนูุฉู ููููุฏุงู ุงูุชุนูููู.
</p>

<div style="margin-top:14px; text-align:center;">
  <button onclick="window.open('https://drive.google.com/file/d/1h76lUCBP4lO2qeFLkqbCDDVlJY_IPm7o/view','_blank')"
    style="background:linear-gradient(90deg,#1e8a79,#23b8a2);color:#fff;padding:10px 18px;border:none;border-radius:10px;margin:4px;cursor:pointer;font-weight:800;">
    ๐ ุงูุฏููู ุงูุฅุฑุดุงุฏู ูุฅุฏุงุฑุฉ ุงูุฃุฏุงุก ุงููุธููู
  </button>

  <button onclick="window.open('https://drive.google.com/file/d/1dr09uQ7u5hdlghwrtpLGzFsjR35XTZfP/view','_blank')"
    style="background:linear-gradient(90deg,#0fb3b0,#16a34a);color:#fff;padding:10px 18px;border:none;border-radius:10px;margin:4px;cursor:pointer;font-weight:800;">
    ๐งฉ ุงูุฏููู ุงูุฅุฑุดุงุฏู ููุฌุฏุงุฑุงุช ุงูููููุฉ
  </button>

  <!-- โ ุฒุฑ ููุฏูู ุงูุดุฑุญ (ููุง ุจุงูุถุจุท) -->
  <button id="openHelpVideo"
    style="background:linear-gradient(90deg,#0c594e,#1e8a79);color:#fff;padding:10px 18px;border:none;border-radius:10px;margin:4px;cursor:pointer;font-weight:900;">
    ๐ฌ ููุฏูู ุงูุดุฑุญ
  </button>
</div>


<p style="text-align:center;margin-top:12px;font-size:14px;">
  <span style="display:inline-block;margin:6px;">
    <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f4f2.svg" alt="ูุงุชุณุงุจ" style="width:18px;vertical-align:middle;margin-left:5px;">
    <a href="https://wa.me/966504532489" target="_blank" style="color:#1e8a79;text-decoration:none;">0504532489</a>
  </span>
  &nbsp; | &nbsp;
  <span style="display:inline-block;margin:6px;">
    <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/2709.svg" alt="ุฅูููู" style="width:18px;vertical-align:middle;margin-left:5px;">
    <a href="mailto:fhz545@gmail.com" style="color:#1e8a79;text-decoration:none;">fhz545@gmail.com</a>
  </span>
</p>
`;

$('#helpContent').innerHTML = HELP_TEXT;
/* ===== ููุฏูู ุงูุดุฑุญ (ูุงูุฐุฉ ุนุงุฆูุฉ ุบูุฑ ุญุงุฌุจุฉ) ===== */
const DRIVE_VIEW_URL = "https://drive.google.com/file/d/1Z4X6_WRtB9CbDMZvfZRPelK7dO7L_JIa/view?usp=sharing";
const DRIVE_PREVIEW_URL = "https://drive.google.com/file/d/1Z4X6_WRtB9CbDMZvfZRPelK7dO7L_JIa/preview";

function openFloatVideo(){
  const box = $('#videoFloat');
  const frame = $('#fvFrame');
  if(!box || !frame) return;

  if(frame.getAttribute('src') !== DRIVE_PREVIEW_URL) frame.src = DRIVE_PREVIEW_URL;

  restoreFV(); // โ ุงุณุชุฑุฌุงุน ุงูุญุฌู/ุงูููุงู/ุงูุชุนููู
  box.classList.add('show');
  box.classList.remove('min');
  box.setAttribute('aria-hidden','false');
}


function closeFloatVideo(){
  const box = $('#videoFloat');
  const frame = $('#fvFrame');
  if(!box || !frame) return;

  box.classList.remove('show');
  box.classList.remove('min');
  box.setAttribute('aria-hidden','true');

  frame.removeAttribute('src');
}


function toggleMinVideo(){
  const box = $('#videoFloat');
  if(!box) return;
  box.classList.toggle('min');
}

/* ุฒุฑ ุงูููุฏูู ุฏุงุฎู ูุงูุฐุฉ ุงูุดุฑุญ (ูุฃู HELP_TEXT ููุญูู ุฏููุงููููุงู) */
document.addEventListener('click', (e)=>{
  if(e.target && (e.target.id === 'openHelpVideo' || e.target.closest('#openHelpVideo'))){
    openFloatVideo();
  }
});

$('#fvClose')?.addEventListener('click', closeFloatVideo);
$('#fvMin')?.addEventListener('click', toggleMinVideo);
$('#fvPop')?.addEventListener('click', ()=> window.open(DRIVE_VIEW_URL, '_blank'));
/* ===== ุชุญูู ูุงูุฐุฉ ุงูููุฏูู: ุชุญุฑูู + ุชุนููู + ุชูุจูุฑ/ุชุตุบูุฑ + ุญูุธ ===== */
const K_FV = 'PF_videoFloat';

function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

function readFV(){
  try{ return JSON.parse(localStorage.getItem(K_FV) || '{}') || {}; }
  catch{ return {}; }
}
function saveFV(state){
  localStorage.setItem(K_FV, JSON.stringify(state||{}));
}

function currentFV(){
  const box = $('#videoFloat');
  const s = readFV();
  if(!box) return s;

  const r = box.getBoundingClientRect();
  return {
    pinned: box.classList.contains('pinned'),
    w: Math.round(r.width),
    h: Math.round(r.height),
    left: box.style.left ? Math.round(parseFloat(box.style.left)) : null,
    top:  box.style.top  ? Math.round(parseFloat(box.style.top))  : null
  };
}

function applyPinned(on){
  const box = $('#videoFloat');
  const pinBtn = $('#fvPin');
  if(!box) return;

  if(on){
    box.classList.add('pinned');
    box.style.left = '';
    box.style.top  = '';
    box.style.right = '14px';
    box.style.bottom = '14px';
    if(pinBtn) pinBtn.textContent = '๐';
  }else{
    box.classList.remove('pinned');
    const r = box.getBoundingClientRect();
    box.style.left = clamp(r.left, 6, window.innerWidth - r.width - 6) + 'px';
    box.style.top  = clamp(r.top,  6, window.innerHeight - r.height - 6) + 'px';
    box.style.right = 'auto';
    box.style.bottom = 'auto';
    if(pinBtn) pinBtn.textContent = '๐งท';
  }
  saveFV(currentFV());
}

function restoreFV(){
  const box = $('#videoFloat');
  if(!box) return;

  const s = readFV();

  if(s.w) box.style.width  = clamp(s.w, 280, Math.min(window.innerWidth - 12, 900)) + 'px';
  if(s.h) box.style.height = clamp(s.h, 180, Math.min(window.innerHeight - 12, 900)) + 'px';

  applyPinned(!!s.pinned);

  if(!s.pinned && s.left!=null && s.top!=null){
    const r = box.getBoundingClientRect();
    box.style.left = clamp(s.left, 6, window.innerWidth - r.width - 6) + 'px';
    box.style.top  = clamp(s.top,  6, window.innerHeight - r.height - 6) + 'px';
    box.style.right = 'auto';
    box.style.bottom = 'auto';
  }
}

function resizeStep(dw, dh){
  const box = $('#videoFloat');
  if(!box || box.classList.contains('min')) return;

  const r = box.getBoundingClientRect();
  const nw = clamp(r.width + dw, 280, window.innerWidth - 12);
  const nh = clamp(r.height + dh, 180, window.innerHeight - 12);
  box.style.width  = Math.round(nw) + 'px';
  box.style.height = Math.round(nh) + 'px';
  saveFV(currentFV());
}

function resetFV(){
  const box = $('#videoFloat');
  if(!box) return;

  box.style.width = '';
  box.style.height = '';
  applyPinned(true);
  saveFV(currentFV());
}

$('#fvLg')?.addEventListener('click', ()=> resizeStep(+80, +60));
$('#fvSm')?.addEventListener('click', ()=> resizeStep(-80, -60));
$('#fvReset')?.addEventListener('click', resetFV);
$('#fvPin')?.addEventListener('click', ()=>{
  const box = $('#videoFloat');
  if(!box) return;
  const pinned = box.classList.contains('pinned');
  applyPinned(!pinned);
});

/* ุชุญุฑูู ุงููุงูุฐุฉ ุจุงูุณุญุจ ูู ุงูุฑุฃุณ */
(function enableDrag(){
  const box = $('#videoFloat');
  const head = box?.querySelector('.fv-head');
  if(!box || !head) return;

  let dragging=false, offX=0, offY=0;

  head.addEventListener('pointerdown', (e)=>{
    if(e.target.closest('.fv-actions')) return;
    if(box.classList.contains('pinned')) return;
    if(box.classList.contains('min')) return;

    dragging = true;
    head.setPointerCapture?.(e.pointerId);

    const r = box.getBoundingClientRect();
    offX = e.clientX - r.left;
    offY = e.clientY - r.top;

    box.style.left = r.left + 'px';
    box.style.top  = r.top  + 'px';
    box.style.right = 'auto';
    box.style.bottom = 'auto';

    e.preventDefault();
  });

  head.addEventListener('pointermove', (e)=>{
    if(!dragging) return;
    const r = box.getBoundingClientRect();

    const nx = clamp(e.clientX - offX, 6, window.innerWidth  - r.width  - 6);
    const ny = clamp(e.clientY - offY, 6, window.innerHeight - r.height - 6);

    box.style.left = Math.round(nx) + 'px';
    box.style.top  = Math.round(ny) + 'px';

    saveFV(currentFV());
  });

  head.addEventListener('pointerup', ()=>{
    dragging=false;
    saveFV(currentFV());
  });
})();

/* ุญูุธ ุชููุงุฆู ุนูุฏ ุชุบููุฑ ุงูุญุฌู ุจุงูุณุญุจ */
(function watchResize(){
  const box = $('#videoFloat');
  if(!box || typeof ResizeObserver === 'undefined') return;

  const ro = new ResizeObserver(()=>{
    if(box.classList.contains('min')) return;
    saveFV(currentFV());
  });
  ro.observe(box);
})();

window.addEventListener('resize', ()=>{
  const box = $('#videoFloat');
  if(!box || box.classList.contains('pinned')) return;
  const r = box.getBoundingClientRect();
  box.style.left = clamp(r.left, 6, window.innerWidth  - r.width  - 6) + 'px';
  box.style.top  = clamp(r.top,  6, window.innerHeight - r.height - 6) + 'px';
  saveFV(currentFV());
});
/* ===== ุฑุจุท ุนูุงููู ุนูุงุตุฑ ุชูููู ุงููุนูู ุจูุงูุฐุฉ ุดุฑุญ ===== */

const TEACHER_GUIDES = {
  "ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ": {
    w: 10,
    brief: "ูููุณ ุงูุงูุชุฒุงู ุจุงูุฃูุธูุฉ ูุงูุฏูุงู ูุฌูุฏุฉ ุชูููุฐ ุงูููุงู ุงูุตููุฉ ูุงููุฏุฑุณูุฉ ูุงูุชููููุงุช.",
    rows: [
      {e:"ุงูุชููุฏ ุจุงูุฃูุธูุฉ", d:"ุณุฌู ุงููุชุงุจุนุฉ ูุณุฌู ุงูููุงุญุธุงุช"},
      {e:"ุงูุงูุชุฒุงู ุจุงูุฏูุงู ุงูุฑุณูู ูุฃุฎูุงููุงุช ุงููููุฉ", d:"ุณุฌู ุงูุฏูุงู ูุงููุชุงุจุนุฉ (ุญุถูุฑู)"},
      {e:"ุชุฃุฏูุฉ ุงูุญุตุต ุงูุฏุฑุงุณูุฉ ุญุณุจ ุงูุฌุฏูู", d:"ุฌุฏูู ุงูุญุตุต ูุณุฌู ุงููุชุงุจุนุฉ"},
      {e:"ุฅุนุฏุงุฏ ุงูุฏุฑูุณ ูุงูุชุญุถูุฑ ุงูุฐููู ุงููุณุจู", d:"ูููุฐุฌ ุงูุชุญุถูุฑ ูุฎุทุฉ ุงููููุฌ ุนูู ููุตุฉ ูุฏุฑุณุชู"},
      {e:"ุชุตุญูุญ ุงููุงุฌุจุงุช ูุงูุงุฎุชุจุงุฑุงุช", d:"ููุงุฐุฌ ูุตุญุญุฉ ูู ุงููุงุฌุจุงุช ูุงูุงุฎุชุจุงุฑุงุช"},
      {e:"ุงููุดุงุฑูุฉ ูู ุงูุฅุดุฑุงู ูุงูููุงูุจุฉ ูุญุตุต ุงูุงูุชุธุงุฑ", d:"ุณุฌู ุงูููุงูุจุฉ ูุณุฌู ุงูุงูุชุธุงุฑ ูุงูุฅุดุฑุงู"},
      {e:"ุงูุนูู ุถูู ุงููุฌุงู ุงููุฏุฑุณูุฉ ุจูุงุนููุฉ", d:"ุณุฌู ุงููุฌุงู ูุงููุดุงุฑูุงุช"},
      {e:"ุงููุณุงููุฉ ูู ุงูุฃูุดุทุฉ ูุงูููุงุณุจุงุช ุงููุทููุฉ ูุงููุฏุฑุณูุฉ ุจูุงุนููุฉ", d:"ุตูุฑ ูุชูุงุฑูุฑ ุงููุนุงููุงุช"},
      {e:"ุงููุจุงุฏุฑุฉ ูู ุชูุฏูู ุฃููุงุฑ ุชุทููุฑูุฉ ุชุฑุจููุฉ ูุชุนููููุฉ", d:"ุดูุงูุฏ ูุชูุฑูุฑ ุงููุจุงุฏุฑุฉ ุงููููุฐุฉ"},
      {e:"ุงูููุงู ุจุฃู ููุงู ูููููู ุจูุง ูู ุฅุฏุงุฑุฉ ุงููุฏุฑุณุฉ ุญุณุจ ุงุฎุชุตุงุตู", d:"ุชูุฑูุฑ"}
    ],
    notes: [
      "ูุซูู ุงูุชูููุฐ ุจุณุฌู ูุชุงุจุนุฉ ูุฎุชุตุฑ (ุชุงุฑูุฎ/ููุงุญุธุฉ/ุฅุฌุฑุงุก).",
      "ุงุฑุจุท ุงูุชุญุถูุฑ ูุฎุทุฉ ุงููููุฌ ุจุงูุดูุงูุฏ ุงููุชุงุญุฉ (ูุฏุฑุณุชู/ุชุญุงุถูุฑ/ููุงุฐุฌ).",
      "ุงุฌุนู ุงูุชูุงุฑูุฑ ูุตูุฑุฉ ููุงุถุญุฉ ููุคุฑุฎุฉ."
    ]
  },

  "ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู": {
    w: 10,
    brief: "ูููุณ ุงููุดุงุฑูุฉ ุงูููููุฉ ูุงูุชุทููุฑ ุงููุณุชูุฑ ูุชุจุงุฏู ุงูุฎุจุฑุงุช ูุงููุณุงููุฉ ุงููุนุฑููุฉ.",
    rows: [
      {e:"ุงููุดุงุฑูุฉ ุงููุงุนูุฉ ูู ูุฌุชูุนุงุช ุงูุชุนูู ุงูููููุฉ", d:"ุณุฌู ุงููุฌุชูุนุงุช ุงูููููุฉ"},
      {e:"ุงูุฑุฎุตุฉ ุงูููููุฉ ูุงูุชุทููุฑ ุงููููู", d:"ูุณุฎุฉ ูู ุงูุฑุฎุตุฉ ูุดูุงุฏุงุช ุงูุชุทููุฑ ุงููููู"},
      {e:"ุชุจุงุฏู ุงูุฒูุงุฑุงุช ูุงูุฏุฑูุณ ุงูุชุทุจูููุฉ ุงููุนุชูุฏุฉ", d:"ุณุฌู ุงูุฒูุงุฑุงุช ูุชูุฑูุฑ ุฏุฑุณ ุชุทุจููู"},
      {e:"ุงููุณุงููุฉ ุงููุนุฑููุฉ", d:"ููุงุฐุฌ"},
      {e:"ุญุถูุฑ ุงูุฏูุฑุงุช ูุงููุฑุด ุงูุชุฏุฑูุจูุฉ", d:"ุดูุงุฏุงุช ุงูุญุถูุฑ"}
    ],
    notes: [
      "ูุซูู ุญุถูุฑ/ูุดุงุฑูุฉ PLC ุจูุญุงุถุฑ ูุตูุฑุฉ ุฃู ุตูุฑ ุดุงุดุฉ ุนูุฏ ุงูุญุงุฌุฉ.",
      "ุงุฌูุน ุดูุงุฏุงุช ุงูุชุทููุฑ ูู ููู ูุงุญุฏ (PDF) ูุน ููุฑุณ ุจุณูุท.",
      "ูู ุงูุฒูุงุฑุงุช ุงูุตููุฉ: ุฑููุฒ ุนูู โููุงุญุธุฉ + ุชุญุณููโ ุจุดูู ูุฎุชุตุฑ."
    ]
  },

  "ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ": {
    w: 10,
    brief: "ูููุณ ูุงุนููุฉ ุงูุชูุงุตู ูุน ุงูุฃุณุฑุฉ ุจูุง ูุฏุนู ุงูุชุญุตูู ูุงูุงูุถุจุงุท ุจุตูุฑุฉ ููุธูุฉ.",
    rows: [
      {e:"ุงูุชูุงุตู ุงููุนุงู ูุน ุฃูููุงุก ุงูุฃููุฑ", d:"ุชูุฑูุฑ ุงูุชูุงุตู ูููุตุฉ ูุฏุฑุณุชู"},
      {e:"ุชุฒููุฏ ุฃูููุงุก ุงูุฃููุฑ ุจูุณุชูู ุงูุทูุงุจ", d:"ููุงุฐุฌ ุชูุงุฑูุฑ ุงูุฃุฏุงุก"},
      {e:"ุฅูุตุงู ุงูููุงุญุธุงุช ุงูุฃูุงุฏูููุฉ ูุงูุณููููุฉ", d:"ุณุฌู ุงูููุงุญุธุงุช"},
      {e:"ุงููุดุงุฑูุฉ ูู ุงูููุงุกุงุช ุจูุงุนููุฉ", d:"ุตูุฑ ูุชูุงุฑูุฑ"},
      {e:"ุฅุฑุณุงู ุฎุทุฉ ุงูุชุนูู ุงูุฃุณุจูุนูุฉ", d:"ูุณุฎุฉ ูู ุงูุฎุทุฉ ุงูุฃุณุจูุนูุฉ"}
    ],
    notes: [
      "ุงุนุชูุฏ ูููุงุช ุงููุฏุฑุณุฉ ุงูุฑุณููุฉ ูุงุญุชูุธ ุจุณุฌู ุชูุงุตู ูุฎุชุตุฑ.",
      "ุงุฌุนู ุงูุชูุงุฑูุฑ ููุฌุฒุฉ (ูุณุชูู/ููุงุญุธุฉ/ุฅุฌุฑุงุก/ููุนุฏ ูุชุงุจุนุฉ).",
      "ุญุงูุธ ุนูู ุฎุตูุตูุฉ ุงูุจูุงูุงุช ุนูุฏ ุงููุดุงุฑูุฉ ูุงูุทุจุงุนุฉ."
    ]
  },

  "ุงูุชููุน ูู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฏุฑูุณ": {
    w: 10,
    brief: "ูููุณ ุชูููุน ุงูุงุณุชุฑุงุชูุฌูุงุช ููุฑุงุนุงุฉ ุงููุฑูู ูุชุดุฌูุน ุงูุชูููุฑ ุงููุงูุฏ ูุฏูุฌ ุงูุชุนูู ุงููุดุท.",
    rows: [
      {e:"ุงุณุชุฎุฏุงู ุงุณุชุฑุงุชูุฌูุงุช ูุชููุนุฉ ุชูุงุณุจ ุงููุชุนูููู", d:"ุชูุฑูุฑ ุฏุฑูุณ ูุชููุนุฉ"},
      {e:"ูุฑุงุนุงุฉ ุงููุฑูู ุงููุฑุฏูุฉ ุจูู ุงูุทูุงุจ", d:"ุฃูุซูุฉ ูู ุงูุชุฎุทูุท ุงููุฑุงุนู ูููุฑูู"},
      {e:"ุงูุงุจุชูุงุฑ ูุงูุชุทููุฑ ูุงุณุชุฑุงุชูุฌูุงุช ุงูุชุนููู", d:"ููู ุงูุฅูุฌุงุฒ ูุชูุฑูุฑ ููุงุญุธุงุช ุงููุงุฆุฏ"},
      {e:"ุชุดุฌูุน ุงูุชูููุฑ ุงููุงูุฏ ูุงูุฅุจุฏุงุน ูุฏู ุงููุชุนูููู", d:"ุฏุฑูุณ ุชุชุถูู ููุงุฑุงุช ุงูุชูููุฑ ุงูุนููุง"},
      {e:"ุฏูุฌ ุงูุทูุงุจ ูู ุฃูุดุทุฉ ุฌูุงุนูุฉ ูุชุนุงูููุฉ \"ุงูุชุนูู ุงููุดุท\"", d:"ุตูุฑ ูุชูุซูู ุฃูุดุทุฉ ุตููุฉ"}
    ],
    notes: [
      "ูุซูู ุงุณุชุฑุงุชูุฌูุฉ ูุงุญุฏุฉ ุฃุณุจูุนููุง ุจุตูุฑุฉ ุฃู ูุฑูุฉ ูุดุงุท ูุตูุฑุฉ.",
      "ุจููู ููู ุนุงูุฌุช ุงููุฑูู (ูููุฉ ุจุฏููุฉ/ุชุฏุฑุฌ/ูุฌููุนุงุช).",
      "ุงุฌุนู ุงูุดูุงูุฏ ูุฑุชุจุทุฉ ุจุฏุฑุณ ูุญุฏุฏ ูุชุงุฑูุฎ ูุญุฏุฏ."
    ]
  },

  "ุชุญุณูู ูุชุงุฆุฌ ุงููุชุนูููู": {
    w: 10,
    brief: "ูููุณ ูุนุงูุฌุฉ ุงููุงูุฏ ูุจูุงุก ุฎุทุท ุนูุงุฌูุฉ/ุฅุซุฑุงุฆูุฉ ูุชุญููู ุงููุชุงุฆุฌ ูุชุญููู ููู ููุญูุธ.",
    rows: [
      {e:"ูุนุงูุฌุฉ ุงููุงูุฏ ุงูุชุนูููู", d:"ุฎุทุท ุนูุงุฌูุฉ ูุณุฌูุงุช ูุชุงุจุนุฉ"},
      {e:"ูุถุน ุฎุทุท ุนูุงุฌูุฉ ููุทูุงุจ ุงููุชุนุซุฑูู", d:"ุฎุทุท ูุฑุฏูุฉ ูุชูุงุฑูุฑ"},
      {e:"ูุถุน ุฎุทุท ุฅุซุฑุงุฆูุฉ ููุทูุงุจ ุงููุชููุฒูู", d:"ุฃูุดุทุฉ ุฅุถุงููุฉ ูุชูุฑููุงุช"},
      {e:"ุชุญููู ูุชุงุฆุฌ ุงูุทูุงุจ ุจุดูู ุฏูุฑู", d:"ูููุฐุฌ ุชุญููู ูููุงุฑูุฉ ุงููุชุงุฆุฌ"},
      {e:"ุชุญููู ููู ููุญูุธ ูู ูุณุชูู ุงูุชุญุตูู ุงูุฏุฑุงุณู ูุงูุงุฎุชุจุงุฑุงุช ุงูุฏูููุฉ ูุงุฎุชุจุงุฑุงุช ูุงูุณ", d:"ุชูุงุฑูุฑ ุงูุชุญุณู ูู ูุชุงุฆุฌ ุงูุทูุงุจ ูุงูุฒูุงุฑุงุช ุงูุตููุฉ"}
    ],
    notes: [
      "ุงุฑุจุท ูู ุฎุทุฉ ุนูุงุฌูุฉ ุจูุคุดุฑ (ูุจู/ุจุนุฏ) ูููุนุฏ ูุฑุงุฌุนุฉ.",
      "ูู ุงูุฅุซุฑุงุก: ูุซูู ูุดุงุทูุง ูุงุญุฏูุง ูุงุถุญ ุงูุฃุซุฑ ููุทูุงุจ ุงููุชููุฒูู.",
      "ุงุญุชูุธ ุจูุงูุจ ุชุญููู ูุชุงุฆุฌ ููุญูุฏ ููู ุงุฎุชุจุงุฑ."
    ]
  },

  "ุฅุนุฏุงุฏ ูุชูููุฐ ุฎุทุฉ ุงูุชุนูู": {
    w: 10,
    brief: "ูููุณ ุฌูุฏุฉ ุงูุชุฎุทูุท ุงููููู/ุงูุฃุณุจูุนู/ุงููุตูู ููุถูุญ ุงูุฃูุฏุงู ูููุงุกูุฉ ุงูุฃูุดุทุฉ ูุงูุชูููู.",
    rows: [
      {e:"ุชููุฑ ุฎุทุฉ ุฏุฑุงุณูุฉ ูุตููุฉ ูุฃุณุจูุนูุฉ ููุชููุฉ ููุนุชูุฏุฉ", d:"ูููุฐุฌ ุฎุทุฉ ูุตููุฉ ูุฃุณุจูุนูุฉ"},
      {e:"ูุถูุญ ุงูุฃูุฏุงู ุงูุชุนููููุฉ ูู ุงูุฎุทุฉ ุงูููููุฉ", d:"ุชุญุงุถูุฑ ููููุฉ"},
      {e:"ุงุฑุชุจุงุท ุงูุฃูุดุทุฉ ุงูุตููุฉ ูุบูุฑ ุงูุตููุฉ ุจุงูุฃูุฏุงู ูุงูุฎุทุฉ", d:"ููุงุฐุฌ"},
      {e:"ุชูุธูู ุฃุฏูุงุช ุงูุชูููู ุฏุงุฎู ุงูุฎุทุฉ", d:"ุชูุฑูุฑ ููุงุญุธุงุช ุงููุฏูุฑ"},
      {e:"ุงููุฑููุฉ ูู ุชูููุฐ ุงูุฎุทุฉ", d:"ุณุฌู ุงูุชุญุฏูุซุงุช"}
    ],
    notes: [
      "ุงุฌุนู ุงููุฏู ูุงุถุญูุง ููุงุจููุง ููููุงุณ ุฏุงุฎู ุงูุชุญุถูุฑ.",
      "ุงุฑุจุท ูู ูุดุงุท ุจูุฏูู (ูุงุฐุง ูุญููุ ูููู ุฃููุณูุ).",
      "ุฏููู ุงูุชุญุฏูุซุงุช ุนูุฏ ุชุบููุฑ ุงูุฎุทุฉ ุจุณุจุจ ุธุฑู/ุญุงุฌุฉ ุชุนูู."
    ]
  },

  "ุชูุธูู ุชูููุงุช ููุณุงุฆู ุงูุชุนูู ุงูููุงุณุจุฉ": {
    w: 10,
    brief: "ูููุณ ูุงุนููุฉ ุชูุธูู ุงูุชูููุฉ ูุงููุณุงุฆู ูููุงุณุจุชูุง ูููุญุชูู ูุฏูุฌ ุงูุทูุงุจ ูุงุณุชุฎุฏุงู ุงูุจุฑุงูุฌ ุงููุชุฎุตุตุฉ.",
    rows: [
      {e:"ุงุณุชุฎุฏุงู ุงูุชูููุฉ ุจุดูู ูุนุงู ูู ุงูุดุฑุญ", d:"ุชูุงุฑูุฑ"},
      {e:"ุชูููุน ุงููุณุงุฆู ุงูุชุนููููุฉ", d:"ุฃูุซูุฉ ูุฑููุฉ ูู ุงููุณุงุฆู"},
      {e:"ููุงุกูุฉ ุงููุณููุฉ ูุน ูุญุชูู ุงูุฏุฑุณ", d:"ุฎุทุฉ ุงูุฏุฑุณ ูุชุถููุฉ ุงููุณููุฉ"},
      {e:"ุฏูุฌ ุงูุทูุงุจ ูู ุงุณุชุฎุฏุงู ุงูุชูููุฉ", d:"ุตูุฑ ูู ูุดุงุฑูุฉ ุงูุทูุงุจ"},
      {e:"ุชูุธูู ุจุฑุงูุฌ ุชุนููููุฉ ูุชุฎุตุตุฉ", d:"ุชูุงุฑูุฑ ุฃู ููุทุงุช ุดุงุดุฉ"}
    ],
    notes: [
      "ููุทุฉ ุดุงุดุฉ ูุงุญุฏุฉ + ุนููุงู ุงูุฏุฑุณ ุชููู ูุดุงูุฏ ููู.",
      "ุงุญุฑุต ุฃู ุชููู ุงููุณููุฉ โูุฑุชุจุทุฉ ุจุงููุฏูโ ูููุณุช ููุนุฑุถ ููุท.",
      "ูุซูู ูุดุงุฑูุฉ ุงูุทูุงุจ (ูุดุงุท ุฑููู/ุชูุงุนู/ููุชุฌ)."
    ]
  },

  "ุชููุฆุฉ ุจูุฆุฉ ุชุนููููุฉ": {
    w: 5,
    brief: "ูููุณ ุชูุธูู ุงูุจูุฆุฉ ุงูุตููุฉ ูุงูุชููุฆุฉ ุงูููุณูุฉ ูุฎูู ุจูุฆุฉ ุขููุฉ ููุญูุฒุฉ ูุชูููุฑ ุงูุฃุฏูุงุช ูุถุจุท ุงูุจูุฆุฉ.",
    rows: [
      {e:"ุชูุธูู ุงููุตู ุจุดูู ูุนุฒุฒ ุงูุชุนูู", d:"ุชูุฑูุฑ"},
      {e:"ุงูุชููุฆุฉ ุงูููุณูุฉ ููุทูุงุจ ุนูุฏ ุจุฏุก ุงูุฏุฑูุณ", d:"ููุงุญุธุงุช ุตููุฉ"},
      {e:"ุฎูู ุจูุฆุฉ ูุญูุฒุฉ ูุขููุฉ", d:"ููุงุฐุฌ"},
      {e:"ุชูููุฑ ุฃุฏูุงุช ููุณุงุฆู ููุงุณุจุฉ", d:"ููุงุฐุฌ"},
      {e:"ุถุจุท ุงูุจูุฆุฉ ุงูุตููุฉ", d:"ุชูุฑูุฑ"}
    ],
    notes: [
      "ุตูุฑุฉ ุชูุธูููุฉ ูููุตู ูุน ุชุนููู ูุฎุชุตุฑ ุชุนุฏ ุดุงูุฏูุง ูุงูููุง.",
      "ูุซูู ุชููุฆุฉ ุงูุฏุฑุณ (ุณุคุงู ุงูุชุชุงุญู/ูุดุงุท ุชูููุฏู/ุฑูุชูู).",
      "ุฑุงุนู ุงูุณูุงูุฉ ูุงููุถูุญ ูู ุชูุฒูุน ุงูุฃุฏูุงุช ุฏุงุฎู ุงููุตู."
    ]
  },

  "ุงูุฅุฏุงุฑุฉ ุงูุตููุฉ": {
    w: 5,
    brief: "ูููุณ ุถุจุท ุงูุณููู ูุงูุชุญููุฒ ููุฑุงุนุงุฉ ุงููุฑูู ููุชุงุจุนุฉ ุงูุญุถูุฑ ูุงูุชุนุงูู ุงูุชุฑุจูู ูุน ุงูููุงูู ุงูุตููุฉ.",
    rows: [
      {e:"ุถุจุท ุณููู ุงูุทูุงุจ", d:"ูุดู ูุชุงุจุนุฉ ุฃู ุชูุฑูุฑ"},
      {e:"ุดุฏ ุงูุชุจุงู ุงูุทูุงุจ ูุชุญููุฒูู", d:"ููุงุญุธุงุช ุฅุดุฑุงููุฉ"},
      {e:"ูุฑุงุนุงุฉ ุงููุฑูู ุงููุฑุฏูุฉ ุจูู ุงูุทูุงุจ", d:"ุฎุทุฉ ุงูุฏุฑุณ ูุฃูุดุทุฉ ูุชููุนุฉ ูููุงุฆู ุฅุญุงูุฉ ุงูุทูุงุจ"},
      {e:"ูุชุงุจุนุฉ ุงูุญุถูุฑ ูุงูุบูุงุจ", d:"ูุดู ุงูุบูุงุจ ุงูุฅููุชุฑููู ุฃู ุงููุฑูู"},
      {e:"ุงูุชุนุงูู ูุน ุงูููุงูู ุงูุตููุฉ ุชุฑุจููุง", d:"ุณุฌู ุงููุชุงุจุนุฉ ุงููููู"}
    ],
    notes: [
      "ุฏููู ุงููููู ุงูุตููู ูุงูุฅุฌุฑุงุก ุงูุชุฑุจูู ููุชูุฌุชู ูู ุณุฌู ูุฎุชุตุฑ.",
      "ุงุฑุจุท ุงูุชุญููุฒ ุจููุงุนุฏ ุตููุฉ ูุงุถุญุฉ ููุชูุณูุฉ.",
      "ุชุฃูุฏ ูู ุฃู ูุชุงุจุนุฉ ุงูุญุถูุฑ ุฏูููุฉ ููุคุฑุฎุฉ."
    ]
  },

  "ุชุญููู ูุชุงุฆุฌ ุงููุชุนูููู ูุชุดุฎูุต ูุณุชููุงุชูู": {
    w: 10,
    brief: "ูููุณ ุชููุน ูุตุงุฏุฑ ุงูุชูููู ูุชุญููู ุงููุชุงุฆุฌ ูุชุตููู ุงูุทูุงุจ ูุจูุงุก ุฎุทุท ุนูุงุฌูุฉ ููุชุงุจุนุฉ ุงูุชุทูุฑ.",
    rows: [
      {e:"ุชููุน ูุตุงุฏุฑ ุงูุชูููู", d:"ุดูุงูุฏ"},
      {e:"ุชุญููู ูุชุงุฆุฌ ุงูููุฑุงุช ูุงูุงุฎุชุจุงุฑุงุช ูุชูุณูุฑูุง", d:"ููู ุชุญููู ูุฑุฏู ุฃู ุฌูุงุนู"},
      {e:"ุชุตููู ุงูุทูุงุจ ุญุณุจ ุงูุฃุฏุงุก", d:"ุณุฌูุงุช ุงูุชุตููู ุงูุฃูุงุฏูููุฉ"},
      {e:"ุจูุงุก ุฎุทุท ุนูุงุฌูุฉ ููู ุงูุชุดุฎูุต", d:"ุฎุทุฉ ุนูุงุฌูุฉ ูุณุชูุฏุฉ ููุจูุงูุงุช"},
      {e:"ูุชุงุจุนุฉ ุชุทูุฑ ูุณุชูู ุงูุทุงูุจ", d:"ูุดู ุจุชุญุณู ุงูุฃุฏุงุก"}
    ],
    notes: [
      "ุงุณุชุฎุฏู ูููุฐุฌ ุชุญููู ุซุงุจุช (ูุณุจุฉ ุฅุชูุงู/ููุฑุงุช ุถุนููุฉ/ุฅุฌุฑุงุก).",
      "ุตููู ุงูุทูุงุจ ุฅูู ูุฆุงุช ูุงุถุญุฉ ุซู ุงุฑุจุท ูู ูุฆุฉ ุจุชุฏุฎู ูุญุฏุฏ.",
      "ูุซูู ุงูุชุญุณู ุจููุงุฑูุฉ ูุจู/ุจุนุฏ ููู ุจุนููุฉ ูุตูุฑุฉ."
    ]
  },

  "ุชููุน ุฃุณุงููุจ ุงูุชูููู": {
    w: 10,
    brief: "ูููุณ ุชูููุน ุฃุฏูุงุช ุงูุชูููู ูุชุทุจูู ุงููุดุงุฑูุน ูุงูููุงู ุงูุฃุฏุงุฆูุฉ ููููุงุช ุงูุฅูุฌุงุฒ ูุงูุชุบุฐูุฉ ุงูุฑุงุฌุนุฉ.",
    rows: [
      {e:"ุงุณุชุฎุฏุงู ุฃุฏูุงุช ุชูููู ูุชููุนุฉ", d:"ููุงุฐุฌ"},
      {e:"ุชูููุฐ ุงููุดุงุฑูุน ุงูุทูุงุจูุฉ", d:"ููุงุฐุฌ"},
      {e:"ุชุทุจูู ุงูููุงู ุงูุฃุฏุงุฆูุฉ", d:"ููุงุฐุฌ ูู ุงูููุงู ูุชุญููู ุงูุฃุฏุงุก"},
      {e:"ูููุงุช ุงูุฅูุฌุงุฒ ุงููุฑุฏูุฉ", d:"ุนููุฉ ูู ูููุงุช ุฅูุฌุงุฒ ุงูุทูุงุจ"},
      {e:"ุงูุชูููู ุงููุจูู ูุงูุจุนุฏู ูุชูุฏูู ุชุบุฐูุฉ ุฑุงุฌุนุฉ", d:"ุชุญููู ุงูุฏุฑุฌุงุช"}
    ],
    notes: [
      "ุงุฌุนู ุฃุฏุงุฉ ุงูุชูููู ูุฑุชุจุทุฉ ุจูุฎุฑุฌุงุช ุชุนูู ูุงุถุญุฉ.",
      "ุงุญุชูุธ ุจุนููุฉ ูุงุญุฏุฉ ูููุฉ ูู ููู ุฅูุฌุงุฒ/ูููุฉ ุฃุฏุงุฆูุฉ.",
      "ูุซูู ุงูุชุบุฐูุฉ ุงูุฑุงุฌุนุฉ (ุชุนููู/ูุญู/ุชุญุณูู ูุญุฏุฏ)."
    ]
  }
};

/* ุชุดุบูู/ุฅููุงู ูุถุน ุงููุนูู (ูุชูุนูู ุดูู ุงูุถุบุท ููุท ูููุนูู) */
function syncTeacherMode(){
  document.body.classList.toggle('isTeacher', $('#model')?.value === 'teacher');
}
syncTeacherMode();
document.addEventListener('change', (e)=>{
  if(e.target && e.target.id === 'model') syncTeacherMode();
});

/* ูุชุญ/ุฅุบูุงู ูุงูุฐุฉ ุงูุดุฑุญ */
function toggleGuide(show){
  const m = $('#guide');
  if(!m) return;
  m.classList.toggle('show', !!show);
  m.setAttribute('aria-hidden', show ? 'false' : 'true');
}
const closeGuideBtn = $('#closeGuide');
if(closeGuideBtn) closeGuideBtn.onclick = ()=>toggleGuide(false);
$('#guide')?.addEventListener('click', (e)=>{ if(e.target && e.target.id === 'guide') toggleGuide(false); });
document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') toggleGuide(false); });
function getRubricWeight(modelKey, title){
  const arr = (RUBRICS && RUBRICS[modelKey]) ? RUBRICS[modelKey] : [];
  const it = arr.find(x => (x.name||'').trim() === (title||'').trim());
  return it ? it.w : null;
}

const DEFAULT_EVIDENCE_BY_MODEL = {
  principal: ["ุงูุฎุทุฉ ุงูุชุดุบูููุฉ/ุฎุทุฉ ุงูุชุญุณูู", "ูุญุงุถุฑ ูุฌุงู/ุงุฌุชูุงุนุงุช", "ูุคุดุฑุงุช ุฃุฏุงุก ูุชูุงุฑูุฑ ูุชุงุจุนุฉ", "ุฎุทุงุจุงุช ูุชููููุงุช ููุซูุฉ"],
  vp:        ["ุณุฌูุงุช ุงููุชุงุจุนุฉ ุงูููููุฉ", "ุชูุงุฑูุฑ ุชูููุฐ ุงููุฌุงู", "ูุชุงุจุนุฉ ุงูุงูุถุจุงุท ูุงูุบูุงุจ", "ูุฑุงุณูุงุช ูุฅุญุงูุงุช ููุซูุฉ"],
  counselor: ["ุณุฌู ุงูุญุงูุงุช", "ุฎุทุท ุงูุชุฏุฎู", "ุจุฑุงูุฌ ุฅุฑุดุงุฏูุฉ ูุชูุซูููุง", "ุณุฌู ุชูุงุตู ูุน ุงูุฃุณุฑุฉ"],
  activity:  ["ุงูุฎุทุฉ ุงูุฒูููุฉ ูููุดุงุท", "ุชูุงุฑูุฑ ุงููุนุงููุงุช", "ูุณุจ ูุดุงุฑูุฉ ุงูุทูุงุจ", "ุดุฑุงูุงุช ููุจุงุฏุฑุงุช"],
  health:    ["ุฎุทุฉ ุงูุจุฑุงูุฌ ุงูุตุญูุฉ", "ุญุตุฑ ุงูุญุงูุงุช", "ุชูุงุฑูุฑ ุฒูุงุฑุงุช/ุชูุนูุฉ", "ููุงุฐุฌ ูุชุงุจุนุฉ"],
  lab:       ["ุณุฌู ุงูุชุดุบูู", "ููุงุฆู ุงูุฌุฑุฏ", "ุณุฌูุงุช ุงูุณูุงูุฉ", "ุชูุงุฑูุฑ ุงูุตูุงูุฉ"],
  kg:        ["ุฎุทุท ุงูุชุนูู/ุงูุฃูุดุทุฉ", "ุณุฌูุงุช ุงูููู ูุงูุชูููู", "ุชูุงุตู ุงูุฃุณุฑุฉ", "ุชูุซูู ุจูุฆุฉ ุงูุชุนูู"],
  teacher:   ["ุชุญุงุถูุฑ/ุฎุทุท", "ููุงุฐุฌ ุชูููู", "ุชุญููู ูุชุงุฆุฌ", "ุดูุงูุฏ ุชูุธูู ุงูุชูููุฉ"]
};

function defaultEvidence(modelKey, title){
  const base = [
    "ุณุฌู/ูุญุถุฑ ูุชุงุจุนุฉ ูุคุฑูุฎ",
    "ุฎุทุฉ/ูููุฐุฌ ูุนุชูุฏ ูุฑุชุจุท ุจุงูุนูุตุฑ",
    "ุนููุงุช ุดูุงูุฏ (ุตูุฑ/ูููุงุช/ุฑูุงุจุท)",
    "ูุคุดุฑ ูุจู/ุจุนุฏ ุฃู ูุชุงุฆุฌ ูุฑุชุจุทุฉ ุจุงูุฃุซุฑ",
    "ุชุบุฐูุฉ ุฑุงุฌุนุฉ/ููุงุญุธุงุช ุฅุดุฑุงููุฉ"
  ];
  const role = DEFAULT_EVIDENCE_BY_MODEL[modelKey] || [];
  // ุฏูุฌ ุจุฏูู ุชูุฑุงุฑ
  const out = [];
  [...role, ...base].forEach(x => { if(x && !out.includes(x)) out.push(x); });
  return out;
}
/* ุจูุงุก HTML ูููุงูุฐุฉ */
function guideBuildHTML(title, modelKey){
  // ุงุณุชุฎุฏู TEACHER_GUIDES ููุฑุฌุน ูุดุชุฑู ููุนูุงุตุฑ ุงูุนุงูุฉ (ุฅู ูุฌุฏุช)
  const common = (typeof TEACHER_GUIDES !== 'undefined') ? TEACHER_GUIDES : {};
  const bank = common; // ููููู ูุงุญููุง ุฅูุดุงุก ุจูู ููู ูููุฐุฌ ุฅู ุฑุบุจุช

  const g = bank[title]; // ุฅู ูุฌุฏ ุดุฑุญ ุชูุตููู ููุนูุตุฑ
  const w = getRubricWeight(modelKey, title);
  const weightText = (w !== null && w !== undefined) ? `${w}%` : "โ";

  const brief =
    (g && g.brief) ? g.brief :
    (BANK_IMPROVE && BANK_IMPROVE[title] && (BANK_IMPROVE[title].str || BANK_IMPROVE[title].imp)) ? (BANK_IMPROVE[title].str || BANK_IMPROVE[title].imp) :
    "ุดุฑุญ ูุฎุชุตุฑ ููุนูุตุฑ ูุน ุดูุงูุฏ ููุชุฑุญุฉ ููุชูุซูู.";

  // ุฅู ูุงู ูุฏูู ุชูุตูู rows ูุนุฑุถูุ ูุฅูุง ูุนุฑุถ ุดูุงูุฏ ุงูุชุฑุงุถูุฉ ููุงุณุจุฉ ูููููุฐุฌ
  let bodyHTML = "";

  if(g && Array.isArray(g.rows) && g.rows.length){
    const bodyRows = g.rows.map(r=>(
      `<tr>
        <td style="text-align:right">${r.e}</td>
        <td style="text-align:right">${r.d}</td>
      </tr>`
    )).join('');

    bodyHTML = `
      <table class="table guideTbl">
        <thead>
          <tr>
            <th style="text-align:right">ุงูุนูุตุฑ ุงููุฑุงุฏ ุชููููู</th>
            <th style="text-align:right">ุงูุดูุงูุฏ ูุงูุฃุฏูุฉ ุงูุฏุงุนูุฉ</th>
          </tr>
        </thead>
        <tbody>${bodyRows}</tbody>
      </table>
    `;
  } else {
    const ev = defaultEvidence(modelKey, title);
    bodyHTML = `
      <table class="table guideTbl">
        <thead>
          <tr>
            <th style="text-align:right">ุงูุนูุตุฑ</th>
            <th style="text-align:right">ุดูุงูุฏ ููุชุฑุญุฉ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="text-align:right">${title}</td>
            <td style="text-align:right">
              <ul style="margin:0;padding:0 18px;line-height:1.8">
                ${ev.map(x=>`<li>${x}</li>`).join('')}
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
    `;
  }

  const notes = (g && g.notes && g.notes.length) ? g.notes : [
    "ุงุฑุจุท ุงูุดุงูุฏ ุจุชุงุฑูุฎ ูุงุถุญ ููุชูุฌุฉ/ุฃุซุฑ ูุฎุชุตุฑ.",
    "ุงุฌุนู ุงูุชูุซูู ูุฎุชุตุฑูุง (ูุง ุญุฏุซุ ูุง ุงูุฅุฌุฑุงุกุ ูุง ุงููุชูุฌุฉุ).",
    "ุงุญูุธ ูุณุฎุฉ ุฅููุชุฑูููุฉ ููุธูุฉ (ููู ูุงุญุฏ ุฃู ูุฌูุฏ ุจุงุณู ุงูุนูุตุฑ)."
  ];

  return `
    <div class="guide-top">
      <span class="badge">ุงููุฒู ุงููุณุจู: ${weightText}</span>
      <span class="badge">ุงููููุฐุฌ: ${document.getElementById('model').selectedOptions[0].textContent}</span>
      <p class="guide-brief">${brief}</p>
    </div>

    ${bodyHTML}

    <div class="guide-note">
      <h4>ููุงุญุธุงุช ุชูุซูู ุณุฑูุนุฉ</h4>
      <ul>${notes.map(t=>`<li>${t}</li>`).join('')}</ul>
    </div>
  `;
}
/* โ ูุชุญ ูุงูุฐุฉ ุดุฑุญ ุงูุนูุตุฑ ุนูุฏ ุงูุถุบุท ุนูู ุงุณู ุงูุนูุตุฑ ุฏุงุฎู ุงูุฌุฏูู */
const tbl = document.getElementById('tbl');
if (tbl) {
  tbl.addEventListener('click', (e) => {
    const itemEl = e.target.closest('.item');
    if (!itemEl) return;

    const title = itemEl.textContent.trim();

    document.getElementById('guideTitle').textContent = 'ุดุฑุญ ุงูุนูุตุฑ: ' + title;
const modelKey = document.getElementById('model').value;
document.getElementById('guideContent').innerHTML = guideBuildHTML(title, modelKey);
    toggleGuide(true);
  });
}
/* ุฃุฒุฑุงุฑ ุงููุณุฎ + ุงูุชููู ุงูุณุฑูุน ุฏุงุฎู ุงููุงูุฐุฉ */
/* ุจูู ุงูุฃูุฏุงู */
const GOALS_BANK={
  principal:[['ุฑูุน ููุงุกุฉ ุงูุฃุฏุงุก','ุชูููุฐ ุงูุฎุทุท','100ูช'],['ุชุนุฒูุฒ ุงูุงูุถุจุงุท','ุงูุฎูุงุถ ุงูุบูุงุจ','โค 5 ุญุงูุงุช'],['ุชูููุฉ ุงููุฌุชูุน ุงููููู','ุงูุงุฌุชูุงุนุงุช ุงูููุซูู','2/ุดูุฑ']],
  vp:[['ุฑูุน ูุงุนููุฉ ุงูุฅุดุฑุงู','ุงูุชุธุงู ุงูุฌุฏูู','100ูช'],['ุฏุนู ุงูุงูุถุจุงุท','ุงููุฎุงููุงุช','-15ูช'],['ุงูุชูุงุตู ูุน ุฃูููุงุก ุงูุฃููุฑ','ุชูุงุฑูุฑ','4 ูุตููุฉ']],
  teacher:[['ุชุญุณูู ุงูููุงุชุฌ','ูุชูุณุท ุงูุฏุฑุฌุงุช','+10ูช'],['ุงุณุชุฑุงุชูุฌูุงุช ุญุฏูุซุฉ','ุนุฏุฏ ุงูููุซูู','3'],['ุชูุธูู ุงูุชูููุฉ','ุญุตุต ุฃุณุจูุนููุง','4']],
  activity:[['ูุดุงุฑูุฉ ุงูุฃูุดุทุฉ','ุงููุณุจุฉ','โฅ60ูช'],['ุฌูุฏุฉ ุงูุจุฑุงูุฌ','ุฑุถุง ุงูุทูุงุจ','โฅ90ูช'],['ุชูุซูู','ูุณุจุฉ ุงูุชูุซูู','100ูช']],
  health:[['ุซูุงูุฉ ุตุญูุฉ','ุจุฑุงูุฌ','4/ูุตู'],['ููุงุฑุณุงุช ุตุญูุฉ','ุงูุฎูุงุถ ุงูุญุงูุงุช','-25ูช'],['ุงูุจูุฆุฉ ุงูุตุญูุฉ','ุฒูุงุฑุงุช','2/ุดูุฑ']],
  counselor:[['ุงูุถุจุงุท ุณูููู','ุงูุฎูุงุถ ุงูุญุงูุงุช','-30ูช'],['ุจุฑุงูุฌ ููุงุฆูุฉ','ุนุฏุฏ','5'],['ุฎุทุท ูุฑุฏูุฉ','ุชุญุณู ููุญูุธ','โฅ80ูช']],
  lab:[['ุฌูุฏุฉ ุงูุชุฌุงุฑุจ','ูุณุจุฉ ุงูุชูููุฐ','90ูช'],['ุฌุงูุฒูุฉ ุงููุฎุชุจุฑ','ุงูุฌุฑุฏ','100ูช'],['ุงูุณูุงูุฉ','ุงููุฎุงููุงุช','0']],
  kg:[['ููุงุฑุงุช ุฃุณุงุณูุฉ','ุฅุชูุงู ุงูุฎุชุงูู','โฅ90ูช'],['ุจูุฆุฉ ุชุนูู ูุดุท','ุฃูุดุทุฉ ุฃุณุจูุนูุฉ','5'],['ุฅุดุฑุงู ุงูุฃุณุฑุฉ','ูุณุจุฉ ุงูุชูุงุนู','โฅ70ูช']]
};
function autoFillGoals(){
  const bank=GOALS_BANK[$('#model').value]||[];
const slots=[
  [$('#g1'), $('#g1i'), $('#g1t')],
  [$('#g2'), $('#g2i'), $('#g2t')],
  [$('#g3'), $('#g3i'), $('#g3t')]
];
  slots.forEach(([a,b,c],i)=>{a.value=bank[i]?.[0]||''; b.value=bank[i]?.[1]||''; c.value=bank[i]?.[2]||'';});
  renderGoalsPrint();
}
function renderGoalChips(){
  const bank=GOALS_BANK[$('#model').value]||[], box=$('#goalChips'); box.innerHTML='';
  bank.forEach(([t,i,v])=>{
    const b=document.createElement('button');
    b.textContent=t;
    b.onclick=()=>{
const slots=[
  [$('#g1'), $('#g1i'), $('#g1t')],
  [$('#g2'), $('#g2i'), $('#g2t')],
  [$('#g3'), $('#g3i'), $('#g3t')]
];
      for(const [a,b1,c] of slots){ if(!a.value){a.value=t; b1.value=i; c.value=v; break;} }
      renderGoalsPrint(); snap();
    };
    box.appendChild(b);
  });
}

/* ุทู/ุนุฑุถ ุงูุฃูุฏุงู */
const goalsBody = $('#goalsBody');
const goalsToggle = $('#goalsToggle');
function updateGoalsToggleLabel(){
  if(!goalsToggle || !goalsBody) return;
  const open = goalsBody.classList.contains('open');
  goalsToggle.textContent = open ? 'ุฅุฎูุงุก ุงูุฃูุฏุงู โฒ' : 'ุฅุธูุงุฑ ุงูุฃูุฏุงู โผ';
}
if(goalsToggle && goalsBody){
  goalsToggle.addEventListener('click',()=>{
    goalsBody.classList.toggle('open');
    updateGoalsToggleLabel();
  });
}

/* ุนูุงุตุฑ ุงูููุงุฐุฌ */
const RUBRICS={};
RUBRICS.teacher=[
  {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",w:10},
  {name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",w:10},
  {name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",w:10},
  {name:"ุงูุชููุน ูู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฏุฑูุณ",w:10},
  {name:"ุชุญุณูู ูุชุงุฆุฌ ุงููุชุนูููู",w:10},
  {name:"ุฅุนุฏุงุฏ ูุชูููุฐ ุฎุทุฉ ุงูุชุนูู",w:10},
  {name:"ุชูุธูู ุชูููุงุช ููุณุงุฆู ุงูุชุนูู ุงูููุงุณุจุฉ",w:10},
  {name:"ุชููุฆุฉ ุจูุฆุฉ ุชุนููููุฉ",w:5},
  {name:"ุงูุฅุฏุงุฑุฉ ุงูุตููุฉ",w:5},
  {name:"ุชุญููู ูุชุงุฆุฌ ุงููุชุนูููู ูุชุดุฎูุต ูุณุชููุงุชูู",w:10},
  {name:"ุชููุน ุฃุณุงููุจ ุงูุชูููู",w:10}
];
RUBRICS.activity=[
  {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",w:10},{name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",w:10},{name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",w:10},
  {name:"ุงูุชููุน ูู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฏุฑูุณ",w:5},{name:"ุชุญุณูู ูุชุงุฆุฌ ุงููุชุนูููู",w:5},{name:"ุฅุนุฏุงุฏ ูุชูููุฐ ุฎุทุฉ ุงูุชุนูู",w:5},
  {name:"ุชูุธูู ุชูููุงุช ููุณุงุฆู ุงูุชุนูู ุงูููุงุณุจุฉ",w:5},{name:"ุชููุฆุฉ ุจูุฆุฉ ุชุนููููุฉ",w:5},{name:"ุงูุฅุฏุงุฑุฉ ุงูุตููุฉ",w:5},
  {name:"ุชุญููู ูุชุงุฆุฌ ุงููุชุนูููู ูุชุดุฎูุต ูุณุชููุงุชูู",w:5},{name:"ุชููุน ุฃุณุงููุจ ุงูุชูููู",w:5},
  {name:"ุฅุนุฏุงุฏ ุฎุทุฉ ุฒูููุฉ ููุนุชูุฏุฉ ูุจุฑุงูุฌ ููุนุงููุงุช ุงููุดุงุท ุงูุทูุงุจู",w:10},
  {name:"ุชููุฆุฉ ุงูุจูุฆุฉ ุงููุฏุฑุณูุฉ ููุจุฑุงูุฌ ูุงูุฃูุดุทุฉ ุงูุทูุงุจูุฉ",w:5},
  {name:"ุฏุนู ุงููุนูููู ููู ุงุญุชูุงุฌุงุชูู ููููููู ููุฃุดุทุฉ",w:5},
  {name:"ุชุญููุฒ ุงููุชุนูููู ุนูู ุงููุดุงุฑูุฉ ูู ุงูุฃูุดุทุฉ",w:10}
];
RUBRICS.health=[
  {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",w:10},{name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",w:10},{name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",w:10},
  {name:"ุงูุชููุน ูู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฏุฑูุณ",w:5},{name:"ุชุญุณูู ูุชุงุฆุฌ ุงููุชุนูููู",w:5},{name:"ุฅุนุฏุงุฏ ูุชูููุฐ ุฎุทุฉ ุงูุชุนูู",w:5},
  {name:"ุชูุธูู ุชูููุงุช ููุณุงุฆู ุงูุชุนูู ุงูููุงุณุจุฉ",w:5},{name:"ุชููุฆุฉ ุจูุฆุฉ ุชุนููููุฉ",w:5},{name:"ุงูุฅุฏุงุฑุฉ ุงูุตููุฉ",w:5},
  {name:"ุชุญููู ูุชุงุฆุฌ ุงููุชุนูููู ูุชุดุฎูุต ูุณุชููุงุชูู",w:5},{name:"ุชููุน ุฃุณุงููุจ ุงูุชูููู",w:5},
  {name:"ุชูููุฐ ุงูุฎุทุฉ ุงููุดุชุฑูุฉ ููุจุฑุงูุฌ ุงูุตุญูุฉ ุงููุฏุฑุณูุฉ",w:15},{name:"ุญุตุฑ ุงูุญุงูุงุช ุงูุตุญูุฉ ูููุชุนูููู",w:5},{name:"ุชููุฆุฉ ุงูุจูุฆุฉ ุงูุตุญูุฉ ุงููุฏุฑุณูุฉ",w:10}
];
RUBRICS.kg=[
  {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",w:10},{name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",w:5},{name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",w:5},
  {name:"ุงูุชููุน ูู ุงูุงุณุชุฑุงุชูุฌูุงุช",w:5},{name:"ุชุญุณูู ูุชุงุฆุฌ ุงูุชุนูู",w:5},{name:"ุฅุนุฏุงุฏ ุฎุทุฉ ุดุงููุฉ ูุชูุตูููุฉ ููุฃูุดุทุฉ",w:5},
  {name:"ุชุตููู ุฎุจุฑุงุช ุชุนูู ูุฑูุฉ ููุจุชูุฑุฉ",w:5},{name:"ุชูุธูู ุชูููุงุช ููุณุงุฆู ุงูุชุนูู ุงูููุงุณุจุฉ",w:5},{name:"ุงูุชููู ูู ุงููุงุฏุฉ ุงูุนูููุฉ",w:5},
  {name:"ุงุณุชุฑุงุชูุฌูุงุช ุชุฏุฑูุณ ูุงุนูุฉ",w:5},{name:"ุฅุดุฑุงู ุงูุฃุณุฑุฉ",w:5},{name:"ุชููุฆุฉ ุจูุฆุฉ ุชุนููููุฉ ุขููุฉ ููุญูุฒุฉ ูุชุทููุฑ ุงูููุงุก ูุงูุชุนูู",w:15},
  {name:"ุชุนุฒูุฒ ุงูุชูุงุนู ุงูุฅูุฌุงุจู ูู ุจูุฆุฉ ุงูุชุนูู",w:5},{name:"ุชูููู ุชูุฏู ุงููุชุนูููู ูุชุชุจุนู ูุชูุซููู",w:5},{name:"ุชููุน ุฃุณุงููุจ ุงูุชูููู",w:5},
  {name:"ุชุดุงุฑู ูู ุงูุฃูุดุทุฉ",w:5},{name:"ุชุตููู ุฃูุดุทุฉ ุชุนูู ุชูุจู ุงููุฑูู ุงููุฑุฏูุฉ ููู ูุชุนูู",w:5},{name:"ุชูููุฉ ููุงุฑุงุช ุงูุงุณุชููุงู ูุฏู ุงููุชุนูููู",w:5},
  {name:"ุชุทููุฑ ุงูุณููููุงุช ุงูุฅูุฌุงุจูุฉ ูุงูููู ูุงููุจุงุฏุฆ ูุงูุงุชุฌุงูุงุช",w:5}
];
RUBRICS.lab=[
  {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",w:10},{name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",w:10},{name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",w:10},
  {name:"ุงูุชููุน ูู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฏุฑูุณ",w:10},{name:"ุชุญุณูู ูุชุงุฆุฌ ุงููุชุนูููู",w:10},{name:"ุฎุทุฉ ุงููุฎุชุจุฑ ุงูููููุฉ",w:5},
  {name:"ุงููุนุฑูุฉ ุจุงูุฃุณุณ ูุงูููุงููู ุงููููุฉ",w:5},{name:"ุชุฌููุฒ ุงููุณุชูุฒูุงุช",w:5},{name:"ุงูุณูุงูุฉ",w:5},
  {name:"ุชุญุถูุฑ ุงููุฎุชุจุฑ",w:5},{name:"ุชุณููู ุงูุฃุฌูุฒุฉ ูุชุฎุฒูููุง",w:5},{name:"ุชูุฑูุฑ ุฃุณุจูุนู ููุฃูุดุทุฉ",w:10},{name:"ุชูุงุฑูุฑ ุญุงูุฉ ุงูุฃุฌูุฒุฉ",w:10}
];
RUBRICS.counselor=[
  {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",w:20},{name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",w:5},{name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",w:5},
  {name:"ููุฏู ุงูุชุฏุฎูุงุช ุงูููุงุณุจุฉ ูุชุนุฒูุฒ ุงูุงูุถุจุงุท",w:5},{name:"ุชูุฏูู ุจุฑุงูุฌ ุชุฑุจููุฉ ูุชุนุฒูุฒ ุฏุงูุนูุฉ ุงูุทูุจุฉ ููุชุนูู",w:5},
  {name:"ุฅุนุฏุงุฏ ุฎุทุฉ ุจุฑุงูุฌ ุงูุชูุฌูู ุงูุทูุงุจู",w:10},{name:"ุนุฑุถ ุงูุญุงูุงุช ูุจุฑุงูุฌ ุงูุฏุนู ุงูููุงุณุจุฉ",w:10},{name:"ูุนุฒุฒ ุงูููู ูุงูุณููููุงุช ูููุชุนูููู",w:10},
  {name:"ุชูุฏูู ุงูุฃูุดุทุฉ ูุงูุจุฑุงูุฌ ุงูุฅุฑุดุงุฏูุฉ",w:10},{name:"ูุณุงุนุฏ ุงููุนูููู ูู ุงูุชุฎุทูุท ุงููููู ูุงูุฃูุงุฏููู",w:5},{name:"ูุนุฒุฒ ุงูุชููู ุงูุฏุฑุงุณู",w:5},
  {name:"ูุชุงุจุน ุชุฏุฎูุงุช ุชุฑุจููุฉ ูููุชุนุซุฑูู ุฏุฑุงุณููุง ูุณูููููุง",w:5},{name:"ุชูุนูุฉ ุงููุชุนูููู ูุฃูููุงุก ุฃููุฑูู ุจููุงุนุฏ ุงูุณููู ูุงูููุงุธุจุฉ",w:5}
];
RUBRICS.principal=[
  {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",w:5},{name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",w:5},{name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",w:5},
  {name:"ูุฑู ููุงุฏุฑ ุนูู ุชูููุฐ ุฃุนูุงูู ูู ุธู ุธุฑูู ุงูุนูู ุงููุฎุชููุฉ",w:5},{name:"ูุฏุนู ููุดุงุฑู ูู ุงููุจุงุฏุฑุงุช ุงูููุนูุฉ",w:5},{name:"ูุชุฎุฐ ุฅุฌุฑุงุกุงุช ุชุฑุจููุฉ ุชุญูู ุงูุงูุถุจุงุท ุงููุฏุฑุณู",w:5},
  {name:"ูุฏูุฑ ุงูููุงุฑุฏ ูู ุงููุฏุฑุณุฉ ุจููุงุกุฉ",w:5},{name:"ุฎุทุฉ ุงูุชุทููุฑ ุงููููู",w:5},{name:"ูุชุงุจุนุฉ ูุคุดุฑุงุช ุงูุฃุฏุงุก",w:5},{name:"ุชูููุฐ ุจุฑุงูุฌ ุงูุชุทููุฑ",w:5},
  {name:"ุชูููู ุฃุฏุงุก ุงูููุณูุจูู",w:5},{name:"ุชุญุณูู ูุชุงุฆุฌ ุงูุชุนูู ุนููููุง",w:15},{name:"ุฑูุน ุฃุฏุงุก ุงููุฏุฑุณุฉ",w:10},{name:"ุฅุนุฏุงุฏ ุงูุฎุทุท ุงููุฏุฑุณูุฉ",w:5},
  {name:"ูุชุงุจุนุฉ ุชูููุฐ ุงูุฎุทุท",w:5},{name:"ุงููุดุงุฑูุฉ ูู ุงูุฃูุดุทุฉ",w:5},{name:"ุชูุธูู ุงูููุตุงุช ุงูุฑูููุฉ",w:5},{name:"ุชุนุฒูุฒ ุงูุณููู ุงูุฅูุฌุงุจู",w:5},{name:"ุชููุฆุฉ ุจูุฆุฉ ูุฏุฑุณูุฉ ุขููุฉ ููุญุตูุฉ ุนูู ุงูุชุนูู",w:5}
];
RUBRICS.vp=[
  {name:"ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ",w:5},{name:"ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู",w:5},{name:"ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ",w:5},
  {name:"ูุฑู ููุงุฏุฑ ุนูู ุชูููุฐ ุฃุนูุงูู ูู ุธู ุธุฑูู ุงูุนูู ุงููุฎุชููุฉ",w:5},{name:"ูุฏุนู ููุดุงุฑู ูู ุงููุจุงุฏุฑุงุช ุงูููุนูุฉ",w:5},{name:"ูุชุฎุฐ ุฅุฌุฑุงุกุงุช ุชุฑุจููุฉ ุชุญูู ุงูุงูุถุจุงุท ุงููุฏุฑุณู",w:5},
  {name:"ูุฏูุฑ ุงูููุงุฑุฏ ูู ุงููุฏุฑุณุฉ ุจููุงุกุฉ",w:5},{name:"ูุดุงุฑู ูู ุฅุนุฏุงุฏ ุฎุทุฉ ุงูุชุทููุฑ ุงููููู",w:5},{name:"ูุชุงุจุน ุงูุชุบุฐูุฉ ุงูุฑุงุฌุนุฉ ููุชุงุฆุฌ ุชุญูู ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงููุธููู",w:5},
  {name:"ูุฏุนู ุชูููุฐ ุจุฑุงูุฌ ุงูุชุทููุฑ ุงููููู",w:5},{name:"ูููู ุฃุฏุงุก ููุณูุจู ุงููุฏุฑุณุฉ",w:5},{name:"ูููุฐ ุฅุฌุฑุงุกุงุช ุนูููุฉ ูุชุญุณูู ูุชุงุฆุฌ ุงูุชุนูู",w:10},
  {name:"ูุณุงูู ูู ุฑูุน ูุณุชูู ุฃุฏุงุก ุงููุฏุฑุณุฉ",w:5},{name:"ูุดุงุฑู ูู ุฅุนุฏุงุฏ ุงูุฎุทุท ุงููุฏุฑุณูุฉ",w:5},{name:"ูุชุงุจุน ุชูููุฐ ุงูุฎุทุท ุงููุฏุฑุณูุฉ",w:5},
  {name:"ูููุฑ ุงููุฑุต ูุงูุฅููุงูุงุช ุงูุฏุงุนูุฉ ููุดุงุฑูุฉ ุงูุทูุงุจ ูู ุงูุฃูุดุทุฉ ุงูุตููุฉ ูุบูุฑ ุงูุตููุฉ",w:5},
  {name:"ููุธู ุงูููุตุงุช ุงูุฑูููุฉ ูุชุทุจููุงุชูุง ุงูุชุนููููุฉ ูู ุฏุนู ุนูููุงุช ุงูุชุนููู ูุงูุชุนูู",w:5},
  {name:"ูุนุฒุฒ ุงูุณููู ุงูุฅูุฌุงุจู ููุทูุงุจ",w:5},{name:"ุชููุฆุฉ ุจูุฆุฉ ูุฏุฑุณูุฉ ุขููุฉ ููุญูุฒุฉ ุนูู ุงูุชุนูู",w:5}
];

/* ุจูู ุงูููุฉ/ุงูุชุญุณูู */
const BANK_IMPROVE={
  "ุฃุฏุงุก ุงููุงุฌุจุงุช ุงููุธูููุฉ":{imp:"ุถุจุท ุงูุงูุชุฒุงู ุงูุฒููู ูุชุญุฏูุซ ุณุฌู ุงูุฃุฏุงุก ุฃุณุจูุนููุง.",str:"ุงูุถุจุงุท ูููู ูุงุชุณุงู ูู ุชูููุฐ ุงูููุงู."},
  "ุงูุชูุงุนู ูุน ุงููุฌุชูุน ุงููููู":{imp:"ุชูุนูู ูุดุงุฑูุฉ ููุซูุฉ ูู PLC ููุฑุด ุชุจุงุฏู ุงูุฎุจุฑุงุช.",str:"ูุดุงุฑูุฉ ูุงุนูุฉ ูู ุงููุฌุชูุน ุงููููู ูุชุบุฐูุฉ ุฑุงุฌุนุฉ ุจููุงุกุฉ."},
  "ุงูุชูุงุนู ูุน ุฃูููุงุก ุงูุฃููุฑ":{imp:"ุฎุทุฉ ุชูุงุตู ุฏูุฑูุฉ ููููุงุช ููุซููุฉ (ุฑุณุงุฆู/ููุตุงุช).",str:"ุชูุงุตู ููุธูู ููุนูุณ ุนูู ุฏุนู ุชุนูู ุงูุทุงูุจ."},
  "ุงูุชููุน ูู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฏุฑูุณ":{imp:"ุชุทุจูู ุงุณุชุฑุงุชูุฌูุงุช ูุดุทุฉ ูููุงุญุธุฉ ุชุชุงุจุนูุฉ.",str:"ุชูููุน ููุญูุธ ูุฑุงุนู ุฃููุงุท ุงูุชุนูู."},
  "ุชุญุณูู ูุชุงุฆุฌ ุงููุชุนูููู":{imp:"ุชุญููู ูุฌูุงุช ูุจูุงุก ุฎุทุฉ ุนูุงุฌูุฉ ุจูุคุดุฑุงุช ุฃุณุจูุนูุฉ.",str:"ุชุญุณู ูุณุชูุฑ ูู ุงูููุงุชุฌ ููู ุจูุงูุงุช ููุซูุฉ."},
  "ุฅุนุฏุงุฏ ูุชูููุฐ ุฎุทุฉ ุงูุชุนูู":{imp:"ุชุญููู ุงูุฎุทุฉ ููู ูุฑุงุฌุนุงุช ููุชุตููุฉ ูุดูุงูุฏ.",str:"ุฎุทุฉ ุชุนูู ูุญููุฉ ุงูุชูููุฐ ููุญููุฉ ุงูุชูุซูู."},
  "ุชูุธูู ุชูููุงุช ููุณุงุฆู ุงูุชุนูู ุงูููุงุณุจุฉ":{imp:"ุฏูุฌ ุฃุฏูุงุช ุฑูููุฉ ูุชูุซูู ููุงุฑุณุงุช ุชูุธูู ุงูุชูููุฉ.",str:"ุชูุธูู ูุงุนู ููุชูููุฉ ูุซุฑู ุงูุชุนูู."},
  "ุชููุฆุฉ ุจูุฆุฉ ุชุนููููุฉ":{imp:"ุชุญุณูู ุงูุชูุธูู ูุงููุณุงุฆู ูุฅุฌุฑุงุกุงุช ุงูุณูุงูุฉ.",str:"ุจูุฆุฉ ุตููุฉ ููุธูุฉ ููุญูุฒุฉ."},
  "ุงูุฅุฏุงุฑุฉ ุงูุตููุฉ":{imp:"ุชุนุฒูุฒ ุงูููุงุนุฏ ุงูุชุญููุฒูุฉ ูุฅุฏุงุฑุฉ ุงูุณููู ุฅูุฌุงุจููุง.",str:"ุถุจุท ุตููู ูุงุนู ูููุงุฎ ุชุนููู ุขูู."},
  "ุชุญููู ูุชุงุฆุฌ ุงููุชุนูููู ูุชุดุฎูุต ูุณุชููุงุชูู":{imp:"ุฌูุณุงุช ุชุญููู ุจูุงูุงุช ูุน ุฅุฌุฑุงุกุงุช ุนูุงุฌูุฉ ูุญุฏุฏุฉ.",str:"ุชุญููู ูููุฌู ูููุฏ ูุฑุงุฑุงุช ุชุฏุฑูุณูุฉ."},
  "ุชููุน ุฃุณุงููุจ ุงูุชูููู":{imp:"ุฅุฏุฑุงุฌ ุชููููุงุช ุฃุฏุงุฆูุฉ ูุชุญููู ูุชุงุฆุฌูุง.",str:"ุชููููุงุช ูุชููุนุฉ ูุฑุชุจุทุฉ ุจุงูุฃูุฏุงู."},
  "ุฅุนุฏุงุฏ ุฎุทุฉ ุฒูููุฉ ููุนุชูุฏุฉ ูุจุฑุงูุฌ ููุนุงููุงุช ุงููุดุงุท ุงูุทูุงุจู":{imp:"ุฅุญูุงู ุงูุฌุฏููุฉ ูุชุญุฏูุฏ ูุคุดุฑุงุช ูุฌุงุญ ููู ุจุฑูุงูุฌ.",str:"ุฎุทุฉ ูุดุงุท ูุงุถุญุฉ ุจูุคุดุฑุงุช ูุชุงุจุนุฉ."},
  "ุชููุฆุฉ ุงูุจูุฆุฉ ุงููุฏุฑุณูุฉ ููุจุฑุงูุฌ ูุงูุฃูุดุทุฉ ุงูุทูุงุจูุฉ":{imp:"ุญุตุฑ ุงูุงุญุชูุงุฌุงุช ูุชูุนูู ุงูุดุฑุงูุงุช ุงูุฏุงุฎููุฉ.",str:"ุฌุงูุฒูุฉ ูุฑุงูู ุชุฏุนู ุชูููุฐ ุงููุนุงููุงุช."},
  "ุฏุนู ุงููุนูููู ููู ุงุญุชูุงุฌุงุชูู ููููููู ููุฃุดุทุฉ":{imp:"ุงุณุชุจุงูุฉ ูููู ูุชูุฒูุน ุงูููุงู ุจุนุฏุงูุฉ.",str:"ููุงุกูุฉ ุชููููุงุช ุงููุดุงุท ูุน ูููู ุงููุนูููู."},
  "ุชุญููุฒ ุงููุชุนูููู ุนูู ุงููุดุงุฑูุฉ ูู ุงูุฃูุดุทุฉ":{imp:"ุญูุงูุฒ ููุนูุฉ ููุดุฑ ูุตุต ูุฌุงุญ.",str:"ูุดุงุฑูุฉ ุทูุงุจูุฉ ูุฑุชูุนุฉ ููุณุชุฏุงูุฉ."},
  "ุชูููุฐ ุงูุฎุทุฉ ุงููุดุชุฑูุฉ ููุจุฑุงูุฌ ุงูุตุญูุฉ ุงููุฏุฑุณูุฉ":{imp:"ุชูููู ุฏูุฑู ููุฃุซุฑ ูุชุญุฏูุซ ุงูุฑุณุงุฆู ุงูุชูุนููุฉ.",str:"ุชูููุฐ ููุถุจุท ูุจุฑุงูุฌ ุงูุตุญุฉ ุงููุฏุฑุณูุฉ."},
  "ุญุตุฑ ุงูุญุงูุงุช ุงูุตุญูุฉ ูููุชุนูููู":{imp:"ุฅุญูุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุณุฑูุฉ ุงูุณุฌูุงุช.",str:"ุฑุตุฏ ุฏููู ููุญุงูุงุช ูุฎุทุท ูุชุงุจุนุฉ."},
  "ุชููุฆุฉ ุงูุจูุฆุฉ ุงูุตุญูุฉ ุงููุฏุฑุณูุฉ":{imp:"ุชุญุณูู ููุงุท ุงููุงุก/ุงููุธุงูุฉ ูุงูููุตูุงุช ุงูุฅุฑุดุงุฏูุฉ.",str:"ุจูุฆุฉ ูุฏุฑุณูุฉ ุฏุงุนูุฉ ููุตุญุฉ."},
  "ุงูุชููุน ูู ุงูุงุณุชุฑุงุชูุฌูุงุช":{imp:"ุฃูุดุทุฉ ุญุณูุฉ ููุนุจ ููุฌูู ูุฑุงุนู ุงููุฑูู.",str:"ุชูููุน ุบูู ููุงุฆู ุฎุตุงุฆุต ุงูููุงุก."},
  "ุชุญุณูู ูุชุงุฆุฌ ุงูุชุนูู":{imp:"ุจุทุงูุงุช ููุงุญุธุฉ ูุนูุงุฑูุฉ ูุฎุทุฉ ููู ูุฑุฏูุฉ.",str:"ุชุญุณู ูู ุงููุคุดุฑุงุช ุงูููุงุฆูุฉ ุงูุฃุณุงุณูุฉ."},
  "ุฅุนุฏุงุฏ ุฎุทุฉ ุดุงููุฉ ูุชูุตูููุฉ ููุฃูุดุทุฉ":{imp:"ููุงุกูุฉ ุงูุฎุทุฉ ูุน ุงููุนุงููุฑ ุงูููุงุฆูุฉ ุงูููููุฉ.",str:"ุฎุทุฉ ุฃูุดุทุฉ ูุชุฏุฑุฌุฉ ููุชูุงููุฉ."},
  "ุชุตููู ุฎุจุฑุงุช ุชุนูู ูุฑูุฉ ููุจุชูุฑุฉ":{imp:"ุชูุณูุน ุฎุจุฑุงุช STEAM ูุตุบูุฑุฉ.",str:"ุฎุจุฑุงุช ูุจุชูุฑุฉ ุชุญููุฒ ุงููุถูู."},
  "ุงูุชููู ูู ุงููุงุฏุฉ ุงูุนูููุฉ":{imp:"ุชุญุฏูุซ ุงุณุชุฑุงุชูุฌูุงุช ุนุฑุถ ุงูููุงููู ุงููุจูุฑุฉ.",str:"ุชูููู ูุงุถุญ ูู ุชูุฏูู ุงููุญุชูู."},
  "ุงุณุชุฑุงุชูุฌูุงุช ุชุฏุฑูุณ ูุงุนูุฉ":{imp:"ุชูุงุฒู ุจูู ุงูููุฌูู ูุงูุญุฑ.",str:"ุงุณุชุฑุงุชูุฌูุงุช ูุนูุงูุฉ ุชุญูู ุฃูุฏุงู ุงูุฏุฑุณ."},
  "ุฅุดุฑุงู ุงูุฃุณุฑุฉ":{imp:"ุฑุฒูุงูุฉ ููุงู ููุฒููุฉ ูุตูุฑุฉ ููุซููุฉ.",str:"ุชูุงุนู ุฃุณุฑู ุฏุงุนู ููุชุนูู."},
  "ุชููุฆุฉ ุจูุฆุฉ ุชุนููููุฉ ุขููุฉ ููุญูุฒุฉ ูุชุทููุฑ ุงูููุงุก ูุงูุชุนูู":{imp:"ุฒูุงูุง ุชุนูู ูุญุฏุซุฉ ูุฅุฌุฑุงุกุงุช ุณูุงูุฉ.",str:"ุจูุฆุฉ ุบููุฉ ููุญูุฒุฉ ููููุงุก."},
  "ุชุนุฒูุฒ ุงูุชูุงุนู ุงูุฅูุฌุงุจู ูู ุจูุฆุฉ ุงูุชุนูู":{imp:"ุจุทุงูุงุช ุชุนุฒูุฒ ูุฌูุณุงุช ุฏุงุฆุฑุฉ.",str:"ุชูุงุนู ุฅูุฌุงุจู ูุงุณุชุฌุงุจุงุช ุจููุงุกุฉ."},
  "ุชูููู ุชูุฏู ุงููุชุนูููู ูุชุชุจุนู ูุชูุซููู":{imp:"ุณุฌูุงุช ููู ูุฑุฏูุฉ ูููุงุฑูุงุช ูุนูุงุฑูุฉ.",str:"ุชูุซูู ุชูุฏูู ูุงุถุญ ููููุฌู."},
  "ุชุดุงุฑู ูู ุงูุฃูุดุทุฉ":{imp:"ุฒูุงุฏุฉ ูุฑุต ุงููุดุงุฑูุฉ ุงูููุฌููุฉ.",str:"ูุจุงุฏุฑุฉ ููุดุงุฑูุฉ ูุนูุงูุฉ."},
  "ุชุตููู ุฃูุดุทุฉ ุชุนูู ุชูุจู ุงููุฑูู ุงููุฑุฏูุฉ ููู ูุชุนูู":{imp:"ุฎุทุท ุชูุฑูุฏ ูุจุณุทุฉ ููุณุงุฑุงุช ุงุฎุชูุงุฑ.",str:"ุชูุฑูุฏ ูุงุฌุญ ูุฑุงุนู ุงููุฑูู."},
  "ุชูููุฉ ููุงุฑุงุช ุงูุงุณุชููุงู ูุฏู ุงููุชุนูููู":{imp:"ุฑูุชูู ุงุณุชููุงูู ูููู ููุซูู.",str:"ุงุณุชููุงู ูุชุฒุงูุฏ ูู ุงูููุงู."},
  "ุชุทููุฑ ุงูุณููููุงุช ุงูุฅูุฌุงุจูุฉ ูุงูููู ูุงููุจุงุฏุฆ ูุงูุงุชุฌุงูุงุช":{imp:"ุชุนุฒูุฒุงุช ุงุฌุชูุงุนูุฉ ูุฎุทุท ุณููููุฉ.",str:"ุณููู ุฅูุฌุงุจู ูุชุณู."},
  "ุฎุทุฉ ุงููุฎุชุจุฑ ุงูููููุฉ":{imp:"ุฌุฏููุฉ ุงูุชุฌุงุฑุจ ูุน ุชุญูู ุฌุงูุฒูุฉ ุงูููุงุฏ.",str:"ุฎุทุฉ ุชุดุบูู ููููุฉ ูุงุถุญุฉ."},
  "ุงููุนุฑูุฉ ุจุงูุฃุณุณ ูุงูููุงููู ุงููููุฉ":{imp:"ุฏูุฑุงุช ูุตูุฑุฉ ูุชูุซูู ุฃุฏูุฉ ุงูุชุดุบูู.",str:"ุชูููู ููู ุจุงูููุงููู ุงูุฃุณุงุณูุฉ."},
  "ุชุฌููุฒ ุงููุณุชูุฒูุงุช":{imp:"ููุงุฆู ุฌุฑุฏ ููุดุชุฑูุงุช ุฏูุฑูุฉ.",str:"ุชุฌููุฒุงุช ููุชููุฉ ููุญุฏูุซุฉ."},
  "ุงูุณูุงูุฉ":{imp:"ุชุฏุฑูุจ ุฏูุฑู ูุชูุงุฑูู ุฅุฎูุงุก ูุตุบูุฑุฉ.",str:"ุงูุชุฒุงู ุตุงุฑู ุจุฅุฌุฑุงุกุงุช ุงูุณูุงูุฉ."},
  "ุชุญุถูุฑ ุงููุฎุชุจุฑ":{imp:"ูุงุฆูุฉ ูุญุต ูุจู/ุจุนุฏ ุงูุญุตุฉ.",str:"ุฌุงูุฒูุฉ ุนุงููุฉ ูุจู ุงูุฏุฑูุณ."},
  "ุชุณููู ุงูุฃุฌูุฒุฉ ูุชุฎุฒูููุง":{imp:"ูุธุงู ุงุณุชุนุงุฑุฉ ูุชุชุจุน ุขูู.",str:"ุชุณููู ูุชุฎุฒูู ููู ุงููุนุงููุฑ."},
  "ุชูุฑูุฑ ุฃุณุจูุนู ููุฃูุดุทุฉ":{imp:"ูููุฐุฌ ููุญุฏ ูุน ูุคุดุฑุงุช ุฃุฏุงุก.",str:"ุชูุงุฑูุฑ ููุชุธูุฉ ุชุฏุนู ุงููุฑุงุฑ."},
  "ุชูุงุฑูุฑ ุญุงูุฉ ุงูุฃุฌูุฒุฉ":{imp:"ููุญุฉ ุตูุงูุฉ ูุฏูุฑุฉ ุจูุงุบุงุช.",str:"ูุชุงุจุนุฉ ุขููุฉ ูุญุงูุฉ ุงูุฃุฌูุฒุฉ."},
  "ููุฏู ุงูุชุฏุฎูุงุช ุงูููุงุณุจุฉ ูุชุนุฒูุฒ ุงูุงูุถุจุงุท":{imp:"ุฎุทุฉ ุชุฏุฎูุงุช ูุชุฏุฑุฌุฉ ููุซููุฉ.",str:"ุชุฏุฎูุงุช ูุนูุงูุฉ ุฎููุถุช ุงููุฎุงููุงุช."},
  "ุชูุฏูู ุจุฑุงูุฌ ุชุฑุจููุฉ ูุชุนุฒูุฒ ุฏุงูุนูุฉ ุงูุทูุจุฉ ููุชุนูู":{imp:"ููุงุณ ุงูุฃุซุฑ ุนุจุฑ ุงุณุชุจุงูุงุช ุณุฑูุนุฉ.",str:"ุจุฑุงูุฌ ุฑูุนุช ุฏุงูุนูุฉ ุงูุชุนูู."},
  "ุฅุนุฏุงุฏ ุฎุทุฉ ุจุฑุงูุฌ ุงูุชูุฌูู ุงูุทูุงุจู":{imp:"ุชุญุฏูุฏ ูุคุดุฑุงุช ุฅูุฌุงุฒ ููู ุจุฑูุงูุฌ.",str:"ุฎุทุฉ ูุชูุงุฒูุฉ ุชุบุทู ุงูุงุญุชูุงุฌุงุช."},
  "ุนุฑุถ ุงูุญุงูุงุช ูุจุฑุงูุฌ ุงูุฏุนู ุงูููุงุณุจุฉ":{imp:"ูููุงุช ูุชุงุจุนุฉ ูุฑุฏูุฉ ูุญุฏุซุฉ.",str:"ููุงุฑุจุงุช ุฏุนู ููุงุณุจุฉ ููุญุงูุงุช."},
  "ูุนุฒุฒ ุงูููู ูุงูุณููููุงุช ูููุชุนูููู":{imp:"ุฃูุดุทุฉ ููููุฉ ูุน ุดุฑุงูุงุช ุตููุฉ.",str:"ุชุนุฒูุฒ ููู ูุณููู ุฅูุฌุงุจู."},
  "ุชูุฏูู ุงูุฃูุดุทุฉ ูุงูุจุฑุงูุฌ ุงูุฅุฑุดุงุฏูุฉ":{imp:"ุชูููุน ุงููุณุงุฆุท ูุงูุฅุดุฑุงู ุงููุนุงู.",str:"ุจุฑุงูุฌ ุฅุฑุดุงุฏูุฉ ูุคุซุฑุฉ."},
  "ูุณุงุนุฏ ุงููุนูููู ูู ุงูุชุฎุทูุท ุงููููู ูุงูุฃูุงุฏููู":{imp:"ุฌูุณุงุช ุฅุฑุดุงุฏ ููููุฉ ููุซููุฉ.",str:"ุฏุนู ูููููู ุงูุนูุณ ุนูู ุงูุทูุงุจ."},
  "ูุนุฒุฒ ุงูุชููู ุงูุฏุฑุงุณู":{imp:"ุฎุทุท ุฅุซุฑุงุฆูุฉ ูููุชููููู.",str:"ุฑุนุงูุฉ ูุนุงูุฉ ูููุชููููู."},
  "ูุชุงุจุน ุชุฏุฎูุงุช ุชุฑุจููุฉ ูููุชุนุซุฑูู ุฏุฑุงุณููุง ูุณูููููุง":{imp:"ุฎุฑุงุฆุท ุชุฏุฎู ูุฑุฏูุฉ ููุฑุงุฌุนุงุช.",str:"ุชุญุณู ููุงุญุธ ูุฏู ุงููุชุนุซุฑูู."},
  "ุชูุนูุฉ ุงููุชุนูููู ูุฃูููุงุก ุฃููุฑูู ุจููุงุนุฏ ุงูุณููู ูุงูููุงุธุจุฉ":{imp:"ููุงุฏ ุชูุนููุฉ ูุฎุชุตุฑุฉ ูุฏูุฑูุฉ.",str:"ูุนู ูุฑุชูุน ุจุงูุงูุถุจุงุท."},
  "ูุฑู ููุงุฏุฑ ุนูู ุชูููุฐ ุฃุนูุงูู ูู ุธู ุธุฑูู ุงูุนูู ุงููุฎุชููุฉ":{imp:"ุฎุทุท ุจุฏููุฉ ูุณููุงุฑูููุงุช ุชุดุบูู.",str:"ูุฑููุฉ ุชุดุบูููุฉ ุนุงููุฉ."},
  "ูุฏุนู ููุดุงุฑู ูู ุงููุจุงุฏุฑุงุช ุงูููุนูุฉ":{imp:"ุชุญุฏูุฏ ูุนุงููุฑ ุงุฎุชูุงุฑ ุงููุจุงุฏุฑุงุช.",str:"ูุจุงุฏุฑุงุช ุฐุงุช ุฃุซุฑ ููุญูุธ."},
  "ูุชุฎุฐ ุฅุฌุฑุงุกุงุช ุชุฑุจููุฉ ุชุญูู ุงูุงูุถุจุงุท ุงููุฏุฑุณู":{imp:"ูุตูููุฉ ุฅุฌุฑุงุกุงุช ุชูุงุณุจ ุงููุฎุงููุฉ.",str:"ุงูุถุจุงุท ูุญุณูู ุจุฅุฌุฑุงุกุงุช ุนุงุฏูุฉ."},
  "ูุฏูุฑ ุงูููุงุฑุฏ ูู ุงููุฏุฑุณุฉ ุจููุงุกุฉ":{imp:"ููุญุฉ ุชุฎุตูุต ููุงุฑุฏ ููุคุดุฑุงุช ููุงุกุฉ.",str:"ููุงุกุฉ ูุฑุชูุนุฉ ูู ุฅุฏุงุฑุฉ ุงูููุงุฑุฏ."},
  "ุฎุทุฉ ุงูุชุทููุฑ ุงููููู":{imp:"ููุงุกูุฉ ุงูุฎุทุฉ ูุน ูุฌูุงุช ุงูุฃุฏุงุก.",str:"ุฎุทุฉ ุชุทููุฑ ูููู ูุนุงูุฉ."},
  "ูุชุงุจุนุฉ ูุคุดุฑุงุช ุงูุฃุฏุงุก":{imp:"ุงุฌุชูุงุน ุฏูุฑู ููุฑุงุฌุนุฉ ุงููุคุดุฑุงุช.",str:"ุชุญูู ูุณุชูุฑ ูู ุงููุคุดุฑุงุช."},
  "ุชูููุฐ ุจุฑุงูุฌ ุงูุชุทููุฑ":{imp:"ุชูุซูู ุงูุฃุซุฑ ุจุนุฏ ูู ุจุฑูุงูุฌ.",str:"ุชูููุฐ ููุธู ูุจุฑุงูุฌ ุงูุชุทููุฑ."},
  "ุชูููู ุฃุฏุงุก ุงูููุณูุจูู":{imp:"ุฌุฏุงูู ูุชุงุจุนุฉ ูุฒูุงุฑุงุช ุตููุฉ.",str:"ุชูููู ุนุงุฏู ูุงุฆู ุนูู ุดูุงูุฏ."},
  "ุชุญุณูู ูุชุงุฆุฌ ุงูุชุนูู ุนููููุง":{imp:"ุชุญููู ุจูุงูุงุช ูุงุฎุชูุงุฑ ุชุฏุฎูุงุช ูุนูุงูุฉ.",str:"ุชุญุณู ูุฏููุน ุจุงูุฃุฏูุฉ."},
  "ุฑูุน ุฃุฏุงุก ุงููุฏุฑุณุฉ":{imp:"ุฎุทุฉ ุชุญุณูู ุฒูููุฉ ุจูุคุดุฑุงุช.",str:"ุงุฑุชูุงุน ููููุณ ูู ุงูุฃุฏุงุก ุงููุคุณุณู."},
  "ุฅุนุฏุงุฏ ุงูุฎุทุท ุงููุฏุฑุณูุฉ":{imp:"ููุงุกูุฉ ุงูุฎุทุท ูุน ุงููุฑุฌุนูุงุช.",str:"ุฎุทุท ูุชุณูุฉ ูุน ุงูุฃูุฏุงู."},
  "ูุชุงุจุนุฉ ุชูููุฐ ุงูุฎุทุท":{imp:"ุชูุงุฑูุฑ ุชูุฏู ูุตูุฑุฉ ููุชุธูุฉ.",str:"ุชูููุฐ ูุญููู ุจูุคุดุฑุงุช."},
  "ุงููุดุงุฑูุฉ ูู ุงูุฃูุดุทุฉ":{imp:"ุฑูุฒูุงูุฉ ุญุถูุฑ ููุชุงุจุนุฉ ุฃุซุฑ.",str:"ุญุถูุฑ ุฏุงุนู ูุนุฒุฒ ุงููุดุงุฑูุฉ."},
  "ุชูุธูู ุงูููุตุงุช ุงูุฑูููุฉ":{imp:"ููุงุฆุญ ุชุดุบูู ูุฃุฏูุงุฑ ูุงุถุญุฉ.",str:"ุงุณุชุซูุงุฑ ูุนูุงู ููููุตุงุช."},
  "ุชุนุฒูุฒ ุงูุณููู ุงูุฅูุฌุงุจู":{imp:"ุจุฑุงูุฌ ุชุญููุฒูุฉ ูุจุทุงูุงุช ุชูุฏูุฑ.",str:"ููุงุฎ ุณูููู ุฅูุฌุงุจู."},
  "ุชููุฆุฉ ุจูุฆุฉ ูุฏุฑุณูุฉ ุขููุฉ ููุญุตูุฉ ุนูู ุงูุชุนูู":{imp:"ูุญุต ุฏูุฑู ููุฎุงุทุฑ ูุณูุงูุฉ.",str:"ุจูุฆุฉ ุขููุฉ ููุญูุฒุฉ ููุชุนูู."},
  "ูุดุงุฑู ูู ุฅุนุฏุงุฏ ุฎุทุฉ ุงูุชุทููุฑ ุงููููู":{imp:"ูุตูููุฉ ุงุญุชูุงุฌุงุช ูุจููุฉ ุนูู ุจูุงูุงุช.",str:"ูุณุงููุฉ ููุนูุฉ ูู ุงูุชุฎุทูุท."},
  "ูุชุงุจุน ุงูุชุบุฐูุฉ ุงูุฑุงุฌุนุฉ ููุชุงุฆุฌ ุชุญูู ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงููุธููู":{imp:"ุณุฌู ููุงุญุธุงุช ูุชุญุณููุงุช ุฏูุฑูุฉ.",str:"ุชุทููุฑ ูุณุชูุฑ ุจูุงุกู ุนูู ุงูุชุบุฐูุฉ."},
  "ูุฏุนู ุชูููุฐ ุจุฑุงูุฌ ุงูุชุทููุฑ ุงููููู":{imp:"ุชุฐููู ุนูุงุฆู ูุชููุฆุฉ ููุงุฑุฏ.",str:"ุฏุนู ููุฏุงูู ูุนูุงู ููุชุทููุฑ."},
  "ูููู ุฃุฏุงุก ููุณูุจู ุงููุฏุฑุณุฉ":{imp:"ููุงูุจ ููุงุญุธุฉ ููุนุงููุฑ ููุญุฏุฉ.",str:"ุชูููู ูุจูู ุนูู ูุนุงููุฑ ูุงุถุญุฉ."},
  "ูููุฐ ุฅุฌุฑุงุกุงุช ุนูููุฉ ูุชุญุณูู ูุชุงุฆุฌ ุงูุชุนูู":{imp:"ุชุฌุงุฑุจ ุตุบูุฑุฉ ูุชุญููู ุฃุซุฑ.",str:"ุชุญุณููุงุช ูุงุฆูุฉ ุนูู ุงูุฏููู."},
  "ูุณุงูู ูู ุฑูุน ูุณุชูู ุฃุฏุงุก ุงููุฏุฑุณุฉ":{imp:"ูุดุฑูุนุงุช ุชุญุณูู ูุตูุฑุฉ ุงูุฃูุฏ.",str:"ุฃุซุฑ ููุญูุธ ุนูู ุงูุฃุฏุงุก ุงูุนุงู."},
  "ูููุฑ ุงููุฑุต ูุงูุฅููุงูุงุช ุงูุฏุงุนูุฉ ููุดุงุฑูุฉ ุงูุทูุงุจ ูู ุงูุฃูุดุทุฉ ุงูุตููุฉ ูุบูุฑ ุงูุตููุฉ":{imp:"ุชูุณูุน ุงููุฑุงูู ูุงูุฒูู ุงููุชุงุญ.",str:"ุฅุชุงุญุฉ ูุนุงูุฉ ุชุฑูุน ุงููุดุงุฑูุฉ."},
  "ููุธู ุงูููุตุงุช ุงูุฑูููุฉ ูุชุทุจููุงุชูุง ุงูุชุนููููุฉ ูู ุฏุนู ุนูููุงุช ุงูุชุนููู ูุงูุชุนูู":{imp:"ุฎุทุท ุชุดุบูู ูุงุถุญุฉ ูุชุฏุฑูุจ.",str:"ุชูุงูู ุชููู ุฏุงุนู ููุชุนูู."},
  "ูุนุฒุฒ ุงูุณููู ุงูุฅูุฌุงุจู ููุทูุงุจ":{imp:"ูุฌุชูุนุงุช ุตููุฉ ููุชุญููุฒ.",str:"ุณููู ุฅูุฌุงุจู ูุณุชุฏุงู."}
};

/* ูุณุชููุงุช ุงูุชูุฏูุฑ ุงูุนุงู (ูุตู ุงูุชูุฏูุฑ ุฃุณูู ุงูุฌุฏูู) */
const GENERAL_LEVELS = [
  {min:90, max:100, desc:"ูุซุงูู", label:"5", cls:"lv5"},
  {min:80, max:89.999, desc:"ูุชุฎุทู ุงูุชููุนุงุช", label:"4", cls:"lv4"},
  {min:70, max:79.999, desc:"ููุงูู ุงูุชููุนุงุช", label:"3", cls:"lv3"},
  {min:60, max:69.999, desc:"ุจุญุงุฌุฉ ุฅูู ุชุทููุฑ", label:"2", cls:"lv2"},
  {min:0,  max:59.999, desc:"ุบูุฑ ูุฑุถู", label:"1", cls:"lv1"}
];

/* ุชุชุจูุน ุงูุชุญุฑูุฑ ุงููุฏูู */
let editedStrengths=false, editedImproves=false;
$('#strengths').addEventListener('input',()=>{editedStrengths=true; snap();});
$('#improves').addEventListener('input',()=>{editedImproves=true; snap();});

/* ุฃุฏูุงุช ูุณุงุนุฏุฉ */
function cleanText(s){return String(s||'').replace(/\s+/g,' ').trim();}
function bulletize(s){s=cleanText(s); if(!s) return ''; return s.startsWith('โข')? s : 'โข '+s;}
function uniq(arr){const seen=new Set(); const out=[]; for(const t of arr){const k=cleanText(t); if(k && !seen.has(k)){seen.add(k); if(!out.includes(k)) out.push(k);} } return out;}
function joinSlashLine(arr){const list=uniq(arr).map(bulletize); return list.length? list.join(' / '): 'โ';}

/* ูุงุนุฏุฉ ุงูุจูุงูุงุช */
function dbGet(){ try{return JSON.parse(localStorage.getItem(K_DB)||'[]');}catch{return [];} }
function dbSet(arr){ localStorage.setItem(K_DB,JSON.stringify(arr)); }
function upsertRecord(rec){
  const db=dbGet();
  const key = makeKey(rec.school,rec.modelKey,rec.stageKey,(rec.id||rec.name||''));
  const i=db.findIndex(x=>x._key===key);
  rec._key=key; rec.updatedAt=new Date().toISOString();
  if(i>=0){ db[i]=rec; } else { rec.createdAt=rec.updatedAt; db.push(rec); }
  dbSet(db); localStorage.setItem('PF_lastRecordId',key);
}
function makeKey(school,modelKey,stageKey,idOrName){
  return [school||'',modelKey||'',stageKey||'',(idOrName||'')].join('|');
}
function findByCurrentPerson(){
  const db=dbGet();
  const key=makeKey($('#schTxt').textContent.trim(), $('#model').value, $('#stage').value, ($('#tId').value||$('#tName').value||''));
  return db.find(x=>x._key===key);
}

/* ุฏุงูุฉ ุชุณููุฉ ุงููุฑุญูุฉ ูู ุงูููุฏุฑ */
function stageHeaderLabel(key){
  switch(key){
    case 'first':  return 'ูุฑุญูุฉ ุงูุชุฎุทูุท ููุฃุฏุงุก';
    case 'second': return 'ูุฑุญูุฉ ุงููุฑุงุฌุนุฉ ุงููุตู ุณูููุฉ';
    case 'final':  return 'ูุฑุญูุฉ ุชูููู ุงูุฃุฏุงุก ุงููุธููู ุงูููุงุฆู';
    default:       return 'ูุฑุญูุฉ ุงูุชูููู';
  }
}

/* ุจูุงุก ุงูุฌุฏูู */
function build(){
  const key=$('#model').value, arr=RUBRICS[key]||[]; const tb=$('#rows'); tb.innerHTML=''; let ws=0;
  arr.forEach((it,i)=>{ws+=it.w;const tr=document.createElement('tr');tr.dataset.w=it.w;
    tr.innerHTML=`<td style="text-align:right"><b style="color:#0c594e">${i+1}</b> โ <span class="item">${it.name}</span></td>
      <td>${it.w}%</td>
      <td style="text-align:center"><select class="select-mini g"><option>1</option><option>2</option><option selected>3</option><option>4</option><option>5</option></select></td>
      <td style="text-align:center"><span class="s">0.00</span></td>`;
    tb.appendChild(tr);
  });
  $('#sumW').textContent=ws+'%';
  $('#mdlTxt').textContent='ูููุฐุฌ ุงูุชูููู: '+$('#model').selectedOptions[0].textContent;
  $('#stageTxt').textContent = stageHeaderLabel($('#stage').value);

  if($('#stage').value==='first'){ autoFillGoals(); }
  renderGoalChips();
  toggleStageLock();
  recalc(); snap();
}

/* ุดุฑูุท ุนุฑุถ ุงูุฃูุฏุงู ููุทุจุงุนุฉ */
function readGoal(n){ return {t:$('#g'+n).value.trim(), i:$('#g'+n+'i').value.trim(), v:$('#g'+n+'t').value.trim()}; }
function renderGoalsPrint(){
  const gp=$('#goalsPrint');
  const goals=[1,2,3].map(readGoal);
  gp.innerHTML = goals.map(g=>`
    <div class="row">
      <div class="cell"><span class="hdr">ุงููุฏู:</span> ${g.t||'โ'}</div>
      <div class="cell"><span class="hdr">ุงููุคุดุฑ:</span> ${g.i||'โ'}</div>
      <div class="cell"><span class="hdr">ุงููุณุชูุฏู:</span> ${g.v||'โ'}</div>
    </div>`).join('');
}

/* ุฅุธูุงุฑ/ุฅุฎูุงุก ุนูุงุตุฑ ุงูุชุฎุทูุท */
function toggleStageLock(){
  const isFirst=$('#stage').value==='first';
  $('#goals').style.display=isFirst?'block':'none';
  const msg='ูุฐู ุงููุฑุญูุฉ ููุชุฎุทูุท โ ุงูุชูู ูููุฑุญูุฉ ุงูุซุงููุฉ';
  $$('.g').forEach(s=>{ s.disabled=isFirst; s.parentElement.parentElement.classList.toggle('tip',isFirst); s.parentElement.parentElement.setAttribute('data-tip', isFirst?msg:'');});
  $('#gapBtn').disabled=false; $('#archBtn').disabled=false;
}

/* ุงูุญุณุงุจ + ุงูููุฉ/ุงูุชุญุณูู + ุตู ูุณุชูู ุงูุชูุฏูุฑ ุงูุนุงู */
function recalc(){
  let total=0, ws=0, n=0,d=0;
  const strengths=[], improves=[];
  $$('#rows tr').forEach(tr=>{
    const w=+tr.dataset.w; ws+=w; const v=+tr.querySelector('.g').value; const item=tr.querySelector('.item').textContent.trim();
    tr.querySelector('.s').textContent=((v/5)*w).toFixed(2); total+=(v/5)*w; n+=v*w; d+=w;
    for(let k=1;k<=5;k++) tr.classList.remove('r'+k); tr.classList.add('r'+v);

    const bank=BANK_IMPROVE[item];
    if(v>=4){
      strengths.push(bank?.str || `ุชูููุฒ ูู ยซ${item}ยป.`);
    }
    if(v<=2){
      improves.push(bank?.imp || `ุชุทููุฑ ยซ${item}ยป ุจุฎุทุฉ ูุตูุฑุฉ ูุดูุงูุฏ ุฃุณุจูุนูุฉ.`);
    }
  });
  const avg=d? n/d : 0;
  $('#sum').textContent=total.toFixed(2); $('#avg').textContent=avg.toFixed(2);
  $('#fill').style.width=Math.min(100,total)+'%';
  $('#kL').textContent=`ูุคุดุฑ ุงูุฅูุฌุงุฒ: ${total.toFixed(0)}%`;
  $('#kM').textContent=`ูุชูุณุท ุงูุณููููู: ${avg.toFixed(2)} / 5`;
  $('#kR').textContent=`ูุฌููุน ุงูุฃูุฒุงู: ${ws}%`;
  $('#sigT').textContent=$('#tName').value||'โ';

  /* ุตู ูุณุชูู ุงูุชูุฏูุฑ ุงูุนุงู ููุฃุฏุงุก */
  const pill = $('#overallPill');
  const clsList = ['lv1','lv2','lv3','lv4','lv5'];
  clsList.forEach(c=>pill.classList.remove(c));

  let level = GENERAL_LEVELS.find(l=> total>=l.min && total<=l.max);
  if(!level && total>0){ level = GENERAL_LEVELS[GENERAL_LEVELS.length-1]; }

  if(level){
    pill.classList.add(level.cls);
    $('#overallClass').textContent = level.label;
    $('#overallDesc').textContent  = 'ูุณุชูู ุงูุชูุฏูุฑ ุงูุนุงู ููุฃุฏุงุก โ ' + level.desc;
  }else{
    $('#overallClass').textContent = 'โ';
    $('#overallDesc').textContent  = 'ูุณุชูู ุงูุชูุฏูุฑ ุงูุนุงู ููุฃุฏุงุก';
  }
  $('#overallPercent').textContent = 'ุงูุฏุฑุฌุฉ ุงููุณุจูุฉ: ' + total.toFixed(0) + '%';
  $('#overallAvg').textContent     = 'ูุชูุณุท ' + avg.toFixed(2) + ' / 5';

  if(!editedStrengths){
    const s = joinSlashLine(strengths);
    $('#strengths').textContent = s || (cleanText($('#strengths').textContent)||'โ');
  }

  const currentImp = cleanText($('#improves').textContent);
  const sourceList = (editedImproves && currentImp && currentImp!=='โ')
    ? [currentImp, ...improves]
    : improves;
  const mergedImp = joinSlashLine(sourceList);
  $('#improves').textContent = mergedImp || (currentImp || 'โ');
}

/* ุญูุธ ููุทุฉ */
function snap(){
  renderGoalsPrint();
  const rows=$$('#rows tr').map(tr=>({name:tr.querySelector('.item').textContent,w:+tr.dataset.w,v:+tr.querySelector('.g').value}));
  const data={
    dir:$('#dirTxt').textContent.trim(), school:$('#schTxt').textContent.trim(),
    model:$('#model').selectedOptions[0].textContent, modelKey:$('#model').value,
    stage:$('#stage').selectedOptions[0].textContent, stageKey:$('#stage').value,
    name:$('#tName').value||'โ', id:$('#tId').value||'', spec:$('#tSpec').value||'', title:$('#tTitle').value||'',
    principal:$('#sigP').textContent.trim(), rows, avg:+$('#avg').textContent, total:+$('#sum').textContent,
    strengths:$('#strengths').textContent, improves:$('#improves').textContent,
    goals:[{t:$('#g1').value||'',i:$('#g1i').value||'',v:$('#g1t').value||''},
           {t:$('#g2').value||'',i:$('#g2i').value||'',v:$('#g2t').value||''},
           {t:$('#g3').value||'',i:$('#g3i').value||'',v:$('#g3t').value||''}]
  };
  localStorage.setItem(K_SESSION,JSON.stringify(data));
  return data;
}

/* ูุชุญ ุงูุตูุญุงุช */
function openGap(){ const snapData=snap(); upsertRecord(snapData); window.open('gap.html','_blank'); }
function openArch(){ const snapData=snap(); upsertRecord(snapData); window.open('kashf.html','_blank'); }
function openDlel(){ const snapData=snap(); upsertRecord(snapData); window.open('dlel.html','_blank'); }

/* ===== ุนุฏุณุฉ ุงูุฃุณูุงุก ===== */
let PEOPLE = [];
function updateLensInfo(){
  const n=PEOPLE.length;
  $('#lensInfo').textContent = n? `ุชู ุชุญููู ${n} ุณุฌููุง` : 'ูุง ุชูุฌุฏ ุจูุงูุงุช ูุณุชูุฑุฏุฉ ุจุนุฏ';
}
function savePeople(){ localStorage.setItem(K_PEOPLE, JSON.stringify(PEOPLE||[])); updateLensInfo(); }
function loadPeople(){
  try{ PEOPLE = JSON.parse(localStorage.getItem(K_PEOPLE)||'[]')||[]; }
  catch{ PEOPLE = []; }
  renderPeople();
  updateLensInfo();
}
function norm(s){ return String(s||'').toLowerCase().trim().replace(/\s+/g,' '); }
function mapHeaders(cols){
  const map={
    name:['ุงูุงุณู','ุงุณู','ุงุณู ุงููุนูู','ุงุณู ุงูููุธู','name','full name'],
    id:['ุงููููุฉ','ุฑูู ุงููููุฉ','ุงูุณุฌู ุงููุฏูู','id','national id'],
    spec:['ุงูุชุฎุตุต','ุงููุงุฏุฉ','ุงูุชุฎุตุต ุงูุฏุฑุงุณู','specialty','subject','major'],
    title:['ุงููุณูู','ุงููุณูู ุงููุธููู','ุงููุธููุฉ','job title','title']
  };
  const idx={name:-1,id:-1,spec:-1,title:-1};
  cols.forEach((h,i)=>{
    const k=norm(h);
    for(const key in map){
      if(map[key].some(alias=>norm(alias)===k || k.includes(norm(alias)))){
        if(idx[key]===-1) idx[key]=i;
      }
    }
  });
  return idx;
}
function toArray(workbook){
  const sheetName = workbook.SheetNames[0];
  const sheet = workbook.Sheets[sheetName];
  const json = XLSX.utils.sheet_to_json(sheet,{header:1,defval:''});
  if(!json.length) return [];
  const headers = json[0];
  const idx = mapHeaders(headers);
  const rows = json.slice(1).map(r=>({
    name: String(r[idx.name] ?? '').trim(),
    id: String(r[idx.id] ?? '').trim(),
    spec: String(r[idx.spec] ?? '').trim(),
    title: String(r[idx.title] ?? '').trim()
  })).filter(x=>x.name);
  return rows;
}
function parseFile(file){
  const reader = new FileReader();

  const ext = (file.name || '').split('.').pop().toLowerCase();
  const isText = ['csv','tsv','txt'].includes(ext) || /csv|text\/plain/i.test(file.type || '');

  reader.onload = (e) => {
    try{
      let wb;

      if(isText){
        // CSV/TSV/TXT => ูุฑุงุกุฉ ูุตูุฉ
        let text = String(e.target.result || '');

        // ุฅุฒุงูุฉ BOM ุฅู ูุฌุฏ (ููู ูุน ุงูุนุฑุจูุฉ ูู CSV)
        if(text.charCodeAt(0) === 0xFEFF) text = text.slice(1);

        const opts = { type:'string' };
        // TSV: ูุตู ุจุนูุงูุฉ ุชุจููุจ
        if(ext === 'tsv') opts.FS = '\t';

        wb = XLSX.read(text, opts);
      }else{
        // Excel ุจุฃููุงุนู => ูุฑุงุกุฉ ุซูุงุฆูุฉ
        const data = new Uint8Array(e.target.result);
        wb = XLSX.read(data, { type:'array' });
      }

      const arr = toArray(wb);
      PEOPLE = arr;
      savePeople();
      renderPeople();
    }catch(err){
      alert('ุชุนุฐุฑ ูุฑุงุกุฉ ุงูููู. ุชุฃูุฏ ูู ุงูุตูุบุฉ ูุงูุฃุนูุฏุฉ.\n' + (err?.message || err));
    }
  };

  if(isText){
    reader.readAsText(file, 'utf-8');
  }else{
    reader.readAsArrayBuffer(file);
  }
}

function hasSavedForPerson(p){
  const db=dbGet();
  const key=makeKey($('#schTxt').textContent.trim(), $('#model').value, $('#stage').value, (p.id||p.name||''));
  return db.some(x=>x._key===key);
}
function renderPeople(filter=''){
  const body=$('#peopleBody');
  const q=norm(filter);
  const rows = PEOPLE.filter(p=>{
    if(!q) return true;
    return norm(p.name).includes(q) || norm(p.id).includes(q) || norm(p.spec).includes(q) || norm(p.title).includes(q);
  });
  if(!rows.length){
    body.innerHTML = `<tr><td colspan="6" style="text-align:center;color:#678">โ ูุง ูุชุงุฆุฌ โ</td></tr>`;
    return;
  }
  body.innerHTML = rows.map((p,i)=>{
    const saved = hasSavedForPerson(p);
    const tag = saved ? `<span class="tag">ูุญููุธ</span>` : '';
    return `
    <tr>
      <td>${p.name||'โ'}</td>
      <td>${p.id||'โ'}</td>
      <td>${p.spec||'โ'}</td>
      <td>${p.title||'โ'}</td>
      <td>${tag}</td>
      <td><button class="row-btn" data-i="${i}">ุงุฎุชูุงุฑ</button></td>
    </tr>`;
  }).join('');
}
function loadRecordIntoForm(rec){
  if(!rec) return;
  // โ ุถูุงู ูุฌูุฏ ุตููู ุงูุฌุฏูู ูุจู ุชุญููู ุงูููู
  if(!document.querySelector('#rows tr')){ build(); }
  if($('#model').value!==rec.modelKey){ $('#model').value=rec.modelKey; build(); }
  if($('#stage').value!==rec.stageKey){ $('#stage').value=rec.stageKey; toggleStageLock(); $('#stageTxt').textContent=stageHeaderLabel($('#stage').value); }
  $('#tName').value = rec.name || '';
  $('#tId').value   = rec.id || '';
  $('#tSpec').value = rec.spec || '';
  $('#tTitle').value= rec.title || 'ูุนูู ููุงุฑุณ';
  const map = new Map(rec.rows.map(r=>[r.name, r.v]));
  $$('#rows tr').forEach(tr=>{
    const item = tr.querySelector('.item').textContent.trim();
    const val = map.get(item);
    if(val) tr.querySelector('.g').value = String(val);
  });
  editedStrengths = true; editedImproves = true;
  $('#strengths').textContent = rec.strengths || 'โ';
  $('#improves').textContent  = rec.improves  || 'โ';
  const gs = rec.goals||[];
  $('#g1').value=gs[0]?.t||''; $('#g1i').value=gs[0]?.i||''; $('#g1t').value=gs[0]?.v||'';
  $('#g2').value=gs[1]?.t||''; $('#g2i').value=gs[1]?.i||''; $('#g2t').value=gs[1]?.v||'';
  $('#g3').value=gs[2]?.t||''; $('#g3i').value=gs[2]?.i||''; $('#g3t').value=gs[2]?.v||'';
  renderGoalsPrint();
  recalc(); snap();
}

/* ุฅูุดุงุก ูุชุญููู ูุงูุจ ุนุฏุณุฉ ุงูุฃุณูุงุก (CSV) */
function downloadPeopleTemplate(){
  // ูุงูุจ Excel (XLSX) โ ูุนูู ุนูู ุฌููุน ุจุฑุงูุฌ ุงูุฌุฏุงูู ููููู ุญูุธู ุจุฃู ุงูุชุฏุงุฏ ูุงุญููุง
  const aoa = [
    ['ุงูุงุณู','ุฑูู ุงููููุฉ','ุงูุชุฎุตุต','ุงููุณูู'],
    ['ููุฏ ุญุงูุฏ','1234567890','ุฑูุงุถูุงุช','ูุนูู ููุงุฑุณ']
  ];

  const ws = XLSX.utils.aoa_to_sheet(aoa);

  // ุชุญุณููุงุช ุจุณูุทุฉ ููุนุฑุถ (ุงุฎุชูุงุฑู ูุขูู)
  ws['!cols'] = [{wch:26},{wch:16},{wch:18},{wch:16}];

  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'ุงูุฃุณูุงุก');

  // ุชูุฒูู ููู XLSX
  XLSX.writeFile(wb, 'ูุงูุจ ุนุฏุณุฉ ุงูุฃุณูุงุก.xlsx', {bookType:'xlsx', compression:true});
}

/* ===== ุชุตุฏูุฑ/ุงุณุชูุฑุงุฏ ุฌููุน ุจูุงูุงุช ุงูุฃุฏุงุฉ (ูู ููุงุชูุญ PF_) ===== */
function pad2(n){ return String(n).padStart(2,'0'); }

function toAsciiDigits(str){
  return String(str||'')
    .replace(/[ู-ูฉ]/g, d => '0123456789'['ููกูขูฃูคูฅูฆูงูจูฉ'.indexOf(d)])
    .replace(/[ฐ-น]/g, d => '0123456789'['ฐฑฒณดตถทธน'.indexOf(d)]);
}

function getHijriStamp(){
  try{
    const fmt = new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura', {year:'numeric',month:'2-digit',day:'2-digit'});
    const h = fmt.format(new Date());
    return toAsciiDigits(h).replace(/[\/.]/g,'-').replace(/\s+/g,'');
  }catch{
    return '';
  }
}

function getLocalStamp(){
  const d=new Date();
  const y=d.getFullYear();
  const m=pad2(d.getMonth()+1);
  const da=pad2(d.getDate());
  const hh=pad2(d.getHours());
  const mm=pad2(d.getMinutes());
  return `${y}-${m}-${da}_${hh}${mm}`;
}

function exportAllPF(){
  const data = {};
  for(let i=0;i<localStorage.length;i++){
    const k = localStorage.key(i);
    if(k && k.startsWith('PF_')){
      data[k] = localStorage.getItem(k);
    }
  }
  const payload = {
    app: "Performance-Eval-Tool",
    version: 1,
    exportedAt: new Date().toISOString(),
    hijri: getHijriStamp(),
    localStamp: getLocalStamp(),
    data
  };

  const blob = new Blob([JSON.stringify(payload, null, 2)], {type:'application/json;charset=utf-8'});
  const url = URL.createObjectURL(blob);

  const hijri = payload.hijri ? `-${payload.hijri}` : '';
  const fileName = `ูุณุฎุฉ ุจูุงูุงุช ูููุฐุฌ ุชูููู ุงูุฃุฏุงุก-${payload.localStamp}${hijri}.json`;

  const a = document.createElement('a');
  a.href = url;
  a.download = fileName;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);

  showToast('ุชู ุชุตุฏูุฑ ุจูุงูุงุช ุงูุฃุฏุงุฉ โ');
}

function hardResetPFKeys(){
  const keys=[];
  for(let i=0;i<localStorage.length;i++){
    const k=localStorage.key(i);
    if(k && k.startsWith('PF_')) keys.push(k);
  }
  keys.forEach(k=>localStorage.removeItem(k));
}

function refreshUIAfterImport(){
  const dirSaved=localStorage.getItem(K_DIR);
  const schSaved=localStorage.getItem(K_SCH);
  const pSaved=localStorage.getItem(K_P);

  if(dirSaved) $('#dirTxt').textContent = dirSaved;
  if(schSaved) $('#schTxt').textContent = schSaved;
  if(pSaved)   $('#sigP').textContent   = pSaved;

  loadPeople();

  try{
    const s = JSON.parse(localStorage.getItem(K_SESSION)||'null');
    if(s){
      loadRecordIntoForm(s);
    }else{
      build(); recalc(); renderGoalsPrint(); snap();
    }
  }catch{
    build(); recalc(); renderGoalsPrint(); snap();
  }

  renderPeople($('#searchBox')?.value || '');
  showToast('ุชู ุงูุงุณุชูุฑุงุฏ ุจูุฌุงุญ โ');
}

function importAllPF(file){
  const reader = new FileReader();
  reader.onload = e => {
    try{
      const txt = e.target.result;
      const payload = JSON.parse(txt);

      if(!payload || typeof payload !== 'object' || !payload.data || typeof payload.data !== 'object'){
        alert('ููู ุบูุฑ ุตุงูุญ: ูุง ูุญุชูู ุนูู ุจูุงูุงุช ูุงุจูุฉ ููุงุณุชูุฑุงุฏ.');
        return;
      }

      const ok = confirm('ุณูุชู ุงุณุชุจุฏุงู ุจูุงูุงุช ุงูุฃุฏุงุฉ ุงูุญุงููุฉ ุจุงููุงูู ุจุจูุงูุงุช ุงูููู ุงููุณุชูุฑุฏ. ูู ุชุฑูุฏ ุงููุชุงุจุนุฉุ');
      if(!ok) return;

      hardResetPFKeys();

      for(const [k,v] of Object.entries(payload.data)){
        if(k && k.startsWith('PF_')){
          localStorage.setItem(k, (v===null || v===undefined) ? '' : String(v));
        }
      }

      refreshUIAfterImport();
    }catch(err){
      alert('ุชุนุฐุฑ ุงุณุชูุฑุงุฏ ุงูููู. ุชุฃูุฏ ุฃูู ููู JSON ุตุญูุญ.\n' + err.message);
    }
  };
  reader.readAsText(file, 'utf-8');
}

/* ุฑุจุท ุฃุฒุฑุงุฑ ุงูุชุตุฏูุฑ/ุงูุงุณุชูุฑุงุฏ ุฏุงุฎู ุนุฏุณุฉ ุงูุฃุณูุงุก */
const exportBtn = $('#exportAllData');
const importBtn = $('#importAllDataBtn');
const importInp = $('#importAllInput');

if(exportBtn) exportBtn.onclick = exportAllPF;
if(importBtn && importInp){
  importBtn.onclick = ()=> importInp.click();
  importInp.addEventListener('change', e=>{
    const f = e.target.files?.[0];
    if(f) importAllPF(f);
    importInp.value = '';
  });
}
/* ุฃุญุฏุงุซ ุนุฏุณุฉ ุงูุฃุณูุงุก */
function openLens(){ toggleLens(true); }
function toggleLens(show){ const m=$('#lens'); m.classList.toggle('show',!!show); m.setAttribute('aria-hidden', show?'false':'true'); }
$('#lensMini').onclick=openLens;
$('#closeLens').onclick=()=>toggleLens(false);
$('#pickFileBtn').onclick=()=>$('#fileInput').click();
$('#fileInput').addEventListener('change',e=>{
  const f=e.target.files?.[0]; if(f) parseFile(f);
});
/* โ ุชูุนูู ุงูุณุญุจ ูุงูุฅููุงุช ูููุทูุฉ #dropZone */
const dz = $('#dropZone');
if(dz){
  ['dragenter','dragover'].forEach(ev=>{
    dz.addEventListener(ev, (e)=>{
      e.preventDefault();
      e.stopPropagation();
      dz.classList.add('hover');
    });
  });

  ['dragleave','drop'].forEach(ev=>{
    dz.addEventListener(ev, (e)=>{
      e.preventDefault();
      e.stopPropagation();
      dz.classList.remove('hover');
    });
  });

  dz.addEventListener('drop', (e)=>{
    const f = e.dataTransfer?.files?.[0];
    if(f) parseFile(f);
  });
}

$('#searchBox').addEventListener('input',e=>renderPeople(e.target.value));
$('#peopleTbl').addEventListener('click',e=>{
  const btn=e.target.closest('button.row-btn'); if(!btn) return;
  const i=+btn.dataset.i;
  const q=norm($('#searchBox').value);
  const rows = PEOPLE.filter(p=>{
    if(!q) return true;
    return norm(p.name).includes(q) || norm(p.id).includes(q) || norm(p.spec).includes(q) || norm(p.title).includes(q);
  });
  const p=rows[i]; if(!p) return;

  $('#tName').value=p.name||''; $('#tId').value=p.id||''; $('#tSpec').value=p.spec||''; $('#tTitle').value=p.title||'ูุนูู ููุงุฑุณ';

  const db=dbGet();
  const key=makeKey($('#schTxt').textContent.trim(), $('#model').value, $('#stage').value, (p.id||p.name||''));
  const rec = db.find(x=>x._key===key);
  if(rec){ loadRecordIntoForm(rec); }
  else { recalc(); snap(); }

  toggleLens(false);
});

/* ูุณุญ ุงูุฃุณูุงุก */
$('#clearPeople').onclick=()=>{ if(confirm('ูุณุญ ูุงุฆูุฉ ุงูุฃุณูุงุก ุงููุญููุธุฉุ')){ PEOPLE=[]; savePeople(); renderPeople(); } };

/* ุฑุจุท ุฒุฑ ุชุญููู ุงููุงูุจ */
const tplBtn = $('#downloadTemplate');
if(tplBtn){ tplBtn.onclick = downloadPeopleTemplate; }

/* ุฃุญุฏุงุซ ุนุงูุฉ */
document.addEventListener('change',e=>{
  if(e.target.classList.contains('g')){recalc();snap();}
if(e.target.id==='model'){
  // โ ููุน ุชุฑุญูู ูุตูุต ุงูููุฉ/ุงูุชุญุณูู ูู ูููุฐุฌ ุณุงุจู
  editedStrengths=false; 
  editedImproves=false;
  $('#strengths').textContent='โ';
  $('#improves').textContent='โ';

  build();
  renderPeople($('#searchBox').value||'');
}
  if(e.target.id==='stage'){
    toggleStageLock();
    $('#stageTxt').textContent = stageHeaderLabel($('#stage').value);
    if(e.target.value==='first'){autoFillGoals();}
    snap();
    renderPeople($('#searchBox').value||'');
  }
  if(['g1','g1i','g1t','g2','g2i','g2t','g3','g3i','g3t'].includes(e.target.id)){ renderGoalsPrint(); snap(); }
});

/* ุญูุธ + ุฅุจุฑุงุฒ + Toast */
function showToast(msg){
  const t=$('#toast'); t.textContent=msg||'ุชู ุงูุญูุธ';
  t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 1400);
}
$('#saveBtn').onclick=()=>{
  const data=snap(); upsertRecord(data);
  renderPeople($('#searchBox').value||'');
  showToast('ุชู ุงูุญูุธ ูุฅุจุฑุงุฒ ุงูุงุณู ูู ุงูุนุฏุณุฉ โ');
};

/* ุชูุนูู ุฃุฒุฑุงุฑ ุงูุตูุญุงุช ุงููุฑุชุจุทุฉ */
$('#gapBtn').onclick=openGap;
$('#archBtn').onclick=openArch;
$('#dlelBtn').onclick=openDlel;

/* ุทุจุงุนุฉ */
function smartPrint(){
  const g = document.querySelector('.grid4');
  g.style.gridTemplateColumns='2fr 1fr 1fr 1fr';
  snap();
  window.print();
}
$('#printBtn').onclick=smartPrint;

/* ุงูุดุฑุญ */
function toggleHelp(show){ const m=$('#help'); m.classList.toggle('show',!!show); m.setAttribute('aria-hidden', show?'false':'true'); }
$('#helpFab').onclick=()=>toggleHelp(true);
$('#closeHelp').onclick=()=>toggleHelp(false);
$('#help').addEventListener('click',e=>{ if(e.target.id==='help') toggleHelp(false); });
document.addEventListener('keydown',e=>{
  if(e.key==='Escape'){
    toggleHelp(false);
    toggleLens(false);
    closeFloatVideo();
  }
});

/* ุฒุฑ "ูุณุญ" ูููููุฐุฌ */
$('#clearBtn').onclick=()=>{
  editedStrengths=false; editedImproves=false;
  $$('.g').forEach(s=>s.value='3');
  ['tName','tId','tSpec','tTitle','g1','g1i','g1t','g2','g2i','g2t','g3','g3i','g3t']
    .forEach(id=>document.getElementById(id).value='');
  $('#tTitle').value='ูุนูู ููุงุฑุณ';
  $('#strengths').textContent='โ';
  $('#improves').textContent='โ';
  renderGoalsPrint(); recalc(); snap();
};

/* ุจุฏุก */
(function init(){
  $('#stage').value='first';
  if(!$('#tTitle').value) $('#tTitle').value='ูุนูู ููุงุฑุณ';
  $('#stageTxt').textContent = stageHeaderLabel($('#stage').value);
  build(); recalc(); renderGoalsPrint(); snap();
  loadPeople();
  updateGoalsToggleLabel();
})();
</script>
</body>
</html>
