<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<title>Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ â€“ Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ÙŠØ¹Ù‚ÙˆØ¨ÙŠ</title>

<!-- Ø®Ø·ÙˆØ· Ø§Ù„Ù‡ÙˆÙŠØ© -->
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&family=Cairo:wght@600;700&display=swap" rel="stylesheet">

<!-- Ù…ÙƒØªØ¨Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ© -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
:root{
  --moe-dark:#0c594e;          /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø±Ø³Ù…ÙŠ */
  --moe-light:#1e8a79;
  --ink:#0b2f2b;
  --bg:#ffffff;
  --border:#e0ece8;
  --muted:#667c76;
  --chip:#f4fbf9;
  --shadow:0 4px 16px rgba(0,0,0,.10);
}
*{box-sizing:border-box;scroll-behavior:smooth}
html,body{
  margin:0; padding:0; background:var(--bg);
  font-family:"Tajawal","Cairo",system-ui; color:var(--ink); line-height:1.6; font-size:15px;
}
#page{
  width:min(1120px,100%); margin:0 auto; padding:10px 12px 60px; background:#fff;
}

/* Ø§Ù„Ø±Ø£Ø³ */
.header-grid{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;text-align:center;margin-bottom:8px}
.h-left,.h-right{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:2px}
.h-left .line,.h-right .line{font-weight:700;color:var(--moe-dark)}
/* Ø§Ù„ÙŠÙˆÙ…/Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ³Ø· ÙÙˆÙ‚ Ø¨Ø¹Ø¶ */
.h-right{align-items:center;padding-inline-start:0;transform:none}
#moeLogo{width:min(220px,40vw);height:auto;object-fit:contain;filter:drop-shadow(0 2px 6px rgba(0,0,0,.15))}

/* Ø£Ø²Ø±Ø§Ø± ØµØºÙŠØ±Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ */
.edit-icon{font-size:12px;border:1px solid var(--border);background:#fff;padding:1px 6px;border-radius:8px;cursor:pointer;margin-inline-start:4px}

/* ØµÙ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙˆÙŠ */
.toolbar{
  display:grid; grid-template-columns:1fr 1fr repeat(8,auto);
  gap:8px; align-items:center; margin:10px 0;
}
.select-compact{
  appearance:none;width:100%;height:34px; padding:0 30px 0 10px;
  border:1px solid var(--border);border-radius:999px;background:#fff;
  font-weight:800;color:#0c3f39;cursor:pointer;font-size:13px
}
.toolbar .ico{position:absolute;inset-inline-end:10px;top:50%;transform:translateY(-50%);pointer-events:none}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.pill{
  border:1px solid var(--border);border-radius:12px;padding:8px 12px;
  font-weight:800;background:linear-gradient(180deg,#ffffff,#f7fffd);
  cursor:pointer;color:var(--moe-dark);transition:all .2s;font-size:13px;white-space:nowrap
}
.pill:hover{background:linear-gradient(180deg,#f9fefc,#e8f7f3)}
.pill.primary{background:linear-gradient(180deg,var(--moe-light),var(--moe-dark));color:#fff;border-color:var(--moe-dark)}
.pill.primary:hover{opacity:.92}
.pill[disabled]{opacity:.5;pointer-events:none}

/* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
.table{width:100%;border-collapse:collapse;border:1px solid var(--border);border-radius:12px;overflow:hidden}
.table th,.table td{border:1px solid var(--border);padding:8px}
.table th{background:var(--moe-light);color:#fff}
.table td{text-align:center}

/* Ø¹Ù…ÙˆØ¯ Ø³Ù„Ù… Ø§Ù„ØªÙ‚Ø¯ÙŠØ± â€“ Ø¯ÙˆÙ† Ø­Ø¯ÙˆØ¯ ÙˆØ¨Ø´ÙØ§ÙÙŠØ© Ù…ÙˆØ­Ø¯Ø© */
.select-mini{
  appearance:none;background:#fff;border:none;
  border-radius:10px;padding:4px 8px;font-weight:900;color:#0b3430;outline:none;opacity:.65;
}
.select-mini:disabled{opacity:.35}
.select-mini:focus{outline:2px solid #bfe8df;}

/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ØµÙ Ø­Ø³Ø¨ Ø§Ù„Ø³Ù„Ù… */
tr.rate-1{background:linear-gradient(90deg,#fee2e2 0,#fff 60%)}
tr.rate-2{background:linear-gradient(90deg,#fde68a 0,#fff 60%)}
tr.rate-3{background:linear-gradient(90deg,#f0fdf4 0,#fff 60%)}
tr.rate-4{background:linear-gradient(90deg,#dcfce7 0,#fff 60%)}
tr.rate-5{background:linear-gradient(90deg,#bbf7d0 0,#fff 60%)}

/* Ù…Ø¤Ø´Ø± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² */
.kpi-wrap{position:relative;margin:12px 0}
.kpi-bar{position:relative;height:16px;border-radius:999px;overflow:hidden;border:1px solid #e9f4f1}
.kpi-fill{position:absolute;inset:0;width:0%;background:linear-gradient(90deg,#f87171,#fbbf24,#34d399,#10b981);opacity:.95;transition:width .5s}
.kpi-waves{position:absolute;left:0;bottom:0;height:42px;width:200%;background:radial-gradient(circle at 25% 120%, rgba(255,255,255,.6) 24%, transparent 26%) repeat-x;background-size:40px 40px;animation:waves 3s linear infinite;opacity:.45}
.kpi-label{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);padding:2px 4px}
@keyframes waves{from{transform:translateX(0)}to{transform:translateX(-50%)}}

/* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;z-index:100;padding:10px}
.panel{width:min(900px,95%);max-height:95vh;background:#fff;border-radius:16px;box-shadow:var(--shadow);display:flex;flex-direction:column}
.panel .head{background:var(--moe-dark);color:#fff;font-weight:800;padding:10px 14px;border-top-left-radius:16px;border-top-right-radius:16px;display:flex;justify-content:space-between;align-items:center}
.panel .body{overflow-y:auto;padding:16px;color:var(--ink)}

/* Ø­Ù‚ÙˆÙ„ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
.data-row{display:grid;grid-template-columns:2fr repeat(3,1fr);gap:8px;margin:10px 0}
.lined{height:42px;border:1px solid var(--border);border-radius:12px;padding:0 10px;width:100%}

/* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù (Ø§Ù„ØªØ®Ø·ÙŠØ· ÙÙ‚Ø·) */
#goalsWrap{margin:8px 0;display:none}
#goalsWrap .title{font-weight:800;color:#0c594e;margin-bottom:6px}
.goal-cell{min-width:120px;text-align:right}
.goal-input{width:100%;border:1px solid var(--border);border-radius:10px;padding:6px 8px}

/* ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù‚ÙˆØ©/Ø§Ù„ØªØ­Ø³ÙŠÙ† â€” Ù†Øµ ÙˆØ§Ø¶Ø­ Ù…Ù†Ø³Ù‚ */
.box{
  border:1px solid var(--border);background:#fff;border-radius:12px;padding:10px;
}
.box h3{margin:0 0 6px;color:#0c594e}
.box p{white-space:pre-wrap;word-break:break-word;line-height:1.8;margin:0}

/* Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
@media print{
  .no-print,.modal,.toolbar{display:none!important}
  body{background:#fff}
  #page{margin:0 auto;padding:0}
  @page{size:A4;margin:12mm}
}

/* Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„ØªØ°ÙŠÙŠÙ„ */
.footer-note{color:#6a7f7b;font-size:12px;text-align:center;margin-top:10px}
@media print{.footer-note{display:none}}
</style>
</head>
<body>
<div id="page">

  <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
  <header class="header-grid">
    <div class="h-left">
      <div class="line">Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</div>
      <div class="line">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</div>
      <div class="line">
        <span id="dirText">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</span>
        <button id="editDir" class="edit-icon no-print" title="ØªØ¹Ø¯ÙŠÙ„" type="button">âœ</button>
      </div>
      <div class="line">
        <span id="schoolText">Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ÙŠØ¹Ù‚ÙˆØ¨ÙŠ</span>
        <button id="editSchool" class="edit-icon no-print" title="ØªØ¹Ø¯ÙŠÙ„" type="button">âœ</button>
      </div>
    </div>

    <div class="h-center">
      <img id="moeLogo" alt="Ø´Ø¹Ø§Ø± ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…" src="ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ….png"
        onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,'+encodeURIComponent(`<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'220\' height=\'90\'><rect fill=\'white\' width=\'100%\' height=\'100%\'/><text x=\'50%\' y=\'55%\' dominant-baseline=\'middle\' text-anchor=\'middle\' font-family=\'Tajawal\' font-weight=\'800\' font-size=\'20\' fill=\'#1e8a79\'>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</text></svg>`)"/>
    </div>

    <div class="h-right">
      <div id="todayTxt" class="line" style="font-weight:800;color:#16544c"></div>
      <div id="dateTxt"  class="line" style="font-weight:700;color:#466e69"></div>
      <div id="modelTxt" class="line" style="font-weight:800;color:#16544c"></div>
    </div>
  </header>

  <!-- Ø´Ø±ÙŠØ· Ø£Ø¯ÙˆØ§Øª Ø¹Ù„ÙˆÙŠ -->
  <section class="toolbar no-print">
    <div style="position:relative">
      <select id="modelSelect" class="select-compact">
        <option value="teacher">Ù…Ø¹Ù„Ù…</option>
        <option value="vp">ÙˆÙƒÙŠÙ„</option>
        <option value="principal">Ù…Ø¯ÙŠØ±</option>
        <option value="activity">Ø±Ø§Ø¦Ø¯ Ù†Ø´Ø§Ø·</option>
        <option value="health">Ù…ÙˆØ¬Ù‡ ØµØ­ÙŠ</option>
        <option value="counselor">Ù…ÙˆØ¬Ù‡ Ø·Ù„Ø§Ø¨ÙŠ</option>
        <option value="lab">Ù…Ø­Ø¶Ø± Ù…Ø®ØªØ¨Ø±</option>
        <option value="kg">Ù…Ø¹Ù„Ù…Ø© Ø±ÙŠØ§Ø¶ Ø£Ø·ÙØ§Ù„</option>
      </select>
      <span class="ico">â–¾</span>
    </div>
    <div style="position:relative">
      <select id="stageSelect" class="select-compact">
        <option value="planning">Ø§Ù„ØªØ®Ø·ÙŠØ·</option>
        <option value="mid">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†ØµÙ Ø³Ù†ÙˆÙŠØ©</option>
        <option value="final">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</option>
      </select>
      <span class="ico">â–¾</span>
    </div>

    <button id="btnGapPlan" class="pill primary" type="button">Ø®Ø·Ø© ØªØ­Ø³ÙŠÙ† ÙØ¬ÙˆØ© Ø§Ù„Ø£Ø¯Ø§Ø¡</button>
    <button id="openHelp" class="pill" type="button">â„¹ï¸ Ø§Ù„Ø´Ø±Ø­</button>
    <button id="openRubrics" class="pill" type="button">ğŸ“‘ Ø§Ù„Ø£Ø¯Ù„Ù‘Ø©</button>
    <button id="btnPrint" class="pill" type="button">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
    <button id="btnPdf" class="pill" type="button">ğŸ§¾ PDF</button>
    <button id="btnSave" class="pill" type="button">ğŸ’¾ Ø­ÙØ¸</button>
    <button id="btnClear" class="pill" type="button">ğŸ§¹ Ù…Ø³Ø­</button>
    <button id="btnWhatsApp" class="pill" type="button">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</button>
  </section>

  <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù -->
  <section class="data-row no-print">
    <div style="position:relative">
      <input id="tName" class="lined" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…">
      <span class="in-icon" id="openMini" style="position:absolute;inset-inline-start:10px;top:50%;transform:translateY(-50%);font-weight:900;color:#0b534b;cursor:pointer">ğŸ”</span>
    </div>
    <input id="tId"   class="lined" inputmode="numeric" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©">
    <input id="tSpec" class="lined" placeholder="Ø§Ù„ØªØ®ØµØµ">
    <input id="tRank" class="lined" placeholder="Ø§Ù„Ù…Ø±ØªØ¨Ø©/Ø§Ù„Ø±ØªØ¨Ø©">
  </section>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù (Ø§Ù„ØªØ®Ø·ÙŠØ· ÙÙ‚Ø·) -->
  <section id="goalsWrap">
    <div class="title">Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø±Ø­Ù„Ø© (ØªØ¸Ù‡Ø± ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ®Ø·ÙŠØ·)</div>
    <table class="table" id="goalsTable">
      <thead>
        <tr>
          <th>Ø§Ù„Ù‡Ø¯Ù</th>
          <th>Ø§Ù„Ù…Ø¤Ø´Ø±</th>
          <th>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</th>
        </tr>
      </thead>
      <tbody id="goalsBody"></tbody>
    </table>
  </section>

  <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² + Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ù„Ù… -->
  <div class="kpi-wrap">
    <div class="kpi-bar">
      <div class="kpi-fill" id="kpiFill"></div>
      <div class="kpi-waves" id="kpiWaves"></div>
    </div>
    <div class="kpi-label">
      <div id="kpiLabelL">Ù…Ø¤Ø´Ø± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²: 0%</div>
      <div id="kpiLabelM">Ø³ÙÙ„Ù‘Ù… Ø§Ù„ØªÙ‚Ø¯ÙŠØ± (Ù…ØªÙˆØ³Ø·): 0.00 / 5</div>
      <div id="kpiLabelR">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£ÙˆØ²Ø§Ù†: 0%</div>
    </div>
  </div>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… -->
  <section id="rubric">
    <table class="table">
      <thead>
        <tr>
          <th class="items" style="text-align:right">Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
          <th class="weight">Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù†Ø³Ø¨ÙŠ</th>
          <th class="scale">Ø³ÙÙ„Ù‘Ù… Ø§Ù„ØªÙ‚Ø¯ÙŠØ± (1â€“5)</th>
          <th class="result">Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ù…ÙˆØ²ÙˆÙ†</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
      <tfoot>
        <tr>
          <th style="text-align:right">Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ø£Ø¯Ø§Ø¡ (Ù…Ù† 5)</th>
          <th id="sumWeight">0%</th>
          <th id="avgOutOf5" style="font-weight:900;color:#ffffff">0.00</th>
          <th id="sumScore">0.00</th>
        </tr>
      </tfoot>
    </table>
  </section>

  <!-- Ø§Ù„Ù‚ÙˆØ© / Ø§Ù„ØªØ­Ø³ÙŠÙ† -->
  <section style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:12px 0">
    <div class="box">
      <h3>Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</h3>
      <p id="strengthsBox">â€”</p>
    </div>
    <div class="box">
      <h3>Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ† ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±</h3>
      <p id="improveBox">â€”</p>
    </div>
  </section>

  <!-- Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ -->
  <section class="sign-section" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:14px 0">
    <div style="text-align:center">
      <div id="signTeacherName" style="font-weight:800;color:#0c594e;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">â€”</div>
      <div style="border-top:1px dashed #bcd3cd;margin-top:6px;width:80%;margin-inline:auto"></div>
      <div style="font-size:12px;color:#667">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù…</div>
    </div>
    <div style="text-align:center">
      <div id="signPrincipalName" style="font-weight:800;color:#0c594e;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</div>
      <div style="border-top:1px dashed #bcd3cd;margin-top:6px;width:80%;margin-inline:auto"></div>
      <div style="font-size:12px;color:#667">ØªÙˆÙ‚ÙŠØ¹ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</div>
    </div>
  </section>

  <!-- Ø¹Ø¯Ø³Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ -->
  <div class="mini modal" id="mini">
    <div class="panel" style="width:min(900px,96%)">
      <div class="head">
        <div>Ø¹Ø¯Ø³Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø°ÙƒÙŠØ©</div>
        <button id="miniClose" class="pill" style="background:#fff;color:#0c594e;border-color:#fff" type="button">âœ– Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div class="body">
        <div class="row" style="display:grid;grid-template-columns:1fr auto;gap:8px">
          <input id="qName" class="lined" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù…">
          <div style="display:flex;gap:8px;align-items:center">
            <input type="file" id="xlsInput" accept=".xlsx,.xls,.csv" style="display:none"/>
            <button id="btnPickFile" class="pill" type="button">â¬†ï¸ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù</button>
            <button id="btnTpl" class="pill" type="button">â¬‡ï¸ Ù‚Ø§Ù„Ø¨ Excel</button>
          </div>
        </div>
        <div id="nameStats" style="margin-top:6px;color:#667"></div>
        <div id="nameList" style="max-height:320px;overflow:auto;border:1px solid var(--border);border-radius:12px;padding:8px;margin-top:8px"></div>
      </div>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø±Ø­ -->
  <div class="modal" id="helpModal">
    <div class="panel" id="helpPanel" style="width:min(900px,96%)">
      <div class="head">
        <div>ğŸ”¹ Ø§Ù„Ø´Ø±Ø­</div>
        <button data-close="#helpModal" class="pill" style="background:#fff;color:#0c594e;border-color:#fff" type="button">âœ– Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div class="body" style="font-size:14px">
        <p><strong>Ø£Ø¯Ø§Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ØªØ±Ø¨ÙˆÙŠØ© Ù„ØªØ¹Ø¨Ø¦Ø© ÙˆØªÙˆØ«ÙŠÙ‚ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ù¡Ù¤Ù¤Ù§Ù‡Ù€ Ù„Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆÙÙ‚ Ø¯Ù„ÙŠÙ„ ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ….</strong></p>
        <ul>
          <li>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆØ± Ø§Ù„ÙˆØ¸ÙŠÙÙŠ ÙˆÙ…Ø±Ø­Ù„Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ….</li>
          <li>ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙˆØªÙ‚Ø¯ÙŠØ±Ù‡Ø§ Ø¨Ø¯Ø±Ø¬Ø§Øª (1â€“5) ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.</li>
          <li>Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ·Ø¨Ø§Ø¹Ø©/Ø­ÙØ¸ Ø®Ø·Ø© ØªØ­Ø³ÙŠÙ† ÙØ¬ÙˆØ© Ø§Ù„Ø£Ø¯Ø§Ø¡.</li>
          <li>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ù…Ù† Ù…Ù„Ù Excel Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</li>
        </ul>
        <p style="color:#a33"><strong>ØªÙ†Ø¨ÙŠÙ‡:</strong> Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ø®Ù„ÙŠ ÙˆÙ„Ø§ ÙŠØºÙ†ÙŠ Ø¹Ù† Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø±Ø³Ù…ÙŠØ© ÙÙŠ ÙØ§Ø±Ø³/Ù†ÙˆØ±.</p>
      </div>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£Ø¯Ù„Ø© -->
  <div class="modal" id="reportsModal">
    <div class="panel" id="reportsPanel" style="width:min(900px,96%)">
      <div class="head">
        <div>ğŸ“— Ø§Ù„Ø£Ø¯Ù„Ù‘Ø© â€” Ù…Ø®ØªØµØ± Ù¡Ù¤Ù¤Ù§Ù‡Ù€</div>
        <button data-close="#reportsModal" class="pill" style="background:#fff;color:#0c594e;border-color:#fff" type="button">âœ– Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div class="body" style="font-size:14px">
        <ol>
          <li><strong>Ø§Ù„Ù…Ø±Ø§Ø­Ù„:</strong> Ø§Ù„ØªØ®Ø·ÙŠØ· â”‚ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†ØµÙ Ø³Ù†ÙˆÙŠØ© â”‚ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.</li>
          <li><strong>Ø§Ù„Ø³ÙÙ„Ù‘Ù…:</strong> 5 ÙŠØªØ¬Ø§ÙˆØ² â”‚ 4 Ù…ØªÙ…ÙŠØ² â”‚ 3 ÙŠÙˆØ§ÙÙ‚ â”‚ 2 ÙŠØ­ØªØ§Ø¬ ØªØ·ÙˆÙŠØ± â”‚ 1 ØºÙŠØ± Ù…Ø±Ø¶Ù.</li>
          <li><strong>Ø®Ø·Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ†:</strong> ØªÙØ¨Ù†Ù‰ Ø¹Ù„Ù‰ Ø§Ù„ÙØ¬ÙˆØ§Øª ÙˆØªÙØªØ§Ø¨Ø¹ Ø¨Ù…Ø¤Ø´Ø±Ø§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù‚ÙŠØ§Ø³.</li>
        </ol>
      </div>
    </div>
  </div>

  <!-- Ø®Ø·Ø© ÙØ¬ÙˆØ© Ø§Ù„Ø£Ø¯Ø§Ø¡ -->
  <div class="modal" id="gapModal">
    <div class="panel" id="gapPanel" style="width:min(900px,96%);background:#fff">
      <div class="head">
        <div>Ø®Ø·Ø© ØªØ­Ø³ÙŠÙ† ÙØ¬ÙˆØ© Ø§Ù„Ø£Ø¯Ø§Ø¡</div>
        <div style="display:flex;gap:8px">
          <button id="gapPdf" class="pill" style="background:#fff;color:#0c594e;border-color:#fff" type="button">ğŸ§¾ Ø­ÙØ¸ PDF</button>
          <button id="gapClose" class="pill" style="background:#fff;color:#0c594e;border-color:#fff" type="button">âœ– Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
      <div class="body" id="gapBody">
        <div class="header-grid" style="margin-bottom:8px">
          <div class="h-left">
            <div class="line">Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</div>
            <div class="line">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</div>
            <div class="line"><span id="g_dirHeader">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</span></div>
            <div class="line"><span id="g_schoolHeader">Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ÙŠØ¹Ù‚ÙˆØ¨ÙŠ</span></div>
          </div>
          <div class="h-center">
            <img id="g_moeLogo" alt="Ø´Ø¹Ø§Ø± ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…" src="ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ….png"
              onerror="this.onerror=null;this.src=document.getElementById('moeLogo').src" style="width:min(220px,40vw);height:auto;object-fit:contain"/>
          </div>
          <div class="h-right">
            <div id="g_today" style="font-weight:800;color:#16544c"></div>
            <div id="g_date"  style="font-weight:700;color:#466e69"></div>
            <div id="g_model" style="font-weight:800;color:#16544c"></div>
          </div>
        </div>

        <section style="border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-bottom:10px">
          <table class="table" style="border-radius:0;margin:0;text-align:center">
            <thead><tr><th colspan="4">Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ø´Ø§ØºÙ„ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</th></tr></thead>
            <tbody>
              <tr><td>Ø§Ù„Ø§Ø³Ù…</td><td id="g_name">â€”</td><td>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</td><td id="g_dir">â€”</td></tr>
              <tr><td>Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</td><td id="g_title">â€”</td><td>Ø§Ù„ØªØ®ØµØµ</td><td id="g_spec">â€”</td></tr>
              <tr><td>Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</td><td id="g_mgr">ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</td><td>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</td><td id="g_stage">â€”</td></tr>
              <tr><td>Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…Ù„</td><td id="g_school">â€”</td><td>Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</td><td id="g_year">â€”</td></tr>
            </tbody>
          </table>
        </section>

        <section style="border:1px solid var(--border);border-radius:12px;padding:10px;margin-top:6px">
          <h3 style="margin:0 0 8px">Ø£- ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØ¬ÙˆØ©</h3>
          <table class="table" style="border-radius:10px;margin:0">
            <thead>
              <tr><th style="width:50%">Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù ØªØ·ÙˆÙŠØ±Ù‡</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>
            </thead>
            <tbody id="g_targets"></tbody>
          </table>
        </section>

        <section style="border:1px solid var(--border);border-radius:12px;padding:10px;margin-top:8px">
          <h3 style="margin:0 0 8px">Ø¨- ØªØ­Ù„ÙŠÙ„ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
          <table class="table" style="border-radius:10px;margin:0">
            <thead><tr><th>Ø¯Ø±Ø¬Ø© Ø§Ù„ØªÙ…ÙƒÙ†</th><th>Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨</th><th>Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</th><th>Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„ØªÙŠ Ø¨Ø­Ø§Ø¬Ø© Ù„Ù„ØªØ­Ø³ÙŠÙ†</th></tr></thead>
            <tbody><tr><td id="g_grade" style="font-weight:900"></td><td contenteditable="true" id="g_reasons"></td><td id="g_strengths"></td><td id="g_gaps"></td></tr></tbody>
          </table>
        </section>

        <section style="border:1px solid var(--border);border-radius:12px;padding:10px;margin-top:8px">
          <h3 style="margin:0 0 8px">Ø¬- Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„ Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ØªØ­Ø³ÙŠÙ†</h3>
          <table class="table" style="border-radius:10px;margin:0">
            <thead><tr><th>Ù…</th><th>Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¦ÙŠØ©</th><th>Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙ†ÙÙŠØ°</th><th>Ø²Ù…Ù† Ø§Ù„ØªÙ†ÙÙŠØ°</th><th>Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª</th><th>Ø§Ù„Ù…ÙƒÙ„Ù</th><th>Ø§Ù„Ù…Ø³Ø§Ù†Ø¯</th><th>Ù…Ø¤Ø´Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡</th></tr></thead>
            <tbody id="g_actions"></tbody>
          </table>
          <div style="margin-top:6px;font-size:12px;color:#5a7a74">Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ­Ø±ÙŠØ± Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.</div>
        </section>

        <section style="margin-top:10px">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:center">
            <div style="text-align:center;white-space:nowrap"><span id="g_signTeacher">â€”</span><div style="border-top:1px dashed #bcd3cd;margin-top:6px;width:80%;margin-inline:auto"></div></div>
            <div style="text-align:center;white-space:nowrap"><span id="g_signPrincipal">ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</span><div style="border-top:1px dashed #bcd3cd;margin-top:6px;width:80%;margin-inline:auto"></div></div>
          </div>
          <div style="text-align:center;margin-top:6px;font-size:12px;color:#667" id="g_footerDate">â€”</div>
        </section>
      </div>
    </div>
  </div>

  <!-- Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
  <div class="footer-note no-print">ØªÙ†ÙÙŠØ° ÙˆØªØµÙ…ÙŠÙ…: ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</div>

</div><!-- /page -->

<script>
/* Ø£Ø¯ÙˆØ§Øª Ù…Ø®ØªØµØ±Ø© */
const $=s=>document.querySelector(s), $$=s=>[...document.querySelectorAll(s)];

/* Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ */
const TITLE_BY_MODEL={ teacher:'Ù…Ø¹Ù„Ù…', activity:'Ø±Ø§Ø¦Ø¯ Ù†Ø´Ø§Ø·', health:'Ù…ÙˆØ¬Ù‡ ØµØ­ÙŠ', kg:'Ù…Ø¹Ù„Ù…Ø© Ø±ÙŠØ§Ø¶ Ø£Ø·ÙØ§Ù„', lab:'Ù…Ø­Ø¶Ø± Ù…Ø®ØªØ¨Ø±', counselor:'Ù…ÙˆØ¬Ù‡ Ø·Ù„Ø§Ø¨ÙŠ', vp:'ÙˆÙƒÙŠÙ„', principal:'Ù…Ø¯ÙŠØ±' };

/* Ø¨Ù†Ùƒ Ø£Ù‡Ø¯Ø§Ù Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„ÙƒÙ„ Ø¯ÙˆØ± (4 Ø£Ø³Ø·Ø± ØªÙÙ…Ù„Ø£ Ø¹Ù†Ø¯ Ø§Ù„ØªØ®Ø·ÙŠØ·) */
const GOALS = {
  teacher:[
    {g:"Ø±ÙØ¹ Ù…ØªÙˆØ³Ø· Ù†ÙˆØ§ØªØ¬ Ø§Ù„ØªØ¹Ù„Ù…", kpi:"Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­Ø³Ù† ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ù‚ØµÙŠØ±", target:"â‰¥ 15%"},
    {g:"ØªÙ†ÙˆÙŠØ¹ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØµÙÙŠØ©", kpi:"Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…ÙØ¹Ù‘Ù„Ø© Ø¨Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ù†Ø´Ø·Ø©/Ø£Ø³Ø¨ÙˆØ¹", target:"â‰¥ 3"},
    {g:"ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„ØµÙÙŠ", kpi:"Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø®Ø·Ø© Ø§Ù„ØµÙÙŠØ©", target:"â‰¥ 90%"},
    {g:"ØªØ¹Ø²ÙŠØ² Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ù…Ù† Ø£Ø¬Ù„ Ø§Ù„ØªØ¹Ù„Ù…", kpi:"Ù†Ù…Ø§Ø°Ø¬ ØªÙ‚ÙˆÙŠÙ… Ø¨Ù†Ø§Ø¦ÙŠ Ù…ÙˆØ«Ù‚Ø©/Ø´Ù‡Ø±", target:"â‰¥ 4"}
  ],
  vp:[
    {g:"Ø±ÙØ¹ Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ", kpi:"Ù†Ø³Ø¨Ø© Ø­Ø¶ÙˆØ± Ø§Ù„Ø·Ù„Ø§Ø¨", target:"â‰¥ 95%"},
    {g:"ØªÙØ¹ÙŠÙ„ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª", kpi:"ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø¤Ø´Ø±Ø§Øª Ø´Ù‡Ø±ÙŠØ©", target:"12"},
    {g:"ØªØ­Ø³ÙŠÙ† ØªÙ†ÙÙŠØ° Ø§Ù„Ø®Ø·Ø·", kpi:"Ù†Ø³Ø¨Ø© Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø®Ø·Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©", target:"â‰¥ 90%"},
    {g:"ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø´Ø±Ø§ÙƒØ©", kpi:"Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ù†ÙˆØ¹ÙŠØ© Ù…Ù†Ø¬Ø²Ø©/ÙØµÙ„", target:"â‰¥ 4"}
  ],
  principal:[
    {g:"ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„", kpi:"Ù…Ø¤Ø´Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø´Ø§Ù…Ù„", target:"â‰¥ 85%"},
    {g:"Ø±ÙØ¹ Ù†ÙˆØ§ØªØ¬ Ø§Ù„ØªØ¹Ù„Ù…", kpi:"ØªØ­Ø³Ù† Ù…ØªÙˆØ³Ø· Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©", target:"â‰¥ 10%"},
    {g:"ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ù†ÙŠ", kpi:"Ø¨Ø±Ø§Ù…Ø¬ Ù†ÙˆØ¹ÙŠØ© Ù…Ù†ÙØ°Ø©/ÙØµÙ„", target:"â‰¥ 3"},
    {g:"ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø³Ù„Ø§Ù…Ø©", kpi:"Ù†Ø³Ø¨Ø© Ø§Ø³ØªÙŠÙØ§Ø¡ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©", target:"100%"}
  ],
  activity:[
    {g:"Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø©", kpi:"Ù†Ø³Ø¨Ø© Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø·Ù„Ø§Ø¨", target:"â‰¥ 60%"},
    {g:"Ù†ÙˆØ¹ÙŠØ© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬", kpi:"Ø¨Ø±Ø§Ù…Ø¬ Ù†ÙˆØ¹ÙŠØ©/ÙØµÙ„", target:"â‰¥ 4"},
    {g:"ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯", kpi:"ØªÙ‚Ø§Ø±ÙŠØ±/ØµÙˆØ± Ù…Ø¹ØªÙ…Ø¯Ø©/Ø¨Ø±Ù†Ø§Ù…Ø¬", target:"100%"},
    {g:"Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª", kpi:"Ø£Ù†Ø´Ø·Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ù…Ø­ØªÙˆÙ‰/ÙØµÙ„", target:"â‰¥ 3"}
  ],
  health:[
    {g:"ØªØ¹Ø²ÙŠØ² Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„ØµØ­ÙŠ", kpi:"Ø¨Ø±Ø§Ù…Ø¬ ØªÙˆØ¹ÙˆÙŠØ© Ù…Ù†ÙØ°Ø©/ÙØµÙ„", target:"â‰¥ 3"},
    {g:"Ø­ØµØ± Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØµØ­ÙŠØ©", kpi:"ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", target:"Ø´Ù‡Ø±ÙŠ"},
    {g:"Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©", kpi:"Ù†Ø³Ø¨Ø© ØªÙˆÙØ± Ø§Ù„Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª", target:"100%"},
    {g:"Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©", kpi:"Ø²ÙŠØ§Ø±Ø§Øª ØªÙÙ‚Ø¯ÙŠØ©/Ø´Ù‡Ø±", target:"â‰¥ 2"}
  ],
  counselor:[
    {g:"ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ", kpi:"Ø¬Ù„Ø³Ø§Øª Ø¥Ø±Ø´Ø§Ø¯ÙŠØ© Ù…ÙˆØ«Ù‘Ù‚Ø©/Ø£Ø³Ø¨ÙˆØ¹", target:"â‰¥ 5"},
    {g:"Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ† Ø¯Ø±Ø§Ø³ÙŠÙ‹Ø§", kpi:"Ø®Ø·Ø· ÙØ±Ø¯ÙŠØ© Ù…ÙØ¹Ù‘Ù„Ø©/Ø´Ù‡Ø±", target:"â‰¥ 5"},
    {g:"ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ", kpi:"Ø®ÙØ¶ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©", target:"â‰¥ 30%"},
    {g:"Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ ÙˆØ§Ù„Ù…Ù‡Ù†ÙŠ", kpi:"ÙˆØ±Ø´ ØªÙˆØ¹ÙˆÙŠØ©/ÙØµÙ„", target:"â‰¥ 3"}
  ],
  lab:[
    {g:"Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ù…Ø®ØªØ¨Ø±", kpi:"ØªÙˆÙØ± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¹Ø§Ù…Ù„Ø©", target:"â‰¥ 95%"},
    {g:"Ø§Ù„Ø£Ù…Ù† ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø©", kpi:"ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©", target:"100%"},
    {g:"Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©", kpi:"Ø­ØµØµ Ù…Ø®ØªØ¨Ø± Ù…Ù†ÙØ°Ø©/Ø£Ø³Ø¨ÙˆØ¹", target:"â‰¥ 3"},
    {g:"Ø§Ù„ØªÙˆØ«ÙŠÙ‚", kpi:"ØªÙ‚Ø§Ø±ÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©/Ø´Ù‡Ø±", target:"12"}
  ],
  kg:[
    {g:"ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©", kpi:"Ø§Ø³ØªÙŠÙØ§Ø¡ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨ÙŠØ¦Ø©", target:"100%"},
    {g:"ØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª", kpi:"Ø£Ù†Ø´Ø·Ø© Ù„ØºÙˆÙŠØ©/Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©", target:"â‰¥ 3"},
    {g:"Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…Ø³ØªÙ…Ø±", kpi:"Ù†Ù…Ø§Ø°Ø¬ ØªÙ‚ÙˆÙŠÙ…/Ø·ÙÙ„/Ø´Ù‡Ø±", target:"â‰¥ 2"},
    {g:"Ø´Ø±Ø§ÙƒØ© Ø§Ù„Ø£Ø³Ø±Ø©", kpi:"ÙØ¹Ø§Ù„ÙŠØ§Øª/ÙØµÙ„", target:"â‰¥ 2"}
  ]
};

/* Ø§Ù„ÙŠÙˆÙ…/Ø§Ù„ØªØ§Ø±ÙŠØ®/Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
(function(){
  const days=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
  const d=new Date();
  $('#todayTxt').textContent=days[d.getDay()];
  $('#dateTxt').textContent=d.toLocaleDateString('ar-SA');
  $('#modelTxt').textContent='Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: â€”';
})();

/* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©/Ø§Ù„Ù…Ø¯Ø±Ø³Ø© (Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ) */
function promptEdit(id,key,def){
  const v=prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ:", localStorage.getItem(key)||def||"");
  if(v!==null){ $(id).textContent=v; localStorage.setItem(key,v); }
}
$('#editDir').addEventListener('click',()=> promptEdit('#dirText','dirText',$('#dirText').textContent));
$('#editSchool').addEventListener('click',()=> promptEdit('#schoolText','schoolText',$('#schoolText').textContent));
$('#dirText').textContent    = localStorage.getItem('dirText')    || $('#dirText').textContent;
$('#schoolText').textContent = localStorage.getItem('schoolText') || $('#schoolText').textContent;

/* ØªØ­Ø±ÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± Ø¨Ø§Ù„Ø¯Ø¨Ù„ ÙƒÙ„Ùƒ */
$('#signPrincipalName').addEventListener('dblclick',()=>{
  const nv=prompt('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©:', localStorage.getItem('principalName')||$('#signPrincipalName').textContent);
  if(nv && nv.trim().length>2){ $('#signPrincipalName').textContent=nv.trim(); localStorage.setItem('principalName',nv.trim()); }
});

/* Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ â€” Ø·ÙØ¨Ù‘ÙÙ‚Øª Ù„ØªØ·Ø§Ø¨Ù‚ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙ‚Ø© Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù† */
const RUBRICS={
  teacher:[
    {name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",weight:10},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",weight:10},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",weight:10},
    {name:"Ø§Ù„ØªÙ†ÙˆØ¹ ÙÙŠ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³",weight:10},
    {name:"ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†",weight:10},
    {name:"Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ†ÙÙŠØ° Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù…",weight:10},
    {name:"ØªÙˆØ¸ÙŠÙ ØªÙ‚Ù†ÙŠØ§Øª ÙˆÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©",weight:10},
    {name:"ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ¦Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©",weight:10},
    {name:"Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙŠØ©",weight:5},
    {name:"ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ† ÙˆØªØ´Ø®ÙŠØµ Ù…Ø³ØªÙˆÙŠØ§ØªÙ‡Ù…",weight:5},
    {name:"ØªÙ†ÙˆØ¹ Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…",weight:10},
  ],
  vp:[
    {name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",weight:5},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",weight:5},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",weight:5},
    {name:"Ù…Ø±Ù† ÙˆÙ‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ ØªÙ†ÙÙŠØ° Ø£Ø¹Ù…Ø§Ù„Ù‡ ÙÙŠ Ø¸Ù„ Ø¸Ø±ÙˆÙ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©",weight:5},
    {name:"ÙŠØ¯Ø¹Ù… ÙˆÙŠØ´Ø§Ø±Ùƒ ÙÙŠ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ù†ÙˆØ¹ÙŠØ©",weight:5},
    {name:"ÙŠØªØ®Ø° Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØªØ±Ø¨ÙˆÙŠØ© Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ",weight:10},
    {name:"ÙŠØ¯ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø¨ÙƒÙØ§Ø¡Ø©",weight:5},
    {name:"ÙŠØ´Ø§Ø±Ùƒ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø© Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ù†ÙŠ",weight:5},
    {name:"ÙŠÙ‚Ø¯Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© ÙˆÙŠÙ†ØªØ¬ ØªØ­Ù‚Ù‚ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ",weight:5},
    {name:"ÙŠØ¯Ø¹Ù… ØªÙ†ÙÙŠØ° Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ù†ÙŠ",weight:5},
    {name:"ÙŠØ¹Ù‚Ø¯ Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ù…Ù†Ø³ÙˆØ¨ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©",weight:5},
    {name:"ÙŠÙ†ÙØ° Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¹Ù„Ù…ÙŠØ© Ù„ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¹Ù„Ù…",weight:15}, /* Ù…Ø·Ø§Ø¨Ù‚ Ù„ØµÙˆØ±Ø© Ø§Ù„ÙˆÙƒÙŠÙ„ (ØµÙ 15%) */
    {name:"ÙŠØ´Ø§Ø±Ùƒ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø·Ø· Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© Ø¨Ù…Ø®ØªÙ„Ù Ø£Ù†ÙˆØ§Ø¹Ù‡Ø§",weight:5},
    {name:"ØªÙ‡ÙŠØ¦Ø© ÙØ±Øµ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„ØµÙÙŠØ© ÙˆØºÙŠØ± Ø§Ù„ØµÙÙŠØ©",weight:5},
    {name:"ØªÙˆØ¸ÙŠÙ Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©",weight:5},
    {name:"ÙŠØ¹Ø²Ø² Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ù„Ù„Ø·Ù„Ø§Ø¨",weight:5},
    {name:"ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ¦Ø© Ù…Ø¯Ø±Ø³ÙŠØ© Ø¢Ù…Ù†Ø© ÙˆÙ…Ù…ÙƒÙ‘Ù†Ø© Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…",weight:5},
  ],
  principal:[
    {name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",weight:5},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",weight:5},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",weight:5},
    {name:"Ù…Ø±Ù† ÙˆÙ‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ ØªÙ†ÙÙŠØ° Ø£Ø¹Ù…Ø§Ù„Ù‡ ÙÙŠ Ø¸Ù„ Ø¸Ø±ÙˆÙ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©",weight:5},
    {name:"ÙŠØ¯Ø¹Ù… ÙˆÙŠØ´Ø§Ø±Ùƒ ÙÙŠ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ù†ÙˆØ¹ÙŠØ©",weight:5},
    {name:"ÙŠØªØ®Ø° Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ÙˆÙ‚Ø§Ø¦ÙŠØ© Ù„Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·",weight:5},
    {name:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯",weight:5},
    {name:"Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø© Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ù†ÙŠ",weight:5},
    {name:"Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© Ù„Ù„Ù…Ø¤Ø´Ø±Ø§Øª",weight:5},
    {name:"ØªÙ‚ÙŠÙŠÙ… Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø³ÙˆØ¨ÙŠÙ†",weight:5},
    {name:"ÙŠØ¯Ø¹Ù… ØªÙ†ÙÙŠØ° Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ù†ÙŠ",weight:5},
    {name:"Ø§Ù„Ø¥Ø³Ù‡Ø§Ù… ÙÙŠ ØªÙ†ÙÙŠØ° Ø®Ø·Ø© Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ù†ÙŠ",weight:10},
    {name:"Ø§Ù„Ø¥Ø³Ù‡Ø§Ù… ÙÙŠ ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©",weight:10},
    {name:"Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø·Ø·",weight:5},
    {name:"Ù…ØªØ§Ø¨Ø¹Ø© ØªÙ†ÙÙŠØ° Ø§Ù„Ø®Ø·Ø·",weight:5},
    {name:"ØªÙ‡ÙŠØ¦Ø© Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø©",weight:5},
    {name:"ØªÙˆØ¸ÙŠÙ Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©",weight:5},
    {name:"Ù…ØªØ§Ø¨Ø¹Ø© ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ",weight:5},
    {name:"ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ¦Ø© Ù…Ø¯Ø±Ø³ÙŠØ© Ø¢Ù…Ù†Ø© ÙˆÙ…ÙÙ…ÙƒÙ‘ÙÙ†Ø©",weight:5},
  ],
  activity:[
    {name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",weight:10},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",weight:10},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",weight:5},
    {name:"Ø§Ù„ØªÙ†ÙˆØ¹ ÙÙŠ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³",weight:5},
    {name:"ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†",weight:5},
    {name:"Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ†ÙÙŠØ° Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù…",weight:10},
    {name:"ØªÙˆØ¸ÙŠÙ ØªÙ‚Ù†ÙŠØ§Øª ÙˆÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªØ¹Ù„Ù…",weight:5},
    {name:"ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ¦Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©",weight:5},
    {name:"Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙŠØ©",weight:5},
    {name:"ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†",weight:5},
    {name:"ØªÙ†ÙˆØ¹ Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…",weight:5},
    {name:"Ø®Ø·Ø© Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ",weight:10},
    {name:"ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ¦Ø© Ù„Ù„Ø£Ù†Ø´Ø·Ø©",weight:5},
    {name:"Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ† ÙˆÙÙ‚ Ø§Ù„Ù…ÙŠÙˆÙ„",weight:5},
    {name:"ØªØ­ÙÙŠØ² Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø©",weight:10},
  ],
  health:[
    {name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",weight:10},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",weight:10},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",weight:10},
    {name:"Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³",weight:5},
    {name:"ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬",weight:5},
    {name:"Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù…",weight:5},
    {name:"Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª ÙˆØ§Ù„ÙˆØ³Ø§Ø¦Ù„",weight:5},
    {name:"ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ¦Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©",weight:5},
    {name:"Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙŠØ©",weight:5},
    {name:"ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬",weight:5},
    {name:"ØªÙ†ÙˆØ¹ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…",weight:5},
    {name:"ØªÙ†ÙÙŠØ° Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ù„Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©",weight:15},
    {name:"Ø­ØµØ± Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØµØ­ÙŠØ© Ù„Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†",weight:5},
    {name:"ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©",weight:10},
  ],
  counselor:[
    {name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",weight:20},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",weight:5},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",weight:5},
    {name:"ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·",weight:5},
    {name:"Ø¨Ø±Ø§Ù…Ø¬ ØªØ±Ø¨ÙˆÙŠØ© Ù„Ù„Ø¯Ø§ÙØ¹ÙŠØ©",weight:5},
    {name:"Ø®Ø·Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ",weight:10},
    {name:"ØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø§Ù„Ø§Øª ÙˆØ¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø¯Ø¹Ù…",weight:10},
    {name:"ØªØ¹Ø²ÙŠØ² Ø§Ù„Ù‚ÙŠÙ… ÙˆØ§Ù„Ø³Ù„ÙˆÙƒÙŠØ§Øª",weight:10},
    {name:"ØªØ¯Ø®Ù„Ø§Øª Ù†ÙØ³ÙŠØ© ÙˆØ§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©",weight:10},
    {name:"Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…Ù‡Ù†ÙŠ ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ",weight:5},
    {name:"ØªØ¹Ø²ÙŠØ² Ø§Ù„ØªÙÙˆÙ‚ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ",weight:5},
    {name:"ØªØ¯Ø®Ù„Ø§Øª Ù„Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ† ÙˆØ§Ù„Ù…Ø¹ÙŠØ¯ÙŠÙ†",weight:5},
    {name:"ØªÙˆØ¹ÙŠØ© Ø¨Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø³Ù„ÙˆÙƒ ÙˆØ§Ù„Ù…ÙˆØ§Ø¸Ø¨Ø©",weight:5},
  ],
  lab:[
    {name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",weight:10},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",weight:10},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",weight:10},
    {name:"Ø§Ù„ØªÙ†ÙˆØ¹ ÙÙŠ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³",weight:10},
    {name:"ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†",weight:10},
    {name:"Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ¨Ø±",weight:5},
    {name:"Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©",weight:5},
    {name:"ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª ÙˆØ§Ù„ØªØ¬Ù‡ÙŠØ²Ø§Øª",weight:5},
    {name:"Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©",weight:5},
    {name:"ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø±",weight:5},
    {name:"ØªØ³Ù„ÙŠÙ…/ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†",weight:5},
    {name:"ØªÙ‚Ø±ÙŠØ± Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©",weight:5},
    {name:"ØªÙ‚Ø§Ø±ÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ÙˆØ§Ù„Ù…Ø¹Ø¯Ø§Øª",weight:5},
  ],
  kg:[
    {name:"Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",weight:10},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",weight:5},
    {name:"Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",weight:5},
    {name:"Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª ØªØ¯Ø±ÙŠØ³ Ù…ØªÙ†ÙˆØ¹Ø©",weight:5},
    {name:"ØªØ­Ø³ÙŠÙ† Ù†ÙˆØ§ØªØ¬ Ø§Ù„ØªØ¹Ù„Ù…",weight:5},
    {name:"Ù…Ù…Ø§Ø±Ø³Ø§Øª Ù…Ø³Ø¤ÙˆÙ„Ø© Ù„Ù„Ø£Ø·ÙØ§Ù„",weight:5},
    {name:"Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø· Ø§Ù„ØªØ¹Ù„Ù…",weight:5},
    {name:"Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª ÙˆØ§Ù„ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©",weight:5},
    {name:"Ø§Ù„ØªÙ‚ÙŠØ¯ Ø¨Ø§Ù„Ù…Ù†Ù‡Ø§Ø¬",weight:5},
    {name:"Ø¥Ø´Ø±Ø§Ùƒ Ø§Ù„Ø£Ø³Ø±Ø© Ø¨Ø§Ù„Ù†Ù…Ùˆ",weight:5},
    {name:"ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ¦Ø© Ø¢Ù…Ù†Ø© ÙˆÙ…ÙÙ…ÙƒÙ†Ø©",weight:15},
    {name:"Ø±ÙƒÙ† Ù…ÙˆØ¶ÙˆØ¹ÙŠ Ù…Ù„Ø§Ø¦Ù…",weight:5},
    {name:"ØªØªØ¨Ø¹ ØªÙ‚Ø¯Ù… Ø§Ù„Ø£Ø·ÙØ§Ù„",weight:5},
    {name:"Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…Ø³ØªÙ…Ø± ÙˆØ§Ù„Ù…ØªÙ†ÙˆØ¹",weight:5},
    {name:"Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„ØªØ±Ø¨ÙˆÙŠØ©",weight:5},
    {name:"ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø®Ø¨Ø±Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ©",weight:5},
    {name:"Ø¯Ø¹Ù… Ø§ÙƒØªØ³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ… ÙˆØ§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª",weight:5},
    {name:"ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©",weight:5},
    {name:"ØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù„ØºÙˆÙŠØ© ÙˆØ§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©",weight:5},
  ],
};

/* Ø¨Ù†Ø§Ø¡ ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
function buildRows(items){
  const tb=$("#rows"); tb.innerHTML=""; let wsum=0;
  items.forEach((it,i)=>{
    wsum+=+it.weight;
    const tr=document.createElement('tr'); tr.dataset.w=it.weight;
    tr.innerHTML=`
      <td style="text-align:right"><span style="font-weight:800;color:#0c594e;margin-inline-end:6px">${i+1}</span><span class="item-text">${it.name}</span></td>
      <td>${it.weight}%</td>
      <td>
        <select class="select-mini grade">
          <option>1</option><option>2</option><option selected>3</option><option>4</option><option>5</option>
        </select>
      </td>
      <td class="result"><span class="score">0.00</span></td>`;
    tb.appendChild(tr);
  });
  $("#sumWeight").textContent=wsum+"%";
}

/* ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª + ØªÙ„ÙˆÙŠÙ† + Ù…ØªÙˆØ³Ø· */
function recalc(){
  let total=0, wsum=0, avgNum=0, avgDen=0;
  $$('#rows tr').forEach(tr=>{
    const w=+tr.dataset.w||0; wsum+=w;
    const sel=tr.querySelector('.grade');
    const v=sel.disabled? 0 : (+sel.value||0);
    const s= v? (v/5)*w : 0; total+=s;
    tr.querySelector('.score').textContent=s.toFixed(2);
    for(let k=1;k<=5;k++) tr.classList.remove('rate-'+k);
    if(v) tr.classList.add('rate-'+v);
    avgNum += v * w; avgDen += w;
  });
  $("#sumScore").textContent=total.toFixed(2);
  const pct=Math.max(0,Math.min(100,total));
  $("#kpiFill").style.width=pct+"%";
  $("#kpiLabelL").textContent=`Ù…Ø¤Ø´Ø± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²: ${pct.toFixed(0)}%`;
  $("#kpiLabelR").textContent=`Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£ÙˆØ²Ø§Ù†: ${wsum}%`;
  const avg = avgDen? (avgNum/avgDen):0;
  $("#avgOutOf5").textContent = avg.toFixed(2);
  $("#kpiLabelM").textContent = `Ø³ÙÙ„Ù‘Ù… Ø§Ù„ØªÙ‚Ø¯ÙŠØ± (Ù…ØªÙˆØ³Ø·): ${avg.toFixed(2)} / 5`;
  buildInsights();
}

/* ØªÙˆÙ„ÙŠØ¯ Ù†Øµ Ø§Ù„Ù‚ÙˆØ©/Ø§Ù„ØªØ­Ø³ÙŠÙ† */
function buildInsights(){
  const items=$$('#rows tr'); if(!items.length){ $('#strengthsBox').textContent='â€”'; $('#improveBox').textContent='â€”'; return; }
  const strengths=[], improve=[];
  items.forEach(tr=>{
    const sel=tr.querySelector('.grade');
    const v= sel.disabled? 0 : (+sel.value||0);
    const name=tr.querySelector('.item-text').textContent.trim();
    const w=+tr.dataset.w||0;
    if(v>=4) strengths.push(`â€¢ ØªÙ…ÙŠØ² ÙÙŠ Â«${name}Â» (ÙˆØ²Ù† ${w}%).`);
    if(v && v<=2) improve.push(`â€¢ ØªØ­Ø³ÙŠÙ† Â«${name}Â» Ø¨Ø®Ø·Ø© Ø¥Ø¬Ø±Ø§Ø¦ÙŠØ© Ù‚ØµÙŠØ±Ø© ÙˆØ´ÙˆØ§Ù‡Ø¯ Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© (ÙˆØ²Ù† ${w}%).`);
  });
  $('#strengthsBox').textContent = strengths.length? strengths.join('\n'):'â€”';
  $('#improveBox').textContent   = improve.length?   improve.join('\n')  :'â€”';
  $('#signTeacherName').textContent = $('#tName').value || 'â€”';
  $('#signPrincipalName').textContent = localStorage.getItem('principalName') || 'ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ';
}

/* ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ± + Ø§Ù„Ù…Ø±Ø­Ù„Ø© */
function applyModelStage(){
  const key=$('#modelSelect').value, arr=RUBRICS[key]||[];
  buildRows(arr);

  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
  const gb=$('#goalsBody'); gb.innerHTML='';
  (GOALS[key]||[]).forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td class="goal-cell"><input class="goal-input" value="${r.g}"></td>
                    <td class="goal-cell"><input class="goal-input" value="${r.kpi}"></td>
                    <td class="goal-cell"><input class="goal-input" value="${r.target}"></td>`;
    gb.appendChild(tr);
  });
  while($('#goalsBody').children.length<4){ // Ø¶Ù…Ø§Ù† 4 Ø£Ø³Ø·Ø±
    const tr=document.createElement('tr');
    tr.innerHTML=`<td class="goal-cell"><input class="goal-input" value=""></td>
                  <td class="goal-cell"><input class="goal-input" value=""></td>
                  <td class="goal-cell"><input class="goal-input" value=""></td>`;
    gb.appendChild(tr);
  }

  const stage=$('#stageSelect').value;
  const disabled = (stage==='planning');

  // ØªØ¹Ø·ÙŠÙ„/ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ù„Ù… ÙˆØ´ÙØ§ÙÙŠØªÙ‡
  $$('.grade').forEach(s=>{ s.disabled=disabled; s.style.opacity= disabled? '.35' : '.65'; });

  // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù
  $('#goalsWrap').style.display = disabled? 'block' : 'none';

  recalc();
  $('#modelTxt').textContent='Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: '+(TITLE_BY_MODEL[key]||'â€”');
  tryLoad();
}

/* Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ/ØªØ­Ù…ÙŠÙ„ */
function keyFor(){ return `PF_${($('#tName').value||'').trim()}_${$('#modelSelect').value}_${$('#stageSelect').value}`; }
function autoSave(){
  const rows=$$('#rows tr').map(tr=>({n:tr.querySelector('.item-text').textContent,w:+tr.dataset.w,v:+tr.querySelector('.grade').value,dis:tr.querySelector('.grade').disabled}));
  const goals=[...$('#goalsBody').querySelectorAll('tr')].map(tr=>{
    const t=tr.querySelectorAll('input'); return {g:t[0].value,kpi:t[1].value,target:t[2].value};
  });
  const data={
    dir:$('#dirText').textContent,school:$('#schoolText').textContent,
    model:$('#modelSelect').value,stage:$('#stageSelect').value,
    rows,goals,
    meta:{name:$('#tName').value,id:$('#tId').value,spec:$('#tSpec').value,rank:$('#tRank').value,principal:$('#signPrincipalName').textContent},
    ins:{s:$('#strengthsBox').textContent,i:$('#improveBox').textContent},sum:$('#sumScore').textContent,avg:$('#avgOutOf5').textContent
  };
  localStorage.setItem(keyFor(),JSON.stringify(data));
}
function tryLoad(){
  const raw=localStorage.getItem(keyFor()); if(!raw) return;
  const d=JSON.parse(raw);
  $('#tId').value=d.meta.id||''; $('#tSpec').value=d.meta.spec||''; $('#tRank').value=d.meta.rank||'';
  $('#signPrincipalName').textContent=d.meta.principal|| (localStorage.getItem('principalName')||'ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ');
  $$('#rows tr').forEach((tr,i)=>{ const r=d.rows[i]; if(r){ tr.querySelector('.grade').value=r.v; tr.querySelector('.grade').disabled=!!r.dis; }});
  if(d.goals && d.goals.length){
    const gb=$('#goalsBody'); gb.innerHTML='';
    d.goals.forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML = `<td class="goal-cell"><input class="goal-input" value="${r.g||''}"></td>
                      <td class="goal-cell"><input class="goal-input" value="${r.kpi||''}"></td>
                      <td class="goal-cell"><input class="goal-input" value="${r.target||''}"></td>`;
      gb.appendChild(tr);
    });
  }
  recalc();
}

/* Ø£Ø­Ø¯Ø§Ø« Ø¹Ø§Ù…Ø© */
document.addEventListener('change',e=>{
  if(e.target.classList.contains('grade') || e.target.classList.contains('goal-input')){ recalc(); autoSave(); }
});
$('#modelSelect').addEventListener('change',()=>{ applyModelStage(); autoSave(); });
$('#stageSelect').addEventListener('change',()=>{ applyModelStage(); autoSave(); });

/* ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ */
applyModelStage();

/* Ø¹Ø¯Ø³Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ */
const HEADER_MAP=[
  {keys:['Ø§Ù„Ø§Ø³Ù…','Name','Full Name'], prop:'name'},
  {keys:['Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©','Ù‡ÙˆÙŠØ©','ID','National ID'], prop:'id'},
  {keys:['Ø§Ù„ØªØ®ØµØµ','Specialty','Major'], prop:'spec'},
  {keys:['Ø§Ù„Ù…Ø±ØªØ¨Ø©','Ø§Ù„Ø±ØªØ¨Ø©','Rank','Grade'], prop:'rank'},
  {keys:['Ø§Ù„Ù…Ø³Ù…Ù‰','Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ','Title','Role'], prop:'title'},
];
function findProp(h){ h=(h||'').toString().trim(); for(const m of HEADER_MAP){ if(m.keys.some(k=>new RegExp(`^${k}$`,'i').test(h))) return m.prop; } return null; }
function getNames(){ return JSON.parse(localStorage.getItem('namesV2')||'[]'); }
function setNames(a){ localStorage.setItem('namesV2',JSON.stringify(a)); }
function refreshNameList(){
  const box=$("#nameList"); box.innerHTML="";
  const names=getNames();
  $("#nameStats").textContent = names.length? `Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø®Ø²Ù†Ø©: ${names.length}` : "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ù…Ø§Ø¡ Ø¨Ø¹Ø¯.";
  if(!names.length){ return; }
  const grid=document.createElement('div'); grid.style.display='grid'; grid.style.gridTemplateColumns='repeat(auto-fill,minmax(240px,1fr))'; grid.style.gap='8px';
  names.forEach(o=>{
    const card=document.createElement('div'); card.style.border='1px solid var(--border)'; card.style.borderRadius='10px'; card.style.padding='8px'; card.style.cursor='pointer'; card.style.background='#fff';
    card.innerHTML=`<div style="font-weight:900;color:#0c594e">${o.name}</div><div style="font-size:12px;color:#667;display:flex;gap:6px;flex-wrap:wrap"><span>${o.id||'â€”'}</span><span>${o.spec||'â€”'}</span><span>${o.rank||'â€”'}</span><span>${o.title||'â€”'}</span></div>`;
    card.onclick=()=>{ $('#tName').value=o.name||''; $('#tId').value=o.id||''; $('#tSpec').value=o.spec||''; $('#tRank').value=o.rank||''; $('#mini').style.display='none'; recalc(); buildInsights(); autoSave(); };
    grid.appendChild(card);
  }); box.appendChild(grid);
}
$('#openMini').addEventListener('click',()=> { refreshNameList(); $('#mini').style.display='flex'; });
$('#miniClose').addEventListener('click',()=> $('#mini').style.display='none');
$('#mini').addEventListener('click',e=>{ if(e.target.id==='mini') $('#mini').style.display='none'; });
$('#btnPickFile').addEventListener('click',()=> $('#xlsInput').click());
$('#btnTpl').addEventListener('click',()=>{
  const rows=[["Ø§Ù„Ø§Ø³Ù…","Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©","Ø§Ù„ØªØ®ØµØµ","Ø§Ù„Ù…Ø±ØªØ¨Ø©","Ø§Ù„Ù…Ø³Ù…Ù‰"],[""],];
  const ws=XLSX.utils.aoa_to_sheet(rows); const wb=XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,ws,"Ø£Ø³Ù…Ø§Ø¡");
  const wbout=XLSX.write(wb,{bookType:'xlsx',type:'array'}); saveAs(new Blob([wbout],{type:"application/octet-stream"}),"template_names.xlsx");
});
$('#xlsInput').addEventListener('change',async e=>{
  const f=e.target.files[0]; if(!f) return;
  try{
    const data=await f.arrayBuffer(); const wb=XLSX.read(data,{type:'array'});
    const all=[];
    wb.SheetNames.forEach(name=>{
      const ws=wb.Sheets[name]; const rows=XLSX.utils.sheet_to_json(ws,{header:1,defval:''}); if(!rows.length) return;
      const head=rows[0]; const idx={}; head.forEach((h,i)=>{ const p=findProp(h); if(p) idx[p]=i; });
      for(let r=1;r<rows.length;r++){
        const row=rows[r]; if(!row.length) continue;
        const o={}; Object.keys(idx).forEach(p=> o[p]=String(row[idx[p]]||'').trim());
        if(o.name){ all.push(o); }
      }
    });
    if(all.length){
      const prev=getNames(); const mix=[...prev];
      all.forEach(o=>{ if(!mix.some(x=>x.name===o.name && x.id===o.id)){ mix.push(o); }});
      setNames(mix); refreshNameList();
    } else alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø¹Ù…Ø¯Ø© Ù…Ø¹Ø±Ù‘ÙØ© Ù„Ù„Ø£Ø³Ù…Ø§Ø¡.');
  }catch(err){ console.error(err); alert('ØªØ¹Ø°Ù‘Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù.'); }
  e.target.value='';
});

/* Ø·Ø¨Ø§Ø¹Ø© Ùˆ PDF â€” Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø· */
const HIDE_SEL='.modal,.toolbar';
function hideUI(hide=true){
  $$(HIDE_SEL).forEach(el=>{ if(hide){el.dataset._np='1'; el.style.display='none';} else if(el.dataset._np==='1'){ el.style.display=''; delete el.dataset._np; }});
}
async function capturePDF(targetEl, filename){
  try{
    hideUI(true);
    const { jsPDF } = window.jspdf;
    const canvas = await html2canvas(targetEl,{scale:2,useCORS:true,windowWidth:document.documentElement.scrollWidth});
    const img = canvas.toDataURL('image/png');
    const pdf = new jsPDF({orientation:'p',unit:'mm',format:'a4'});
    const props=pdf.getImageProperties(img); const w=210, h=(props.height*w)/props.width;
    pdf.addImage(img,'PNG',0,0,w,h);
    pdf.save(filename);
  }catch(e){ alert('ØªØ¹Ø°Ù‘Ø± Ø­ÙØ¸ PDF'); console.error(e);}
  finally{ hideUI(false); }
}
$('#btnPrint').addEventListener('click',()=> window.print());
$('#btnPdf').addEventListener('click', async ()=>{
  const name=$('#tName').value||'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
  await capturePDF(document.getElementById('page'), `ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ - ${name}.pdf`);
});
$('#btnSave').addEventListener('click',()=>{ autoSave(); alert('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§.'); });
$('#btnClear').addEventListener('click',()=>{
  const stage=$('#stageSelect').value;
  if(stage==='planning'){
    // ØªÙØ±ÙŠØº Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ÙˆØ¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø³Ù„Ù… Ù…Ø¹Ø·Ù„
    $('#goalsBody').querySelectorAll('input').forEach(i=> i.value='');
  }else{
    $$('.grade').forEach(s=> s.value='3');
  }
  recalc(); buildInsights(); autoSave();
});

/* ÙˆØ§ØªØ³Ø§Ø¨ */
const DEFAULT_PHONE= localStorage.getItem('waPhone') || '966500000000';
function buildWhatsAppText(){
  const name=$('#tName').value||'â€”', model=$('#modelSelect').selectedOptions[0].textContent, stage=$('#stageSelect').selectedOptions[0].textContent;
  const lines=[`ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ â€” ${name} â€” ${model} â€” ${stage}`, `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${$('#sumScore').textContent}`, `Ø§Ù„Ù…ØªÙˆØ³Ø· (Ù…Ù† 5): ${$('#avgOutOf5').textContent}`, '', 'Ù…Ù„Ø®Øµ Ø§Ù„Ø¨Ù†ÙˆØ¯:'];
  $$('#rows tr').forEach(tr=>{
    const item=tr.querySelector('.item-text').textContent; const w=+tr.dataset.w; const sel=tr.querySelector('.grade'); const v= sel.disabled? 0 : (+sel.value||0); const s= v? (v/5)*w : 0;
    lines.push(`- ${item}: ÙˆØ²Ù† ${w}%ØŒ Ø¯Ø±Ø¬Ø© ${v||'-'}/5ØŒ Ù†Ø§ØªØ¬ ${s.toFixed(2)}`);
  });
  lines.push('', 'Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©:', $('#strengthsBox').textContent||'â€”', '', 'Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ†:', $('#improveBox').textContent||'â€”');
  return encodeURIComponent(lines.join("\n"));
}
$('#btnWhatsApp').addEventListener('click',()=>{
  const phone = prompt('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ (Ù…Ø¹ Ù…ÙØªØ§Ø­ Ø§Ù„Ø¯ÙˆÙ„Ø©):', DEFAULT_PHONE) || DEFAULT_PHONE;
  localStorage.setItem('waPhone', phone);
  const text=buildWhatsAppText();
  window.open(`https://wa.me/${phone}?text=${text}`,'_blank');
});

/* ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° */
$('#openHelp').addEventListener('click',()=> $('#helpModal').style.display='flex');
$('#openRubrics').addEventListener('click',()=> $('#reportsModal').style.display='flex');
document.addEventListener('click',e=>{
  const sel=e.target.getAttribute('data-close');
  if(sel){ $(sel).style.display='none'; }
  if(e.target.id==='helpModal') $('#helpModal').style.display='none';
  if(e.target.id==='reportsModal') $('#reportsModal').style.display='none';
});

/* Ø®Ø·Ø© Ø§Ù„ÙØ¬ÙˆØ© */
function buildGapPlan(){
  const name=$('#tName').value||'â€”';
  const model=$('#modelSelect').selectedOptions[0].textContent;
  const stage=$('#stageSelect').value;
  if(stage==='planning'){ alert('ØªÙÙØ¹Ù‘Ù„ Ø§Ù„Ø®Ø·Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©/Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.'); return; }
  const d=new Date(); const year = d.getFullYear()+' / '+(d.getFullYear()+1);

  $('#g_dirHeader').textContent = $('#dirText').textContent;
  $('#g_schoolHeader').textContent = $('#schoolText').textContent;
  $('#g_today').textContent = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'][d.getDay()];
  $('#g_date').textContent = d.toLocaleDateString('ar-SA');
  $('#g_model').textContent = `Ù†Ù…ÙˆØ°Ø¬: ${model}`;

  $('#gapModal').style.display='flex';
  $('#g_name').textContent=name; $('#g_dir').textContent=$('#dirText').textContent;
  $('#g_title').textContent=model; $('#g_spec').textContent=$('#tSpec').value||'â€”';
  $('#g_stage').textContent=$('#stageSelect').selectedOptions[0].textContent; $('#g_school').textContent=$('#schoolText').textContent;
  $('#g_year').textContent=year;

  // Ø§Ù„ÙØ¬ÙˆØ§Øª: Ø§Ù„Ø¨Ù†ÙˆØ¯ 1 Ø£Ùˆ 2
  const rows=$$('#rows tr').map(tr=>{
    const v=tr.querySelector('.grade').disabled? 0 : (+tr.querySelector('.grade').value||0);
    return {name:tr.querySelector('.item-text').textContent,w:+tr.dataset.w,v};
  }).filter(x=>x.v && x.v<=2);

  // Ø¥Ù† Ù„Ù… ØªÙˆØ¬Ø¯ ÙØ¬ÙˆØ§ØªØŒ Ù†Ø£Ø®Ø° Ø£Ù‚Ù„ Ø§Ù„Ø¨Ù†ÙˆØ¯
  rows.sort((a,b)=> (a.v===b.v? a.w-b.w : a.v-b.v));
  const gaps= rows.length? rows : $$('#rows tr').map(tr=>({name:tr.querySelector('.item-text').textContent,w:+tr.dataset.w,v:+tr.querySelector('.grade').value||5})).sort((a,b)=> (a.v===b.v? a.w-b.w : a.v-b.v)).slice(0,3);

  const body=$('#g_targets'); body.innerHTML='';
  gaps.forEach(g=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${g.name}</td>` + [1,2,3,4,5].map(k=> `<td style="font-weight:900">${k===g.v?'âœ“':''}</td>`).join('');
    body.appendChild(tr);
  });

  const avg = +($('#avgOutOf5').textContent||'0');
  $('#g_grade').textContent = `${avg.toFixed(2)} / 5`;

  $('#g_strengths').textContent = ($('#strengthsBox').textContent||'').trim() || 'â€”';
  $('#g_gaps').textContent      = gaps.map(g=>`â€¢ ${g.name}`).join('\n') || 'â€”';

  const actions=$('#g_actions'); actions.innerHTML='';
  gaps.forEach((g,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td contenteditable="true">Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ø³ÙŠÙ† Ù…ÙˆØ¬Ù‡ ÙŠØªØ¹Ù„Ù‚ Ø¨Ù€ Â«${g.name}Â»</td><td contenteditable="true">Ù…ÙˆØ§Ø¯/Ù…Ù†ØµØ§Øª/Ø¯Ø¹Ù…</td><td contenteditable="true">3 Ø£Ø³Ø§Ø¨ÙŠØ¹</td><td contenteditable="true">ØªØ¯Ø±ÙŠØ¨/Ø²ÙŠØ§Ø±Ø© ØµÙÙŠØ©</td><td contenteditable="true">${name||'Ø§Ù„Ù…Ø¹Ù„Ù…'}</td><td contenteditable="true">Ø§Ù„Ù…Ø¯ÙŠØ±/Ø§Ù„Ù…Ø´Ø±Ù</td><td contenteditable="true">ØªØ­Ø³Ù‘Ù† â‰¥ Ø¯Ø±Ø¬Ø© ÙˆØ§Ø­Ø¯Ø©</td>`;
    actions.appendChild(tr);
  });

  $('#g_signTeacher').textContent = name || 'â€”';
  $('#g_signPrincipal').textContent = localStorage.getItem('principalName') || 'ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ';
  $('#g_footerDate').textContent = `Ø­ÙØ±Ù‘Ø± ÙÙŠ ${d.toLocaleDateString('ar-SA')} â€” ${['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'][d.getDay()]}`;
}
document.getElementById('btnGapPlan').addEventListener('click', buildGapPlan);
document.getElementById('gapClose').addEventListener('click',()=> $('#gapModal').style.display='none');
document.getElementById('gapPdf').addEventListener('click', async ()=>{
  const name=$('#tName').value||'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
  await capturePDF(document.getElementById('gapPanel'), `Ø®Ø·Ø© ØªØ­Ø³ÙŠÙ† ÙØ¬ÙˆØ© Ø§Ù„Ø£Ø¯Ø§Ø¡ - ${name}.pdf`);
});
</script>
</body>
</html>
